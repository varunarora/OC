(function(e){function t(e,t,n){switch(arguments.length){case 2:return null!=e?e:t;case 3:return null!=e?e:null!=t?t:n;default:throw new Error("Implement me")}}function n(e,t){return kt.call(e,t)}function s(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function a(e){Dt.suppressDeprecationWarnings===!1&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+e)}function i(e,t){var n=!0;return p(function(){return n&&(a(e),n=!1),t.apply(this,arguments)},t)}function r(e,t){gn[e]||(a(t),gn[e]=!0)}function o(e,t){return function(n){return m(e.call(this,n),t)}}function l(e,t){return function(n){return this.localeData().ordinal(e.call(this,n),t)}}function c(){}function d(e,t){t!==!1&&x(e),h(this,e),this._d=new Date(+e._d)}function u(e){var t=O(e),n=t.year||0,s=t.quarter||0,a=t.month||0,i=t.week||0,r=t.day||0,o=t.hour||0,l=t.minute||0,c=t.second||0,d=t.millisecond||0;this._milliseconds=+d+1e3*c+6e4*l+36e5*o,this._days=+r+7*i,this._months=+a+3*s+12*n,this._data={},this._locale=Dt.localeData(),this._bubble()}function p(e,t){for(var s in t)n(t,s)&&(e[s]=t[s]);return n(t,"toString")&&(e.toString=t.toString),n(t,"valueOf")&&(e.valueOf=t.valueOf),e}function h(e,t){var n,s,a;if("undefined"!=typeof t._isAMomentObject&&(e._isAMomentObject=t._isAMomentObject),"undefined"!=typeof t._i&&(e._i=t._i),"undefined"!=typeof t._f&&(e._f=t._f),"undefined"!=typeof t._l&&(e._l=t._l),"undefined"!=typeof t._strict&&(e._strict=t._strict),"undefined"!=typeof t._tzm&&(e._tzm=t._tzm),"undefined"!=typeof t._isUTC&&(e._isUTC=t._isUTC),"undefined"!=typeof t._offset&&(e._offset=t._offset),"undefined"!=typeof t._pf&&(e._pf=t._pf),"undefined"!=typeof t._locale&&(e._locale=t._locale),Pt.length>0)for(n in Pt)s=Pt[n],a=t[s],"undefined"!=typeof a&&(e[s]=a);return e}function f(e){return 0>e?Math.ceil(e):Math.floor(e)}function m(e,t,n){for(var s=""+Math.abs(e),a=e>=0;s.length<t;)s="0"+s;return(a?n?"+":"":"-")+s}function v(e,t){var n={milliseconds:0,months:0};return n.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(n.months,"M").isAfter(t)&&--n.months,n.milliseconds=+t-+e.clone().add(n.months,"M"),n}function g(e,t){var n;return t=L(t,e),e.isBefore(t)?n=v(e,t):(n=v(t,e),n.milliseconds=-n.milliseconds,n.months=-n.months),n}function y(e,t){return function(n,s){var a,i;return null===s||isNaN(+s)||(r(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period)."),i=n,n=s,s=i),n="string"==typeof n?+n:n,a=Dt.duration(n,s),D(this,a,e),this}}function D(e,t,n,s){var a=t._milliseconds,i=t._days,r=t._months;s=null==s?!0:s,a&&e._d.setTime(+e._d+a*n),i&&ht(e,"Date",pt(e,"Date")+i*n),r&&ut(e,pt(e,"Month")+r*n),s&&Dt.updateOffset(e,i||r)}function _(e){return"[object Array]"===Object.prototype.toString.call(e)}function M(e){return"[object Date]"===Object.prototype.toString.call(e)||e instanceof Date}function b(e,t,n){var s,a=Math.min(e.length,t.length),i=Math.abs(e.length-t.length),r=0;for(s=0;a>s;s++)(n&&e[s]!==t[s]||!n&&S(e[s])!==S(t[s]))&&r++;return r+i}function w(e){if(e){var t=e.toLowerCase().replace(/(.)s$/,"$1");e=dn[e]||un[t]||t}return e}function O(e){var t,s,a={};for(s in e)n(e,s)&&(t=w(s),t&&(a[t]=e[s]));return a}function k(t){var n,s;if(0===t.indexOf("week"))n=7,s="day";else{if(0!==t.indexOf("month"))return;n=12,s="month"}Dt[t]=function(a,i){var r,o,l=Dt._locale[t],c=[];if("number"==typeof a&&(i=a,a=e),o=function(e){var t=Dt().utc().set(s,e);return l.call(Dt._locale,t,a||"")},null!=i)return o(i);for(r=0;n>r;r++)c.push(o(r));return c}}function S(e){var t=+e,n=0;return 0!==t&&isFinite(t)&&(n=t>=0?Math.floor(t):Math.ceil(t)),n}function C(e,t){return new Date(Date.UTC(e,t+1,0)).getUTCDate()}function N(e,t,n){return ot(Dt([e,11,31+t-n]),t,n).week}function E(e){return T(e)?366:365}function T(e){return e%4===0&&e%100!==0||e%400===0}function x(e){var t;e._a&&-2===e._pf.overflow&&(t=e._a[Ct]<0||e._a[Ct]>11?Ct:e._a[Nt]<1||e._a[Nt]>C(e._a[St],e._a[Ct])?Nt:e._a[Et]<0||e._a[Et]>24||24===e._a[Et]&&(0!==e._a[Tt]||0!==e._a[xt]||0!==e._a[At])?Et:e._a[Tt]<0||e._a[Tt]>59?Tt:e._a[xt]<0||e._a[xt]>59?xt:e._a[At]<0||e._a[At]>999?At:-1,e._pf._overflowDayOfYear&&(St>t||t>Nt)&&(t=Nt),e._pf.overflow=t)}function A(t){return null==t._isValid&&(t._isValid=!isNaN(t._d.getTime())&&t._pf.overflow<0&&!t._pf.empty&&!t._pf.invalidMonth&&!t._pf.nullInput&&!t._pf.invalidFormat&&!t._pf.userInvalidated,t._strict&&(t._isValid=t._isValid&&0===t._pf.charsLeftOver&&0===t._pf.unusedTokens.length&&t._pf.bigHour===e)),t._isValid}function I(e){return e?e.toLowerCase().replace("_","-"):e}function P(e){for(var t,n,s,a,i=0;i<e.length;){for(a=I(e[i]).split("-"),t=a.length,n=I(e[i+1]),n=n?n.split("-"):null;t>0;){if(s=Y(a.slice(0,t).join("-")))return s;if(n&&n.length>=t&&b(a,n,!0)>=t-1)break;t--}i++}return null}function Y(e){var t=null;if(!It[e]&&Yt)try{t=Dt.locale(),require("./locale/"+e),Dt.locale(t)}catch(n){}return It[e]}function L(e,t){var n,s;return t._isUTC?(n=t.clone(),s=(Dt.isMoment(e)||M(e)?+e:+Dt(e))-+n,n._d.setTime(+n._d+s),Dt.updateOffset(n,!1),n):Dt(e).local()}function F(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function W(e){var t,n,s=e.match($t);for(t=0,n=s.length;n>t;t++)s[t]=vn[s[t]]?vn[s[t]]:F(s[t]);return function(a){var i="";for(t=0;n>t;t++)i+=s[t]instanceof Function?s[t].call(a,e):s[t];return i}}function $(e,t){return e.isValid()?(t=U(t,e.localeData()),pn[t]||(pn[t]=W(t)),pn[t](e)):e.localeData().invalidDate()}function U(e,t){function n(e){return t.longDateFormat(e)||e}var s=5;for(Ut.lastIndex=0;s>=0&&Ut.test(e);)e=e.replace(Ut,n),Ut.lastIndex=0,s-=1;return e}function q(e,t){var n,s=t._strict;switch(e){case"Q":return Jt;case"DDDD":return Qt;case"YYYY":case"GGGG":case"gggg":return s?en:Ht;case"Y":case"G":case"g":return nn;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return s?tn:Vt;case"S":if(s)return Jt;case"SS":if(s)return Xt;case"SSS":if(s)return Qt;case"DDD":return Rt;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return Bt;case"a":case"A":return t._locale._meridiemParse;case"x":return Kt;case"X":return Zt;case"Z":case"ZZ":return jt;case"T":return Gt;case"SSSS":return zt;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return s?Xt:qt;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return qt;case"Do":return s?t._locale._ordinalParse:t._locale._ordinalParseLenient;default:return n=new RegExp(Z(K(e.replace("\\","")),"i"))}}function R(e){e=e||"";var t=e.match(jt)||[],n=t[t.length-1]||[],s=(n+"").match(ln)||["-",0,0],a=+(60*s[1])+S(s[2]);return"+"===s[0]?-a:a}function H(e,t,n){var s,a=n._a;switch(e){case"Q":null!=t&&(a[Ct]=3*(S(t)-1));break;case"M":case"MM":null!=t&&(a[Ct]=S(t)-1);break;case"MMM":case"MMMM":s=n._locale.monthsParse(t,e,n._strict),null!=s?a[Ct]=s:n._pf.invalidMonth=t;break;case"D":case"DD":null!=t&&(a[Nt]=S(t));break;case"Do":null!=t&&(a[Nt]=S(parseInt(t.match(/\d{1,2}/)[0],10)));break;case"DDD":case"DDDD":null!=t&&(n._dayOfYear=S(t));break;case"YY":a[St]=Dt.parseTwoDigitYear(t);break;case"YYYY":case"YYYYY":case"YYYYYY":a[St]=S(t);break;case"a":case"A":n._isPm=n._locale.isPM(t);break;case"h":case"hh":n._pf.bigHour=!0;case"H":case"HH":a[Et]=S(t);break;case"m":case"mm":a[Tt]=S(t);break;case"s":case"ss":a[xt]=S(t);break;case"S":case"SS":case"SSS":case"SSSS":a[At]=S(1e3*("0."+t));break;case"x":n._d=new Date(S(t));break;case"X":n._d=new Date(1e3*parseFloat(t));break;case"Z":case"ZZ":n._useUTC=!0,n._tzm=R(t);break;case"dd":case"ddd":case"dddd":s=n._locale.weekdaysParse(t),null!=s?(n._w=n._w||{},n._w.d=s):n._pf.invalidWeekday=t;break;case"w":case"ww":case"W":case"WW":case"d":case"e":case"E":e=e.substr(0,1);case"gggg":case"GGGG":case"GGGGG":e=e.substr(0,2),t&&(n._w=n._w||{},n._w[e]=S(t));break;case"gg":case"GG":n._w=n._w||{},n._w[e]=Dt.parseTwoDigitYear(t)}}function V(e){var n,s,a,i,r,o,l;n=e._w,null!=n.GG||null!=n.W||null!=n.E?(r=1,o=4,s=t(n.GG,e._a[St],ot(Dt(),1,4).year),a=t(n.W,1),i=t(n.E,1)):(r=e._locale._week.dow,o=e._locale._week.doy,s=t(n.gg,e._a[St],ot(Dt(),r,o).year),a=t(n.w,1),null!=n.d?(i=n.d,r>i&&++a):i=null!=n.e?n.e+r:r),l=lt(s,a,i,o,r),e._a[St]=l.year,e._dayOfYear=l.dayOfYear}function z(e){var n,s,a,i,r=[];if(!e._d){for(a=j(e),e._w&&null==e._a[Nt]&&null==e._a[Ct]&&V(e),e._dayOfYear&&(i=t(e._a[St],a[St]),e._dayOfYear>E(i)&&(e._pf._overflowDayOfYear=!0),s=st(i,0,e._dayOfYear),e._a[Ct]=s.getUTCMonth(),e._a[Nt]=s.getUTCDate()),n=0;3>n&&null==e._a[n];++n)e._a[n]=r[n]=a[n];for(;7>n;n++)e._a[n]=r[n]=null==e._a[n]?2===n?1:0:e._a[n];24===e._a[Et]&&0===e._a[Tt]&&0===e._a[xt]&&0===e._a[At]&&(e._nextDay=!0,e._a[Et]=0),e._d=(e._useUTC?st:nt).apply(null,r),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()+e._tzm),e._nextDay&&(e._a[Et]=24)}}function B(e){var t;e._d||(t=O(e._i),e._a=[t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],z(e))}function j(e){var t=new Date;return e._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}function G(t){if(t._f===Dt.ISO_8601)return void X(t);t._a=[],t._pf.empty=!0;var n,s,a,i,r,o=""+t._i,l=o.length,c=0;for(a=U(t._f,t._locale).match($t)||[],n=0;n<a.length;n++)i=a[n],s=(o.match(q(i,t))||[])[0],s&&(r=o.substr(0,o.indexOf(s)),r.length>0&&t._pf.unusedInput.push(r),o=o.slice(o.indexOf(s)+s.length),c+=s.length),vn[i]?(s?t._pf.empty=!1:t._pf.unusedTokens.push(i),H(i,s,t)):t._strict&&!s&&t._pf.unusedTokens.push(i);t._pf.charsLeftOver=l-c,o.length>0&&t._pf.unusedInput.push(o),t._pf.bigHour===!0&&t._a[Et]<=12&&(t._pf.bigHour=e),t._isPm&&t._a[Et]<12&&(t._a[Et]+=12),t._isPm===!1&&12===t._a[Et]&&(t._a[Et]=0),z(t),x(t)}function K(e){return e.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,s,a){return t||n||s||a})}function Z(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function J(e){var t,n,a,i,r;if(0===e._f.length)return e._pf.invalidFormat=!0,void(e._d=new Date(0/0));for(i=0;i<e._f.length;i++)r=0,t=h({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._pf=s(),t._f=e._f[i],G(t),A(t)&&(r+=t._pf.charsLeftOver,r+=10*t._pf.unusedTokens.length,t._pf.score=r,(null==a||a>r)&&(a=r,n=t));p(e,n||t)}function X(e){var t,n,s=e._i,a=sn.exec(s);if(a){for(e._pf.iso=!0,t=0,n=rn.length;n>t;t++)if(rn[t][1].exec(s)){e._f=rn[t][0]+(a[6]||" ");break}for(t=0,n=on.length;n>t;t++)if(on[t][1].exec(s)){e._f+=on[t][0];break}s.match(jt)&&(e._f+="Z"),G(e)}else e._isValid=!1}function Q(e){X(e),e._isValid===!1&&(delete e._isValid,Dt.createFromInputFallback(e))}function et(e,t){var n,s=[];for(n=0;n<e.length;++n)s.push(t(e[n],n));return s}function tt(t){var n,s=t._i;s===e?t._d=new Date:M(s)?t._d=new Date(+s):null!==(n=Lt.exec(s))?t._d=new Date(+n[1]):"string"==typeof s?Q(t):_(s)?(t._a=et(s.slice(0),function(e){return parseInt(e,10)}),z(t)):"object"==typeof s?B(t):"number"==typeof s?t._d=new Date(s):Dt.createFromInputFallback(t)}function nt(e,t,n,s,a,i,r){var o=new Date(e,t,n,s,a,i,r);return 1970>e&&o.setFullYear(e),o}function st(e){var t=new Date(Date.UTC.apply(null,arguments));return 1970>e&&t.setUTCFullYear(e),t}function at(e,t){if("string"==typeof e)if(isNaN(e)){if(e=t.weekdaysParse(e),"number"!=typeof e)return null}else e=parseInt(e,10);return e}function it(e,t,n,s,a){return a.relativeTime(t||1,!!n,e,s)}function rt(e,t,n){var s=Dt.duration(e).abs(),a=Ot(s.as("s")),i=Ot(s.as("m")),r=Ot(s.as("h")),o=Ot(s.as("d")),l=Ot(s.as("M")),c=Ot(s.as("y")),d=a<hn.s&&["s",a]||1===i&&["m"]||i<hn.m&&["mm",i]||1===r&&["h"]||r<hn.h&&["hh",r]||1===o&&["d"]||o<hn.d&&["dd",o]||1===l&&["M"]||l<hn.M&&["MM",l]||1===c&&["y"]||["yy",c];return d[2]=t,d[3]=+e>0,d[4]=n,it.apply({},d)}function ot(e,t,n){var s,a=n-t,i=n-e.day();return i>a&&(i-=7),a-7>i&&(i+=7),s=Dt(e).add(i,"d"),{week:Math.ceil(s.dayOfYear()/7),year:s.year()}}function lt(e,t,n,s,a){var i,r,o=st(e,0,1).getUTCDay();return o=0===o?7:o,n=null!=n?n:a,i=a-o+(o>s?7:0)-(a>o?7:0),r=7*(t-1)+(n-a)+i+1,{year:r>0?e:e-1,dayOfYear:r>0?r:E(e-1)+r}}function ct(t){var n,s=t._i,a=t._f;return t._locale=t._locale||Dt.localeData(t._l),null===s||a===e&&""===s?Dt.invalid({nullInput:!0}):("string"==typeof s&&(t._i=s=t._locale.preparse(s)),Dt.isMoment(s)?new d(s,!0):(a?_(a)?J(t):G(t):tt(t),n=new d(t),n._nextDay&&(n.add(1,"d"),n._nextDay=e),n))}function dt(e,t){var n,s;if(1===t.length&&_(t[0])&&(t=t[0]),!t.length)return Dt();for(n=t[0],s=1;s<t.length;++s)t[s][e](n)&&(n=t[s]);return n}function ut(e,t){var n;return"string"==typeof t&&(t=e.localeData().monthsParse(t),"number"!=typeof t)?e:(n=Math.min(e.date(),C(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,n),e)}function pt(e,t){return e._d["get"+(e._isUTC?"UTC":"")+t]()}function ht(e,t,n){return"Month"===t?ut(e,n):e._d["set"+(e._isUTC?"UTC":"")+t](n)}function ft(e,t){return function(n){return null!=n?(ht(this,e,n),Dt.updateOffset(this,t),this):pt(this,e)}}function mt(e){return 400*e/146097}function vt(e){return 146097*e/400}function gt(e){Dt.duration.fn[e]=function(){return this._data[e]}}function yt(e){"undefined"==typeof ender&&(_t=wt.moment,wt.moment=e?i("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.",Dt):Dt)}for(var Dt,_t,Mt,bt="2.8.4",wt="undefined"!=typeof global?global:this,Ot=Math.round,kt=Object.prototype.hasOwnProperty,St=0,Ct=1,Nt=2,Et=3,Tt=4,xt=5,At=6,It={},Pt=[],Yt="undefined"!=typeof module&&module&&module.exports,Lt=/^\/?Date\((\-?\d+)/i,Ft=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,Wt=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,$t=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Q|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|x|X|zz?|ZZ?|.)/g,Ut=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,qt=/\d\d?/,Rt=/\d{1,3}/,Ht=/\d{1,4}/,Vt=/[+\-]?\d{1,6}/,zt=/\d+/,Bt=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,jt=/Z|[\+\-]\d\d:?\d\d/gi,Gt=/T/i,Kt=/[\+\-]?\d+/,Zt=/[\+\-]?\d+(\.\d{1,3})?/,Jt=/\d/,Xt=/\d\d/,Qt=/\d{3}/,en=/\d{4}/,tn=/[+-]?\d{6}/,nn=/[+-]?\d+/,sn=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,an="YYYY-MM-DDTHH:mm:ssZ",rn=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],on=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],ln=/([\+\-]|\d\d)/gi,cn=("Date|Hours|Minutes|Seconds|Milliseconds".split("|"),{Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6}),dn={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",Q:"quarter",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},un={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},pn={},hn={s:45,m:45,h:22,d:26,M:11},fn="DDD w W M D d".split(" "),mn="M D H h m s w W".split(" "),vn={M:function(){return this.month()+1},MMM:function(e){return this.localeData().monthsShort(this,e)},MMMM:function(e){return this.localeData().months(this,e)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(e){return this.localeData().weekdaysMin(this,e)},ddd:function(e){return this.localeData().weekdaysShort(this,e)},dddd:function(e){return this.localeData().weekdays(this,e)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return m(this.year()%100,2)},YYYY:function(){return m(this.year(),4)},YYYYY:function(){return m(this.year(),5)},YYYYYY:function(){var e=this.year(),t=e>=0?"+":"-";return t+m(Math.abs(e),6)},gg:function(){return m(this.weekYear()%100,2)},gggg:function(){return m(this.weekYear(),4)},ggggg:function(){return m(this.weekYear(),5)},GG:function(){return m(this.isoWeekYear()%100,2)},GGGG:function(){return m(this.isoWeekYear(),4)},GGGGG:function(){return m(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.localeData().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.localeData().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return S(this.milliseconds()/100)},SS:function(){return m(S(this.milliseconds()/10),2)},SSS:function(){return m(this.milliseconds(),3)},SSSS:function(){return m(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";return 0>e&&(e=-e,t="-"),t+m(S(e/60),2)+":"+m(S(e)%60,2)},ZZ:function(){var e=-this.zone(),t="+";return 0>e&&(e=-e,t="-"),t+m(S(e/60),2)+m(S(e)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},x:function(){return this.valueOf()},X:function(){return this.unix()},Q:function(){return this.quarter()}},gn={},yn=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];fn.length;)Mt=fn.pop(),vn[Mt+"o"]=l(vn[Mt],Mt);for(;mn.length;)Mt=mn.pop(),vn[Mt+Mt]=o(vn[Mt],2);vn.DDDD=o(vn.DDD,3),p(c.prototype,{set:function(e){var t,n;for(n in e)t=e[n],"function"==typeof t?this[n]=t:this["_"+n]=t;this._ordinalParseLenient=new RegExp(this._ordinalParse.source+"|"+/\d{1,2}/.source)},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(e){return this._months[e.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(e){return this._monthsShort[e.month()]},monthsParse:function(e,t,n){var s,a,i;for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),s=0;12>s;s++){if(a=Dt.utc([2e3,s]),n&&!this._longMonthsParse[s]&&(this._longMonthsParse[s]=new RegExp("^"+this.months(a,"").replace(".","")+"$","i"),this._shortMonthsParse[s]=new RegExp("^"+this.monthsShort(a,"").replace(".","")+"$","i")),n||this._monthsParse[s]||(i="^"+this.months(a,"")+"|^"+this.monthsShort(a,""),this._monthsParse[s]=new RegExp(i.replace(".",""),"i")),n&&"MMMM"===t&&this._longMonthsParse[s].test(e))return s;if(n&&"MMM"===t&&this._shortMonthsParse[s].test(e))return s;if(!n&&this._monthsParse[s].test(e))return s}},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(e){return this._weekdays[e.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(e){return this._weekdaysShort[e.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(e){return this._weekdaysMin[e.day()]},weekdaysParse:function(e){var t,n,s;for(this._weekdaysParse||(this._weekdaysParse=[]),t=0;7>t;t++)if(this._weekdaysParse[t]||(n=Dt([2e3,1]).day(t),s="^"+this.weekdays(n,"")+"|^"+this.weekdaysShort(n,"")+"|^"+this.weekdaysMin(n,""),this._weekdaysParse[t]=new RegExp(s.replace(".",""),"i")),this._weekdaysParse[t].test(e))return t},_longDateFormat:{LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY LT",LLLL:"dddd, MMMM D, YYYY LT"},longDateFormat:function(e){var t=this._longDateFormat[e];return!t&&this._longDateFormat[e.toUpperCase()]&&(t=this._longDateFormat[e.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e]=t),t},isPM:function(e){return"p"===(e+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(e,t,n){var s=this._calendar[e];return"function"==typeof s?s.apply(t,[n]):s},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(e,t,n,s){var a=this._relativeTime[n];return"function"==typeof a?a(e,t,n,s):a.replace(/%d/i,e)},pastFuture:function(e,t){var n=this._relativeTime[e>0?"future":"past"];return"function"==typeof n?n(t):n.replace(/%s/i,t)},ordinal:function(e){return this._ordinal.replace("%d",e)},_ordinal:"%d",_ordinalParse:/\d{1,2}/,preparse:function(e){return e},postformat:function(e){return e},week:function(e){return ot(e,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),Dt=function(t,n,a,i){var r;return"boolean"==typeof a&&(i=a,a=e),r={},r._isAMomentObject=!0,r._i=t,r._f=n,r._l=a,r._strict=i,r._isUTC=!1,r._pf=s(),ct(r)},Dt.suppressDeprecationWarnings=!1,Dt.createFromInputFallback=i("moment construction falls back to js Date. This is discouraged and will be removed in upcoming major release. Please refer to https://github.com/moment/moment/issues/1407 for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),Dt.min=function(){var e=[].slice.call(arguments,0);return dt("isBefore",e)},Dt.max=function(){var e=[].slice.call(arguments,0);return dt("isAfter",e)},Dt.utc=function(t,n,a,i){var r;return"boolean"==typeof a&&(i=a,a=e),r={},r._isAMomentObject=!0,r._useUTC=!0,r._isUTC=!0,r._l=a,r._i=t,r._f=n,r._strict=i,r._pf=s(),ct(r).utc()},Dt.unix=function(e){return Dt(1e3*e)},Dt.duration=function(e,t){var s,a,i,r,o=e,l=null;return Dt.isDuration(e)?o={ms:e._milliseconds,d:e._days,M:e._months}:"number"==typeof e?(o={},t?o[t]=e:o.milliseconds=e):(l=Ft.exec(e))?(s="-"===l[1]?-1:1,o={y:0,d:S(l[Nt])*s,h:S(l[Et])*s,m:S(l[Tt])*s,s:S(l[xt])*s,ms:S(l[At])*s}):(l=Wt.exec(e))?(s="-"===l[1]?-1:1,i=function(e){var t=e&&parseFloat(e.replace(",","."));return(isNaN(t)?0:t)*s},o={y:i(l[2]),M:i(l[3]),d:i(l[4]),h:i(l[5]),m:i(l[6]),s:i(l[7]),w:i(l[8])}):"object"==typeof o&&("from"in o||"to"in o)&&(r=g(Dt(o.from),Dt(o.to)),o={},o.ms=r.milliseconds,o.M=r.months),a=new u(o),Dt.isDuration(e)&&n(e,"_locale")&&(a._locale=e._locale),a},Dt.version=bt,Dt.defaultFormat=an,Dt.ISO_8601=function(){},Dt.momentProperties=Pt,Dt.updateOffset=function(){},Dt.relativeTimeThreshold=function(t,n){return hn[t]===e?!1:n===e?hn[t]:(hn[t]=n,!0)},Dt.lang=i("moment.lang is deprecated. Use moment.locale instead.",function(e,t){return Dt.locale(e,t)}),Dt.locale=function(e,t){var n;return e&&(n="undefined"!=typeof t?Dt.defineLocale(e,t):Dt.localeData(e),n&&(Dt.duration._locale=Dt._locale=n)),Dt._locale._abbr},Dt.defineLocale=function(e,t){return null!==t?(t.abbr=e,It[e]||(It[e]=new c),It[e].set(t),Dt.locale(e),It[e]):(delete It[e],null)},Dt.langData=i("moment.langData is deprecated. Use moment.localeData instead.",function(e){return Dt.localeData(e)}),Dt.localeData=function(e){var t;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return Dt._locale;if(!_(e)){if(t=Y(e))return t;e=[e]}return P(e)},Dt.isMoment=function(e){return e instanceof d||null!=e&&n(e,"_isAMomentObject")},Dt.isDuration=function(e){return e instanceof u};for(Mt=yn.length-1;Mt>=0;--Mt)k(yn[Mt]);Dt.normalizeUnits=function(e){return w(e)},Dt.invalid=function(e){var t=Dt.utc(0/0);return null!=e?p(t._pf,e):t._pf.userInvalidated=!0,t},Dt.parseZone=function(){return Dt.apply(null,arguments).parseZone()},Dt.parseTwoDigitYear=function(e){return S(e)+(S(e)>68?1900:2e3)},p(Dt.fn=d.prototype,{clone:function(){return Dt(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var e=Dt(this).utc();return 0<e.year()&&e.year()<=9999?"function"==typeof Date.prototype.toISOString?this.toDate().toISOString():$(e,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):$(e,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds()]},isValid:function(){return A(this)},isDSTShifted:function(){return this._a?this.isValid()&&b(this._a,(this._isUTC?Dt.utc(this._a):Dt(this._a)).toArray())>0:!1},parsingFlags:function(){return p({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(e){return this.zone(0,e)},local:function(e){return this._isUTC&&(this.zone(0,e),this._isUTC=!1,e&&this.add(this._dateTzOffset(),"m")),this},format:function(e){var t=$(this,e||Dt.defaultFormat);return this.localeData().postformat(t)},add:y(1,"add"),subtract:y(-1,"subtract"),diff:function(e,t,n){var s,a,i,r=L(e,this),o=6e4*(this.zone()-r.zone());return t=w(t),"year"===t||"month"===t?(s=432e5*(this.daysInMonth()+r.daysInMonth()),a=12*(this.year()-r.year())+(this.month()-r.month()),i=this-Dt(this).startOf("month")-(r-Dt(r).startOf("month")),i-=6e4*(this.zone()-Dt(this).startOf("month").zone()-(r.zone()-Dt(r).startOf("month").zone())),a+=i/s,"year"===t&&(a/=12)):(s=this-r,a="second"===t?s/1e3:"minute"===t?s/6e4:"hour"===t?s/36e5:"day"===t?(s-o)/864e5:"week"===t?(s-o)/6048e5:s),n?a:f(a)},from:function(e,t){return Dt.duration({to:this,from:e}).locale(this.locale()).humanize(!t)},fromNow:function(e){return this.from(Dt(),e)},calendar:function(e){var t=e||Dt(),n=L(t,this).startOf("day"),s=this.diff(n,"days",!0),a=-6>s?"sameElse":-1>s?"lastWeek":0>s?"lastDay":1>s?"sameDay":2>s?"nextDay":7>s?"nextWeek":"sameElse";return this.format(this.localeData().calendar(a,this,Dt(t)))},isLeapYear:function(){return T(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(e=at(e,this.localeData()),this.add(e-t,"d")):t},month:ft("Month",!0),startOf:function(e){switch(e=w(e)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e?this.weekday(0):"isoWeek"===e&&this.isoWeekday(1),"quarter"===e&&this.month(3*Math.floor(this.month()/3)),this},endOf:function(t){return t=w(t),t===e||"millisecond"===t?this:this.startOf(t).add(1,"isoWeek"===t?"week":t).subtract(1,"ms")},isAfter:function(e,t){var n;return t=w("undefined"!=typeof t?t:"millisecond"),"millisecond"===t?(e=Dt.isMoment(e)?e:Dt(e),+this>+e):(n=Dt.isMoment(e)?+e:+Dt(e),n<+this.clone().startOf(t))},isBefore:function(e,t){var n;return t=w("undefined"!=typeof t?t:"millisecond"),"millisecond"===t?(e=Dt.isMoment(e)?e:Dt(e),+e>+this):(n=Dt.isMoment(e)?+e:+Dt(e),+this.clone().endOf(t)<n)},isSame:function(e,t){var n;return t=w(t||"millisecond"),"millisecond"===t?(e=Dt.isMoment(e)?e:Dt(e),+this===+e):(n=+Dt(e),+this.clone().startOf(t)<=n&&n<=+this.clone().endOf(t))},min:i("moment().min is deprecated, use moment.min instead. https://github.com/moment/moment/issues/1548",function(e){return e=Dt.apply(null,arguments),this>e?this:e}),max:i("moment().max is deprecated, use moment.max instead. https://github.com/moment/moment/issues/1548",function(e){return e=Dt.apply(null,arguments),e>this?this:e}),zone:function(e,t){var n,s=this._offset||0;return null==e?this._isUTC?s:this._dateTzOffset():("string"==typeof e&&(e=R(e)),Math.abs(e)<16&&(e=60*e),!this._isUTC&&t&&(n=this._dateTzOffset()),this._offset=e,this._isUTC=!0,null!=n&&this.subtract(n,"m"),s!==e&&(!t||this._changeInProgress?D(this,Dt.duration(s-e,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,Dt.updateOffset(this,!0),this._changeInProgress=null)),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.zone(this._tzm):"string"==typeof this._i&&this.zone(this._i),this},hasAlignedHourOffset:function(e){return e=e?Dt(e).zone():0,(this.zone()-e)%60===0},daysInMonth:function(){return C(this.year(),this.month())},dayOfYear:function(e){var t=Ot((Dt(this).startOf("day")-Dt(this).startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")},quarter:function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},weekYear:function(e){var t=ot(this,this.localeData()._week.dow,this.localeData()._week.doy).year;return null==e?t:this.add(e-t,"y")},isoWeekYear:function(e){var t=ot(this,1,4).year;return null==e?t:this.add(e-t,"y")},week:function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},isoWeek:function(e){var t=ot(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},weekday:function(e){var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")},isoWeekday:function(e){return null==e?this.day()||7:this.day(this.day()%7?e:e-7)},isoWeeksInYear:function(){return N(this.year(),1,4)},weeksInYear:function(){var e=this.localeData()._week;return N(this.year(),e.dow,e.doy)},get:function(e){return e=w(e),this[e]()},set:function(e,t){return e=w(e),"function"==typeof this[e]&&this[e](t),this},locale:function(t){var n;return t===e?this._locale._abbr:(n=Dt.localeData(t),null!=n&&(this._locale=n),this)},lang:i("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(t){return t===e?this.localeData():this.locale(t)}),localeData:function(){return this._locale},_dateTzOffset:function(){return 15*Math.round(this._d.getTimezoneOffset()/15)}}),Dt.fn.millisecond=Dt.fn.milliseconds=ft("Milliseconds",!1),Dt.fn.second=Dt.fn.seconds=ft("Seconds",!1),Dt.fn.minute=Dt.fn.minutes=ft("Minutes",!1),Dt.fn.hour=Dt.fn.hours=ft("Hours",!0),Dt.fn.date=ft("Date",!0),Dt.fn.dates=i("dates accessor is deprecated. Use date instead.",ft("Date",!0)),Dt.fn.year=ft("FullYear",!0),Dt.fn.years=i("years accessor is deprecated. Use year instead.",ft("FullYear",!0)),Dt.fn.days=Dt.fn.day,Dt.fn.months=Dt.fn.month,Dt.fn.weeks=Dt.fn.week,Dt.fn.isoWeeks=Dt.fn.isoWeek,Dt.fn.quarters=Dt.fn.quarter,Dt.fn.toJSON=Dt.fn.toISOString,p(Dt.duration.fn=u.prototype,{_bubble:function(){var e,t,n,s=this._milliseconds,a=this._days,i=this._months,r=this._data,o=0;r.milliseconds=s%1e3,e=f(s/1e3),r.seconds=e%60,t=f(e/60),r.minutes=t%60,n=f(t/60),r.hours=n%24,a+=f(n/24),o=f(mt(a)),a-=f(vt(o)),i+=f(a/30),a%=30,o+=f(i/12),i%=12,r.days=a,r.months=i,r.years=o},abs:function(){return this._milliseconds=Math.abs(this._milliseconds),this._days=Math.abs(this._days),this._months=Math.abs(this._months),this._data.milliseconds=Math.abs(this._data.milliseconds),this._data.seconds=Math.abs(this._data.seconds),this._data.minutes=Math.abs(this._data.minutes),this._data.hours=Math.abs(this._data.hours),this._data.months=Math.abs(this._data.months),this._data.years=Math.abs(this._data.years),this},weeks:function(){return f(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*S(this._months/12)},humanize:function(e){var t=rt(this,!e,this.localeData());return e&&(t=this.localeData().pastFuture(+this,t)),this.localeData().postformat(t)},add:function(e,t){var n=Dt.duration(e,t);return this._milliseconds+=n._milliseconds,this._days+=n._days,this._months+=n._months,this._bubble(),this},subtract:function(e,t){var n=Dt.duration(e,t);return this._milliseconds-=n._milliseconds,this._days-=n._days,this._months-=n._months,this._bubble(),this},get:function(e){return e=w(e),this[e.toLowerCase()+"s"]()},as:function(e){var t,n;if(e=w(e),"month"===e||"year"===e)return t=this._days+this._milliseconds/864e5,n=this._months+12*mt(t),"month"===e?n:n/12;switch(t=this._days+Math.round(vt(this._months/12)),e){case"week":return t/7+this._milliseconds/6048e5;case"day":return t+this._milliseconds/864e5;case"hour":return 24*t+this._milliseconds/36e5;case"minute":return 24*t*60+this._milliseconds/6e4;case"second":return 24*t*60*60+this._milliseconds/1e3;
case"millisecond":return Math.floor(24*t*60*60*1e3)+this._milliseconds;default:throw new Error("Unknown unit "+e)}},lang:Dt.fn.lang,locale:Dt.fn.locale,toIsoString:i("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",function(){return this.toISOString()}),toISOString:function(){var e=Math.abs(this.years()),t=Math.abs(this.months()),n=Math.abs(this.days()),s=Math.abs(this.hours()),a=Math.abs(this.minutes()),i=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(e?e+"Y":"")+(t?t+"M":"")+(n?n+"D":"")+(s||a||i?"T":"")+(s?s+"H":"")+(a?a+"M":"")+(i?i+"S":""):"P0D"},localeData:function(){return this._locale}}),Dt.duration.fn.toString=Dt.duration.fn.toISOString;for(Mt in cn)n(cn,Mt)&&gt(Mt.toLowerCase());Dt.duration.fn.asMilliseconds=function(){return this.as("ms")},Dt.duration.fn.asSeconds=function(){return this.as("s")},Dt.duration.fn.asMinutes=function(){return this.as("m")},Dt.duration.fn.asHours=function(){return this.as("h")},Dt.duration.fn.asDays=function(){return this.as("d")},Dt.duration.fn.asWeeks=function(){return this.as("weeks")},Dt.duration.fn.asMonths=function(){return this.as("M")},Dt.duration.fn.asYears=function(){return this.as("y")},Dt.locale("en",{ordinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10,n=1===S(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th";return e+n}}),Yt?module.exports=Dt:"function"==typeof define&&define.amd?(define("moment",["require","exports","module"],function(e,t,n){return n.config&&n.config()&&n.config().noGlobal===!0&&(wt.moment=_t),Dt}),yt(!0)):yt()}).call(this);var Showdown={extensions:{}},forEach=Showdown.forEach=function(e,t){if("function"==typeof e.forEach)e.forEach(t);else{var n,s=e.length;for(n=0;s>n;n++)t(e[n],n,e)}},stdExtName=function(e){return e.replace(/[_-]||\s/g,"").toLowerCase()};Showdown.converter=function(e){var t,n,s,a=0,i=[],r=[];if("undefind"!=typeof module&&"undefined"!=typeof exports&&"undefind"!=typeof require){var o=require("fs");if(o){var l=o.readdirSync((__dirname||".")+"/extensions").filter(function(e){return~e.indexOf(".js")}).map(function(e){return e.replace(/\.js$/,"")});Showdown.forEach(l,function(e){var t=stdExtName(e);Showdown.extensions[t]=require("./extensions/"+e)})}}if(this.makeHtml=function(e){return t={},n={},s=[],e=e.replace(/~/g,"~T"),e=e.replace(/\$/g,"~D"),e=e.replace(/\r\n/g,"\n"),e=e.replace(/\r/g,"\n"),e="\n\n"+e+"\n\n",e=W(e),e=e.replace(/^[ \t]+$/gm,""),Showdown.forEach(i,function(t){e=u(t,e)}),e=k(e),e=h(e),e=p(e),e=m(e),e=L(e),e=e.replace(/~D/g,"$$"),e=e.replace(/~T/g,"~"),Showdown.forEach(r,function(t){e=u(t,e)}),e},e&&e.extensions){var c=this;Showdown.forEach(e.extensions,function(e){if("string"==typeof e&&(e=Showdown.extensions[stdExtName(e)]),"function"!=typeof e)throw"Extension '"+e+"' could not be loaded.  It was either not found or is not a valid extension.";Showdown.forEach(e(c),function(e){e.type?"language"===e.type||"lang"===e.type?i.push(e):("output"===e.type||"html"===e.type)&&r.push(e):r.push(e)})})}var d,u=function(e,t){if(e.regex){var n=new RegExp(e.regex,"g");return t.replace(n,e.replace)}return e.filter?e.filter(t):void 0},p=function(e){return e+="~0",e=e.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|(?=~0))/gm,function(e,s,a,i,r){return s=s.toLowerCase(),t[s]=A(a),i?i+r:(r&&(n[s]=r.replace(/"/g,"&quot;")),"")}),e=e.replace(/~0/,"")},h=function(e){e=e.replace(/\n/g,"\n\n");return e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,f),e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|style|section|header|footer|nav|article|aside)\b[^\r]*?<\/\2>[ \t]*(?=\n+)\n)/gm,f),e=e.replace(/(\n[ ]{0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,f),e=e.replace(/(\n\n[ ]{0,3}<!(--[^\r]*?--\s*)+>[ \t]*(?=\n{2,}))/g,f),e=e.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,f),e=e.replace(/\n\n/g,"\n")},f=function(e,t){var n=t;return n=n.replace(/\n\n/g,"\n"),n=n.replace(/^\n/,""),n=n.replace(/\n+$/g,""),n="\n\n~K"+(s.push(n)-1)+"K\n\n"},m=function(e){e=b(e);var t=S("<hr />");return e=e.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,t),e=e.replace(/^[ ]{0,2}([ ]?\-[ ]?){3,}[ \t]*$/gm,t),e=e.replace(/^[ ]{0,2}([ ]?\_[ ]?){3,}[ \t]*$/gm,t),e=w(e),e=O(e),e=T(e),e=h(e),e=x(e)},v=function(e){return e=C(e),e=g(e),e=I(e),e=_(e),e=y(e),e=P(e),e=A(e),e=E(e),e=e.replace(/  +\n/g," <br />\n")},g=function(e){var t=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--.*?--\s*)+>)/gi;return e=e.replace(t,function(e){var t=e.replace(/(.)<\/?code>(?=.)/g,"$1`");return t=$(t,"\\`*_")})},y=function(e){return e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,D),e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?(.*?(?:\(.*?\).*?)?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,D),e=e.replace(/(\[([^\[\]]+)\])()()()()()/g,D)},D=function(e,s,a,i,r,o,l,c){void 0==c&&(c="");var d=s,u=a,p=i.toLowerCase(),h=r,f=c;if(""==h)if(""==p&&(p=u.toLowerCase().replace(/ ?\n/g," ")),h="#"+p,void 0!=t[p])h=t[p],void 0!=n[p]&&(f=n[p]);else{if(!(d.search(/\(\s*\)$/m)>-1))return d;h=""}h=$(h,"*_");var m='<a href="'+h+'"';return""!=f&&(f=f.replace(/"/g,"&quot;"),f=$(f,"*_"),m+=' title="'+f+'"'),m+=">"+u+"</a>"},_=function(e){return e=e.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,M),e=e.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,M)},M=function(e,s,a,i,r,o,l,c){var d=s,u=a,p=i.toLowerCase(),h=r,f=c;if(f||(f=""),""==h){if(""==p&&(p=u.toLowerCase().replace(/ ?\n/g," ")),h="#"+p,void 0==t[p])return d;h=t[p],void 0!=n[p]&&(f=n[p])}u=u.replace(/"/g,"&quot;"),h=$(h,"*_");var m='<img src="'+h+'" alt="'+u+'"';return f=f.replace(/"/g,"&quot;"),f=$(f,"*_"),m+=' title="'+f+'"',m+=" />"},b=function(e){function t(e){return e.replace(/[^\w]/g,"").toLowerCase()}return e=e.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(e,n){return S('<h1 id="'+t(n)+'">'+v(n)+"</h1>")}),e=e.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(e,n){return S('<h2 id="'+t(n)+'">'+v(n)+"</h2>")}),e=e.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(e,n,s){var a=n.length;return S("<h"+a+' id="'+t(s)+'">'+v(s)+"</h"+a+">")})},w=function(e){e+="~0";var t=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return a?e=e.replace(t,function(e,t,n){var s=t,a=n.search(/[*+-]/g)>-1?"ul":"ol";s=s.replace(/\n{2,}/g,"\n\n\n");var i=d(s);return i=i.replace(/\s+$/,""),i="<"+a+">"+i+"</"+a+">\n"}):(t=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,e=e.replace(t,function(e,t,n,s){var a=t,i=n,r=s.search(/[*+-]/g)>-1?"ul":"ol",i=i.replace(/\n{2,}/g,"\n\n\n"),o=d(i);return o=a+"<"+r+">\n"+o+"</"+r+">\n"})),e=e.replace(/~0/,"")};d=function(e){return a++,e=e.replace(/\n{2,}$/,"\n"),e+="~0",e=e.replace(/(\n)?(^[ \t]*)([*+-]|\d+[.])[ \t]+([^\r]+?(\n{1,2}))(?=\n*(~0|\2([*+-]|\d+[.])[ \t]+))/gm,function(e,t,n,s,a){var i=a,r=t;return r||i.search(/\n{2,}/)>-1?i=m(F(i)):(i=w(F(i)),i=i.replace(/\n$/,""),i=v(i)),"<li>"+i+"</li>\n"}),e=e.replace(/~0/g,""),a--,e};var O=function(e){return e+="~0",e=e.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(e,t,n){var s=t,a=n;return s=N(F(s)),s=W(s),s=s.replace(/^\n+/g,""),s=s.replace(/\n+$/g,""),s="<pre><code>"+s+"\n</code></pre>",S(s)+a}),e=e.replace(/~0/,"")},k=function(e){return e+="~0",e=e.replace(/(?:^|\n)```(.*)\n([\s\S]*?)\n```/g,function(e,t,n){var s=t,a=n;return a=N(a),a=W(a),a=a.replace(/^\n+/g,""),a=a.replace(/\n+$/g,""),a="<pre><code"+(s?' class="'+s+'"':"")+">"+a+"\n</code></pre>",S(a)}),e=e.replace(/~0/,"")},S=function(e){return e=e.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(s.push(e)-1)+"K\n\n"},C=function(e){return e=e.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(e,t,n,s){var a=s;return a=a.replace(/^([ \t]*)/g,""),a=a.replace(/[ \t]*$/g,""),a=N(a),t+"<code>"+a+"</code>"})},N=function(e){return e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=$(e,"*_{}[]\\",!1)},E=function(e){return e=e.replace(/(\*\*|__)(?=\S)([^\r]*?\S[*_]*)\1/g,"<strong>$2</strong>"),e=e.replace(/(\*|_)(?=\S)([^\r]*?\S)\1/g,"<em>$2</em>")},T=function(e){return e=e.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(e,t){var n=t;return n=n.replace(/^[ \t]*>[ \t]?/gm,"~0"),n=n.replace(/~0/g,""),n=n.replace(/^[ \t]+$/gm,""),n=m(n),n=n.replace(/(^|\n)/g,"$1  "),n=n.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(e,t){var n=t;return n=n.replace(/^  /gm,"~0"),n=n.replace(/~0/g,"")}),S("<blockquote>\n"+n+"\n</blockquote>")})},x=function(e){e=e.replace(/^\n+/g,""),e=e.replace(/\n+$/g,"");for(var t=e.split(/\n{2,}/g),n=[],a=t.length,i=0;a>i;i++){var r=t[i];r.search(/~K(\d+)K/g)>=0?n.push(r):r.search(/\S/)>=0&&(r=v(r),r=r.replace(/^([ \t]*)/g,"<p>"),r+="</p>",n.push(r))}a=n.length;for(var i=0;a>i;i++)for(;n[i].search(/~K(\d+)K/)>=0;){var o=s[RegExp.$1];o=o.replace(/\$/g,"$$$$"),n[i]=n[i].replace(/~K\d+K/,o)}return n.join("\n\n")},A=function(e){return e=e.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),e=e.replace(/<(?![a-z\/?\$!])/gi,"&lt;")},I=function(e){return e=e.replace(/\\(\\)/g,U),e=e.replace(/\\([`*_{}\[\]()>#+-.!])/g,U)},P=function(e){return e=e.replace(/<((https?|ftp|dict):[^'">\s]+)>/gi,'<a href="$1">$1</a>'),e=e.replace(/<(?:mailto:)?([-.\w]+\@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,function(e,t){return Y(L(t))})},Y=function(e){var t=[function(e){return"&#"+e.charCodeAt(0)+";"},function(e){return"&#x"+e.charCodeAt(0).toString(16)+";"},function(e){return e}];return e="mailto:"+e,e=e.replace(/./g,function(e){if("@"==e)e=t[Math.floor(2*Math.random())](e);else if(":"!=e){var n=Math.random();e=n>.9?t[2](e):n>.45?t[1](e):t[0](e)}return e}),e='<a href="'+e+'">'+e+"</a>",e=e.replace(/">.+:/g,'">')},L=function(e){return e=e.replace(/~E(\d+)E/g,function(e,t){var n=parseInt(t);return String.fromCharCode(n)})},F=function(e){return e=e.replace(/^(\t|[ ]{1,4})/gm,"~0"),e=e.replace(/~0/g,"")},W=function(e){return e=e.replace(/\t(?=\t)/g,"    "),e=e.replace(/\t/g,"~A~B"),e=e.replace(/~B(.+?)~A/g,function(e,t){for(var n=t,s=4-n.length%4,a=0;s>a;a++)n+=" ";return n}),e=e.replace(/~A/g,"    "),e=e.replace(/~B/g,"")},$=function(e,t,n){var s="(["+t.replace(/([\[\]\\])/g,"\\$1")+"])";n&&(s="\\\\"+s);var a=new RegExp(s,"g");return e=e.replace(a,U)},U=function(e,t){var n=t.charCodeAt(0);return"~E"+n+"E"}},"undefined"!=typeof module&&(module.exports=Showdown),"function"==typeof define&&define.amd&&define("showdown",[],function(){return Showdown}),define("curriculumContextView",["react","immutable","showdown"],function(e,t,n){_options={};var s,a,i,r,o,l=function(e){return _options=e,c("curriculum"===_options.host?_options:_options)},c=e.createClass({componentWillMount:function(){var e=this;"curriculum"===_options.host?require(["curriculumSettings","curriculumUtils","curriculumItems","plannerStore","plannerWidget","curriculumActions"],function(t,n,l,c,d,u){s=t,a=n,i=l,r=c,o=d,Actions=u,e.setState({addFieldState:i.getFieldState(),item:i.get(e.props.itemID),showPlanner:i.getShowPlanner()},function(){i.on("change",this._onChange);OC.utils.menu(e.getDOMNode().querySelector("nav.planner-menu"),e.refs.addToPlanner.getDOMNode(),!0)})}):require(["plannerActions"],function(){})},componentDidMount:function(){var e,t=this;if("curriculum"===_options.host){var n=this.getDOMNode().querySelector(".explorer-resource-module-support-title"),s=this.getDOMNode().querySelector(".explorer-resource-module-support-contents"),a=this.getDOMNode().querySelector(".explorer-resource-module-support-pre");e=function(){s.style.height=parseInt(OC.$.css(t.getDOMNode(),"height"),10)-parseInt(OC.$.css(n,"height"),10)-2*parseInt(OC.$.css(n,"paddingTop"),10)-parseInt(OC.$.css(a,"height"),10)-parseInt(OC.$.css(s,"paddingTop"),10)-4*parseInt(OC.$.css(document.querySelector(".explorer-resource-module-main"),"marginTop"),10)+"px"},this.refs.addToPlanner&&OC.utils.tip(this.refs.addToPlanner.getDOMNode()),this.refs.delete&&OC.utils.tip(this.refs.delete.getDOMNode())}else e=function(){};e(),window.addEventListener("resize",e)},getInitialState:function(){return{addFieldState:!1,newFieldName:null,newFieldType:"text",item:"curriculum"===_options.host?null:this.props.item,showPlanner:!1}},componentWillUnmount:function(){i&&i.removeListener("change",this._onChange)},_onChange:function(){this.setState({addFieldState:i.getFieldState(),item:i.getSelected(),showPlanner:i.getShowPlanner()})},deleteItem:function(){Actions.deleteItem(this.props.itemID)},moveMetaTo:function(e,t,n,s,a,r){Actions.moveField(e,parseInt(t,10),this.state.item.get("id"),a,r?!0:!1),Actions.moveFieldSave(this.state.item.get("id"),i.getMetaToShift())},makeDraggable:function(e,t,n,s){function i(t,n,a){var i=OC.$.parents(e,"explorer-resource-module-support-section");s?i.id="meta-"+t:i.attr.id="resources-"+t,a.id=-1!==a.id.indexOf("meta")?"meta-"+n:"resources-"+n}var r,o=this;a.itemDraggable(e,"explorer-resource-module-support-body","explorer-resource-module-support-section",t,function(e){-1!==e.id.indexOf("meta")?o.moveMetaTo(n,e.id.substring(5),o.props.item,null,s,!0,i,e):(r=e.id.substring(10),o.moveMetaTo(n,r,o.props.item,null,s,!1,i,e)),o.forceUpdate()})},renderSections:function(){var e=(this.props,this),t=this.state.item.get("meta")?this.state.item.get("meta").length:0;if(t>0||this.state.item.get("resource_sets").length>0){var n=this.state.item.get("meta").concat(this.state.item.get("resource_sets")).map(function(t,n){return t.hasOwnProperty("slug")?{key:t.slug,index:n,title:t.hasOwnProperty("title")?t.title:"(Unnamed)",body:t.body,item:e.state.item,position:t.position,makeDraggable:e.makeDraggable}:{key:t.id?t.id:0,id:t.id,collection:t.resources,title:t.title,item:e.state.item,parent:e.state.item.get("parent"),position:t.position,makeDraggable:e.makeDraggable}});return n.sort(function(e,t){return e.position-t.position}).map(function(e){return e.hasOwnProperty("index")?d(e):u(e)})}return null},addField:function(){this.setState({addFieldState:!0},function(){this.refs.newFieldInput.getDOMNode().focus()})},cancelAddField:function(){this.setState({addFieldState:!1})},completeAddField:function(){var e=OC.$.max(this.state.item.get("resource_sets").concat(this.state.item.get("meta")),function(e){return e.position}),t=e?e.position:0,n=this;Actions.addField(this.state.newFieldName,this.state.newFieldType,t+1,this.state.item.get("id")),Actions.addFieldPost(i.get(n.state.item.get("id")),i.getUnsavedField(n.state.item.get("id")),function(e,t){"resources"===n.state.newFieldType?Actions.addFieldComplete(e,t):Actions.addFieldComplete()})},updateNewFieldTitle:function(e){this.setState({newFieldName:e.target.value})},updateNewFieldType:function(e){this.setState({newFieldType:e.target.value})},togglePlanner:function(){Actions.launchPlanner()},render:function(){var t=e.DOM.div({className:"explorer-resource-add-field"},[e.DOM.div({className:"explorer-resource-add-field-title",key:0},"New field"),e.DOM.div({className:"explorer-resource-add-field-name-wrapper",key:1},e.DOM.input({className:"explorer-resource-add-field-name",ref:"newFieldInput",type:"text",placeholder:"Name",onBlur:this.updateNewFieldTitle})),e.DOM.select({className:"explorer-resource-add-field-type",key:2,placeholder:"Type",onBlur:this.updateNewFieldType},[e.DOM.option({key:0,value:"text"},"Text"),e.DOM.option({key:1,value:"resources"},"Resources"),e.DOM.option({key:2,value:"standards"},"Standards")]),e.DOM.div({className:"explorer-resource-add-field-actions",key:3},[e.DOM.button({className:"explorer-dull-button explorer-resource-add-section-action-cancel",onClick:this.cancelAddField},"Cancel"),e.DOM.button({className:"explorer-button",onClick:this.completeAddField},"Finish")])]);return e.DOM.div({className:"explorer-resource-module-support-body pseudo-card",style:{height:"100%"}},[e.DOM.div({className:"explorer-resource-module-support-pre card-toolbar",style:{backgroundColor:_options.hasOwnProperty("palette")?OC.utils.palettes[_options.palette].dark:OC.config.palette.dark}},[OC.config.user.id&&"curriculum"===_options.host?e.DOM.div({className:"explorer-resource-module-support-pre-planner "+OC.config.palette.title+"-button",ref:"addToPlanner",title:"Add to Planner",onClick:this.togglePlanner}):null,OC.config.user.id&&this.state.item&&"curriculum"===_options.host?o.Widget({open:this.state.showPlanner,id:this.state.item.get("id")},{cancelEventSelect:function(){Actions.clearEventSelection()},confirmEventSelect:function(e,t){Actions.confirmAddItemToEvent(e,t),Actions.brighten()},dateSelect:function(e){Actions.selectDate(e)},eventSelect:function(e,t){Actions.selectPlannerEvent(e,t)}}):null,s&&s.getCanEdit()?e.DOM.div({className:"explorer-resource-module-support-delete "+OC.config.palette.title+"-button",ref:"delete",title:"Delete",onClick:this.deleteItem}):null]),e.DOM.div({className:"explorer-resource-module-support-title",style:{backgroundColor:_options.hasOwnProperty("palette")?OC.utils.palettes[_options.palette].base:OC.config.palette.base},key:0},this.state.item?this.state.item.get("description"):null),e.DOM.div({className:"explorer-resource-module-support-contents"},[e.DOM.div({className:"explorer-resource-module-support-sections",key:1},this.state.item?this.renderSections():null),s&&s.getCanEdit()?this.state.addFieldState?t:e.DOM.div({className:"explorer-resource-module-support-new-field",onClick:this.addField,key:3},"+ ADD FIELD"):null])])}}),d=e.createClass({getInitialState:function(){return{body:this.props.body,showMenu:!1}},componentDidMount:function(){function e(){this.textContent?this.setAttribute("data-div-placeholder-content","true"):this.removeAttribute("data-div-placeholder-content")}var t=this,n=["change keydown keypress input"];n.forEach(function(n){OC.$.addListener(t.getDOMNode().querySelector("*[data-placeholder]"),n,e)});var a=this.getDOMNode().querySelector(".explorer-resource-module-support-section-handle");if(a&&this.props.makeDraggable(a,this.props.title,this.props.index,!0),s&&s.getCanEdit()){var i=this.refs.actions.getDOMNode();OC.$.addClass(i,"show");var r=OC.utils.menu(this.getDOMNode().querySelector("nav.field-menu"),i);OC.$.removeClass(i,"show"),this.setState({menuPosition:r})}},componentWillReceiveProps:function(e){this.setState({body:e.body})},componentDidUpdate:function(){},save:function(e){if(newValue=e.target.innerHTML,currentMetas=this.props.item.get("meta"),this.setState({body:newValue}),currentMetas[this.props.key]!==newValue){OC.utils.status.saving();var t;for(t=0;t<currentMetas.length;t++)currentMetas[t].slug===this.props.key&&(currentMetas[t].body=newValue);Actions.updateItem({id:this.props.item.get("id"),meta:currentMetas},function(){OC.utils.status.saved()})}},toggleMenu:function(){this.state.showMenu||this.state.menuPosition.reset(),this.setState({showMenu:!this.state.showMenu},function(){if(this.state.showMenu){var e=this,t=document.querySelector("body");t.addEventListener("click",function n(s){e.getDOMNode()===s.target||e.getDOMNode().contains(s.target)||(e.setState({showMenu:!1}),t.removeEventListener("click",n))})}})},renderStandard:function(t){return e.DOM.div({className:"explorer-resource-module-support-section-body-field-snippet"},[e.DOM.span({className:"explorer-resource-module-support-section-body-standard"},t.title),e.DOM.span({},": "+t.description)])},render:function(){var t,a=null!==this.state.body&&"object"==typeof this.state.body&&"standards"==this.state.body.type,i=null!==this.state.body&&"object"==typeof this.state.body&&this.state.body.hideTitle;if(a)t=e.DOM.div({className:"explorer-resource-module-support-section-body"},this.state.body.standards.map(this.renderStandard));else{var r=new n.converter,o=i?this.state.body.body:this.state.body;t=e.DOM.div({className:"explorer-resource-module-support-section-body",contentEditable:s&&s.getCanEdit()?!0:!1,onBlur:this.save,"data-placeholder":o&&o.length>0?"":"(add something)",dangerouslySetInnerHTML:{__html:r.makeHtml(o&&o.length>0?r.makeHtml(o):"")},key:1})}return e.DOM.div({className:"explorer-resource-module-support-section explorer-resource-module-support-section-"+this.props.key,id:"meta-"+this.props.index},[e.DOM.div({className:"explorer-resource-module-support-section-handle-wrapper"},s&&s.getCanEdit()?e.DOM.div({className:"explorer-resource-module-support-section-handle"},null):null),i?null:e.DOM.div({className:"explorer-resource-module-support-section-title-wrapper"},e.DOM.div({className:"explorer-resource-module-support-section-title",key:0},this.props.title),t),s&&s.getCanEdit()?e.DOM.div({className:"explorer-resource-module-support-section-actions",onClick:this.toggleMenu,ref:"actions"},null):null,s&&s.getCanEdit()?p({open:this.state.showMenu,id:this.props.index,itemID:this.props.item.get("id"),meta:!0}):null])}}),u=e.createClass({getInitialState:function(){return{showMenu:!1}},_forceUpdate:function(){this.forceUpdate()},componentDidMount:function(){var e=this.getDOMNode().querySelector(".explorer-resource-module-support-section-handle");if(e&&this.props.makeDraggable(e,this.props.title?this.props.title:"Resources",this.props.id,!1),s&&s.getCanEdit()){var t=this.refs.actions.getDOMNode();OC.$.addClass(t,"show");var n=OC.utils.menu(this.getDOMNode().querySelector("nav.field-menu"),t);OC.$.removeClass(t,"show"),this.setState({menuPosition:n})}},componentWillMount:function(){},addResource:function(){var e=this;OC.utils.post({title:"Add a resource",message:"What would you like to add?",postTitle:"Add and finish",urlTitle:"Add a website URL",addMeta:!1,sent:e.resourceSent,callback:e.resourceAdded,urlPostURL:"/curriculum/api/section-item-resources/add-url/",existingPostURL:"/curriculum/api/section-item-resources/add-existing/",uploadPostURL:"/curriculum/api/section-item-resources/add-upload/",toAppendFormData:{section_item_id:this.props.item.get("id"),section_item_resources_id:this.props.id}})},resourceAdded:function(e,t){t.set(e.resource),OC.utils.status.saved()},resourceSent:function(e){OC.utils.status.saving();var n=t.Map(e);return Actions.addResource(n,this.props.id),n},suggest:function(){var e=this;suggestionsPopup=OC.customPopup(".explorer-suggest-resources-dialog");var t=$(".explorer-suggest-resources-body",suggestionsPopup.dialog),n=$(".explorer-suggest-resources-listing",t);n.removeClass("failure"),t.addClass("loading"),$.get("/curriculum/api/section-item/"+this.props.item.get("id")+"/suggest-resources/",function(s){if(n.html(""),"false"===s.status)n.addClass("failure"),n.html(s.message);else{OC.explorer.cachedResources=_.union(OC.explorer.cachedResources,s.resources);var a;_.each(s.resources,function(e){a=OC.explorer.suggestionTemplate(e),n.append(a)}),appendedResources=$(".explorer-suggest-resources-listing-item",n),$(".explorer-suggest-resources-listing-item-action-keep",appendedResources).click(e.keepResource),$(".explorer-suggest-resources-listing-item-action-hide",appendedResources).click(function(e){$(e.target).parents(".explorer-suggest-resources-listing-item").fadeOut("show")})}t.removeClass("loading")},"json")},keepResource:function(e){var t=$(e.target).parents(".explorer-suggest-resources-listing-item");resourceID=t.attr("id").substring(9);var n=(OC.explorer.cachedResources[resourceID],this),s={objective_id:this.props.id,resource_collection_ID:resourceID};$.post("/curriculum/api/section-item-resources/add-existing/",s,function(e){var t=new OC.explorer.Resource(e.resource);n.props.item.get("resources").push(t)},"json"),t.fadeOut("fast")},renderResource:function(e){return ResourceView({model:e,resourceSetID:this.props.id,key:e.get("id")})},toggleMenu:function(){this.state.showMenu||this.state.menuPosition.reset(),this.setState({showMenu:!this.state.showMenu},function(){if(this.state.showMenu){var e=this,t=document.querySelector("body");t.addEventListener("click",function n(s){e.getDOMNode()===s.target||e.getDOMNode().contains(s.target)||(e.setState({showMenu:!1}),t.removeEventListener("click",n))})}})},render:function(){return e.DOM.div({className:"explorer-resource-module-support-section explorer-resource-module-support-section-resources",id:"resources-"+this.props.id},[e.DOM.div({className:"explorer-resource-module-support-section-header"},[e.DOM.div({className:"explorer-resource-module-support-section-handle-wrapper"},s&&s.getCanEdit()?e.DOM.div({className:"explorer-resource-module-support-section-handle"},null):null),e.DOM.div({className:"explorer-resource-module-support-section-title-wrapper"},e.DOM.div({className:"explorer-resource-module-support-section-title",key:0},this.props.title?this.props.title:"Resources")),s&&s.getCanEdit()?e.DOM.div({className:"explorer-resource-module-support-section-actions",onClick:this.toggleMenu,ref:"actions"},null):null,s&&s.getCanEdit()?p({open:this.state.showMenu,id:this.props.id,meta:!1}):null]),this.props.collection.size>0?e.DOM.div({className:"explorer-resource-items",key:1},this.props.collection.map(this.renderResource).toJS()):null,this.props.parent?e.DOM.div({className:"explorer-resource-actions-suggest-wrapper"},e.DOM.button({className:"explorer-resource-actions-suggest",onClick:this.suggest,key:2},"SUGGEST MORE RESOURCES")):null,s&&s.getCanEdit()?e.DOM.div({className:"explorer-resource-listing-body-resource-actions",key:3},e.DOM.button({className:"explorer-resource-actions-add explorer-light-button",onClick:this.addResource},"+ Add resource")):null])}});ResourceView=e.createClass({removeResource:function(){OC.utils.status.saving(),Actions.removeResource(this.props.model.get("id"),this.props.resourceSetID,function(){OC.utils.status.saved()})},openSesame:function(e){return a.openResourcePreview(this.props.model.get("id"),this.props.model.get("title"),this.props.model.get("user_thumbnail"),this.props.model.get("url"),this.props.model.get("type")),e.stopPropagation(),e.preventDefault(),!1},render:function(){return e.DOM.div({className:"explorer-resource-item"},[e.DOM.div({className:"explorer-resource-item-thumbnail-wrapper",key:0},e.DOM.div({className:"explorer-resource-item-thumbnail",style:{backgroundImage:"url('"+this.props.model.get("thumbnail")+"')"}},e.DOM.div({className:"thumbnail-silhouette thumbnail-"+this.props.model.get("type")}))),e.DOM.div({className:"explorer-resource-item-content",key:1},[e.DOM.div({className:"explorer-resource-item-content-body",key:0},[e.DOM.div({className:"explorer-resource-item-content-title",key:0},e.DOM.a({href:this.props.model.get("url"),target:"_blank",onClick:-1!==["pdf","document","reference"].indexOf(this.props.model.get("type"))?this.openSesame:null},this.props.model.get("title"))),e.DOM.div({className:"explorer-resource-item-content-caption",key:1},"")]),s&&s.getCanEdit()?e.DOM.div({className:"explorer-resource-item-content-actions",key:1},e.DOM.div({className:"explorer-resource-item-content-action-delete",onClick:this.removeResource,title:"Remove resource"})):null])])}});var p=e.createClass({deleteField:function(){this.props.meta===!0?Actions.deleteMeta(this.props.id,this.props.itemID):Actions.deleteResourceSet(this.props.id)},render:function(){return e.DOM.nav({className:"oc-menu field-menu"+(this.props.open?" show-menu":"")},[e.DOM.div({className:"floating-menu-spacer"},null),e.DOM.ul({},e.DOM.li({},e.DOM.a({onClick:this.deleteField},"Delete field")))])}});return l}),!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("flux",[],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.Flux=e()}}(function(){return function e(t,n,s){function a(r,o){if(!n[r]){if(!t[r]){var l="function"==typeof require&&require;if(!o&&l)return l(r,!0);if(i)return i(r,!0);var c=new Error("Cannot find module '"+r+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[r]={exports:{}};t[r][0].call(d.exports,function(e){var n=t[r][1][e];return a(n?n:e)},d,d.exports,e,t,n,s)}return n[r].exports}for(var i="function"==typeof require&&require,r=0;r<s.length;r++)a(s[r]);return a}({1:[function(e,t){t.exports.Dispatcher=e("./lib/Dispatcher")},{"./lib/Dispatcher":2}],2:[function(e,t){function n(){this.$Dispatcher_callbacks={},this.$Dispatcher_isPending={},this.$Dispatcher_isHandled={},this.$Dispatcher_isDispatching=!1,this.$Dispatcher_pendingPayload=null}var s=e("./invariant"),a=1,i="ID_";n.prototype.register=function(e){var t=i+a++;return this.$Dispatcher_callbacks[t]=e,t},n.prototype.unregister=function(e){s(this.$Dispatcher_callbacks[e],"Dispatcher.unregister(...): `%s` does not map to a registered callback.",e),delete this.$Dispatcher_callbacks[e]},n.prototype.waitFor=function(e){s(this.$Dispatcher_isDispatching,"Dispatcher.waitFor(...): Must be invoked while dispatching.");for(var t=0;t<e.length;t++){var n=e[t];this.$Dispatcher_isPending[n]?s(this.$Dispatcher_isHandled[n],"Dispatcher.waitFor(...): Circular dependency detected while waiting for `%s`.",n):(s(this.$Dispatcher_callbacks[n],"Dispatcher.waitFor(...): `%s` does not map to a registered callback.",n),this.$Dispatcher_invokeCallback(n))}},n.prototype.dispatch=function(e){s(!this.$Dispatcher_isDispatching,"Dispatch.dispatch(...): Cannot dispatch in the middle of a dispatch."),this.$Dispatcher_startDispatching(e);try{for(var t in this.$Dispatcher_callbacks)this.$Dispatcher_isPending[t]||this.$Dispatcher_invokeCallback(t)}finally{this.$Dispatcher_stopDispatching()}},n.prototype.isDispatching=function(){return this.$Dispatcher_isDispatching},n.prototype.$Dispatcher_invokeCallback=function(e){this.$Dispatcher_isPending[e]=!0,this.$Dispatcher_callbacks[e](this.$Dispatcher_pendingPayload),this.$Dispatcher_isHandled[e]=!0},n.prototype.$Dispatcher_startDispatching=function(e){for(var t in this.$Dispatcher_callbacks)this.$Dispatcher_isPending[t]=!1,this.$Dispatcher_isHandled[t]=!1;this.$Dispatcher_pendingPayload=e,this.$Dispatcher_isDispatching=!0},n.prototype.$Dispatcher_stopDispatching=function(){this.$Dispatcher_pendingPayload=null,this.$Dispatcher_isDispatching=!1},t.exports=n},{"./invariant":3}],3:[function(e,t){var n=function(e,t,n,s,a,i,r,o){if(!e){var l;if(void 0===t)l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[n,s,a,i,r,o],d=0;l=new Error("Invariant Violation: "+t.replace(/%s/g,function(){return c[d++]}))}throw l.framesToPop=1,l}};t.exports=n},{}]},{},[1])(1)}),define("dispatcher",["flux"],function(e){var t=e.Dispatcher;return new t}),define("plannerActions",["dispatcher"],function(e){return{openItem:function(t){e.dispatch({type:"OPEN_ITEM",item:t})},closeItem:function(){e.dispatch({type:"CLOSE_ITEM"})}}}),define("events",[],function(){function e(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function t(e){return"function"==typeof e}function n(e){return"number"==typeof e}function s(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}return e.EventEmitter=e,e.prototype._events=void 0,e.prototype._maxListeners=void 0,e.defaultMaxListeners=10,e.prototype.setMaxListeners=function(e){if(!n(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},e.prototype.emit=function(e){var n,i,r,o,l,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if(n=arguments[1],n instanceof Error)throw n;throw TypeError('Uncaught, unspecified "error" event.')}if(i=this._events[e],a(i))return!1;if(t(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:for(r=arguments.length,o=new Array(r-1),l=1;r>l;l++)o[l-1]=arguments[l];i.apply(this,o)}else if(s(i)){for(r=arguments.length,o=new Array(r-1),l=1;r>l;l++)o[l-1]=arguments[l];for(c=i.slice(),r=c.length,l=0;r>l;l++)c[l].apply(this,o)}return!0
},e.prototype.addListener=function(n,i){var r;if(!t(i))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",n,t(i.listener)?i.listener:i),this._events[n]?s(this._events[n])?this._events[n].push(i):this._events[n]=[this._events[n],i]:this._events[n]=i,s(this._events[n])&&!this._events[n].warned&&(r=a(this._maxListeners)?e.defaultMaxListeners:this._maxListeners,r&&r>0&&this._events[n].length>r&&(this._events[n].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[n].length),"function"==typeof console.trace&&console.trace())),this},e.prototype.on=e.prototype.addListener,e.prototype.once=function(e,n){function s(){this.removeListener(e,s),a||(a=!0,n.apply(this,arguments))}if(!t(n))throw TypeError("listener must be a function");var a=!1;return s.listener=n,this.on(e,s),this},e.prototype.removeListener=function(e,n){var a,i,r,o;if(!t(n))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(a=this._events[e],r=a.length,i=-1,a===n||t(a.listener)&&a.listener===n)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,n);else if(s(a)){for(o=r;o-->0;)if(a[o]===n||a[o].listener&&a[o].listener===n){i=o;break}if(0>i)return this;1===a.length?(a.length=0,delete this._events[e]):a.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,n)}return this},e.prototype.removeAllListeners=function(e){var n,s;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(n in this._events)"removeListener"!==n&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events={},this}if(s=this._events[e],t(s))this.removeListener(e,s);else for(;s.length;)this.removeListener(e,s[s.length-1]);return delete this._events[e],this},e.prototype.listeners=function(e){var n;return n=this._events&&this._events[e]?t(this._events[e])?[this._events[e]]:this._events[e].slice():[]},e.listenerCount=function(e,n){var s;return s=e._events&&e._events[n]?t(e._events[n])?1:e._events[n].length:0},e}),define("deep_extend",[],function(){var e=function(){if(arguments.length<1||"object"!=typeof arguments[0])return!1;if(arguments.length<2)return arguments[0];var t,n,s,a,i=arguments[0],r=Array.prototype.slice.call(arguments,1);return r.forEach(function(r){if("object"==typeof r)for(t in r)t in r&&(s=i[t],n=r[t],n!==i&&("object"==typeof n&&null!==n?n instanceof Date?i[t]=new Date(n.getTime()):n instanceof RegExp?i[t]=new RegExp(n):"object"==typeof s&&null!==s?(a=Array.isArray(n)?Array.isArray(s)?s:[]:Array.isArray(s)?{}:s,i[t]=e(a,n)):(a=Array.isArray(n)?[]:{},i[t]=e(a,n)):i[t]=n))}),i};return e}),define("plannerStore",["dispatcher","events","deep_extend","immutable"],function(e,t,n,s){var a=t.EventEmitter,i="change",r=null,o=!1,l=s.Map(),c=null,d=!1,u=null,p=n(a.prototype,{emitPlannerChange:function(){this.emit(i)},addChangeListener:function(e){this.on(i,e)},removeChangeListener:function(e){this.removeListener(i,e)},getSelectedDate:function(){return r},getSelectedEvent:function(){return c},getEventsFor:function(e){var t=l.get(e);return t?t:[]},hasPendingLoad:function(){return o===!0},getDrawer:function(){return d},getItem:function(){return u},dispatchToken:e.register(function(e){switch(e.type){case"SELECT_DATE":r=e.date,o=!0;break;case"SELECT_DATE_COMPLETE":l=l.set(e.date,e.response),o=!1;break;case"SELECT_PLANNER_EVENT":var t,n;for(events=l.get(e.date),t=0;t<events.length;t++)if(n=events[t],n.id===e.id){c=n;break}break;case"CLEAR_EVENT_SELECTION":c=null;break;case"ITEM_ADDED_TO_EVENT":var s=c;require(["moment"],function(e){var t=e(s.start);OC.utils.messageBox.set("Added to '"+s.title+"' on "+t.format("dddd, MMMM Do YYYY [at] h:mma")),OC.utils.messageBox.show()}),c=null;break;case"OPEN_ITEM":d=!0,u=e.item;break;case"CLOSE_ITEM":d=!1;break;default:return!0}return p.emitPlannerChange(),!0})});return p}),define("planner",["react","core_light","moment","curriculumContextView","plannerActions","plannerStore","immutable"],function(e,t,n,s,a,i,r){var o=document.querySelector(".content-panel-body-wrapper");t.api={planner:{event:{save:function(e,t){require(["jstz","atomic"],function(n,s){e.zone=n.determine().name(),s.post("/planner/event/save/",e).success(function(e){t(e)})})}}}};var l={calendar:e.createClass({getInitialState:function(){return{hourHeight:3.85,week:this.props.week,allDayWeekEvents:[],height:1e3}},componentDidMount:function(){function e(){n=parseInt(window.innerHeight,10)-parseInt(t.$.css(document.querySelector(".content-panel header"),"height"),10)-parseInt(t.$.css(document.querySelector(".content-panel-body-title-bar-wrapper"),"height"),10)+"px",s.refs.calendarWrapper.getDOMNode().style.height=n}var n,s=this;e(),window.addEventListener("resize",e),this.setHourHeight()},componentWillMount:function(){this.setAllDayWeekEvents()},componentWillReceiveProps:function(e){this.props.allDayEvents!==e.allDayEvents&&this.setAllDayWeekEvents(e.allDayEvents)},renderTimes:function(){var t,s=[],a=n();for(s.push(e.DOM.div({className:"planner-calendar-times-date"})),s.push(e.DOM.div({className:"planner-calendar-times-allday",ref:"allDayTimes",style:{height:this.state.allDayWeekEvents.length*this.state.hourHeight+"%"}})),t=0;24>t;t++)a.set("hour",t),s.push(e.DOM.div({className:"planner-calendar-times-time",ref:"timeBlock",style:{height:this.state.hourHeight+"%"}},e.DOM.div({className:"planner-calendar-times-body"},[e.DOM.div({className:"planner-calendar-times-time-title-wrapper"},e.DOM.div({className:"planner-calendar-times-time-title"},a.format("h a"))),e.DOM.div({className:"planner-calendar-times-time-week"})])));return s},setHourHeight:function(){this.setState({hourHeight:92.4/(24+this.state.allDayWeekEvents.length)})},renderEvents:function(){var s,a,i,r,o,c=[],d=7*this.props.currentWeek+1,u=d+5,p=n();for(c.push(e.DOM.div({className:"planner-calendar-canvas-time"})),s=d;u>s;s++){o=n().weekday(s),i=this.state.week[o.format("YYYY-MM-DD").toString()],r=[],r.push(e.DOM.div({className:"planner-calendar-canvas-day-header-wrapper"},e.DOM.div({className:"planner-calendar-canvas-day-header"},[e.DOM.div({className:"planner-calendar-canvas-day-header-day"},o.format("ddd")),e.DOM.div({className:"planner-calendar-canvas-day-header-date",style:{color:t.config.palette.base}},o.format("D"))])));var h=this.state.allDayWeekEvents.length*this.state.hourHeight+"%";if(r.push(e.DOM.div({className:"planner-calendar-canvas-allday",style:{height:h}})),i)for(a=0;a<i.length;a++)i[a].all_day===!1&&r.push(l.evntPreview({evnt:i[a],hourHeight:this.state.hourHeight,openEvent:this.props.openEvent}));c.push(e.DOM.div({className:"planner-calendar-canvas-day"},[p.isSame(o,"day")?e.DOM.div({className:"planner-calendar-canvas-day-today"}):null,e.DOM.div({className:"planner-calendar-canvas-day-events"},r)]))}return c},setAllDayWeekEvents:function(e){var t,s,a,i,r,o,l,c,d=e||this.props.allDayEvents,u=1,p=u+5,h=(n(),[]);for(s in d)for(t=0;t<d[s].length;t++)a=d[s][t],i=n(a.start),r=n(a.end),o=new Date,(i.isSame(o,"date")||i.isBefore(n().weekday(p))&&r.isAfter(n().weekday(u-1)))&&(l=r.diff(i,"days"),c=i.day()-u,h.push({title:a.title,width:l,padding:c}));var f=this;this.setState({allDayWeekEvents:h},function(){f.setHourHeight()})},renderAlldayEvents:function(){var t,n=[],s=this.state.allDayWeekEvents;for(t=0;t<s.length;t++)n.push(l.allDayEventPreview({evnt:s[t],openEvent:this.props.openEvent}));return[e.DOM.div({className:"planner-calendar-allday-canvas-date"},null),e.DOM.div({className:"planner-calendar-allday-canvas-events"},n)]},render:function(){return e.DOM.div({className:"planner-calendar-wrapper",ref:"calendarWrapper"},e.DOM.div({className:"planner-calendar"},[e.DOM.div({className:"planner-calendar-times"},[this.renderTimes()]),e.DOM.div({className:"planner-calendar-days",ref:"calendarDays"},[e.DOM.div({className:"planner-calendar-days-times"},e.DOM.div({className:"planner-calendar-days-day-divider"})),e.DOM.div({className:"planner-calendar-days-day"},e.DOM.div({className:"planner-calendar-days-day-divider"})),e.DOM.div({className:"planner-calendar-days-day"},e.DOM.div({className:"planner-calendar-days-day-divider"})),e.DOM.div({className:"planner-calendar-days-day"},e.DOM.div({className:"planner-calendar-days-day-divider"})),e.DOM.div({className:"planner-calendar-days-day"},e.DOM.div({className:"planner-calendar-days-day-divider"})),e.DOM.div({className:"planner-calendar-days-day"},e.DOM.div({className:"planner-calendar-days-day-divider"}))]),e.DOM.div({className:"planner-calendar-canvas"},[this.renderEvents()]),e.DOM.div({className:"planner-calendar-allday-canvas"},[this.renderAlldayEvents()])]))}}),evnt:e.createClass({getInitialState:function(){return{contexts:this.props.contexts}},componentWillReceiveProps:function(e){e.hasOwnProperty("contexts")&&this.setState({contexts:e.contexts})},componentDidMount:function(){{var e=this,n=this.getDOMNode().querySelector(".ajax-loader");this.getDOMNode().querySelector(".ajax-loader-wrapper")}require(["spin"],function(s){l.hasOwnProperty("spinner")?l.spinner.spin(n):l.spinner=new s(t.spinner.options).spin(n),l.hasOwnProperty("spinner")&&l.spinner.spin(n),require(["atomic"],function(t){t.get("/planner/api/event/"+e.props.evnt.id+"/").success(function(t){e.props.setContexts(e.props.evnt.id,t.contexts),e.props.setNotes(e.props.evnt.id,t.notes),l.spinner.stop()})})})},renderContexts:function(){var n,s,a,i=[];for(n in this.state.contexts){for(s=[],a=0;a<this.state.contexts[n].items.length;a++)s.push(l.evntItemView({item:this.state.contexts[n].items[a]}));i.push(e.DOM.div({className:"planner-event-details-block"},[e.DOM.div({className:"planner-event-details-block-title",style:{color:this.props.evnt.palette?t.utils.palettes[this.props.evnt.palette].base:t.config.palette.base}},this.state.contexts[n].title+" / "+this.state.contexts[n].unitTitle),e.DOM.div({className:"planner-event-details-block-items"},s)]))}return i},edit:function(){this.props.editEvent()},goBack:function(){a.closeItem(),this.props.closeEvent()},"delete":function(){this.props.deleteEvent()},render:function(){var s,a;this.props.evnt.class_link?(s={backgroundColor:t.utils.palettes[this.props.evnt.palette].dark},a={backgroundColor:t.utils.palettes[this.props.evnt.palette].base}):(s={backgroundColor:t.config.palette.dark},a={backgroundColor:t.config.palette.base});var i=n(this.props.evnt.start),r=n(this.props.evnt.end);return e.DOM.div({className:"planner-event-wrapper card-wrapper"+(this.props.drawer?" card-wrapper-condensed":"")},e.DOM.div({className:"planner-event card"},[e.DOM.div({className:"planner-event-toolbar card-toolbar",style:s},[e.DOM.a({className:"card-toolbar-back planner-event-toolbar-back back-button "+(this.props.evnt.palette?this.props.evnt.palette:t.config.palette.title)+"-button",onClick:this.goBack},"Back"),e.DOM.div({className:"card-toolbar-secondary"},[t.config.user.id===t.config.profile.id?e.DOM.a({className:"planner-event-toolbar-back card-toolbar-delete "+((this.props.evnt.palette?this.props.evnt.palette:t.config.palette.title)+"-button"),onClick:this.delete},"Delete"):null,t.config.user.id===t.config.profile.id?e.DOM.a({className:"planner-event-toolbar-back card-toolbar-edit "+((this.props.evnt.palette?this.props.evnt.palette:t.config.palette.title)+"-button"),onClick:this.edit},"Edit"):null])]),e.DOM.div({className:"planner-event-title-wrapper card-title-wrapper",style:a},[e.DOM.div({className:"planner-event-title card-title"},this.props.evnt.title),e.DOM.div({className:"planner-event-title-assist"},[e.DOM.span({className:"planner-event-title-assist-class"},(this.props.evnt.class_link?this.props.evnt.class_link.title+" / ":"")+i.fromNow()),e.DOM.span({}," on "),e.DOM.span({className:"planner-event-title-assist-date"},i.format("MMM Do, YYYY [at] h:mma")),e.DOM.span({}," to "),e.DOM.span({className:"planner-event-title-assist-date"},r.format(i.isSame(r,"day")?"h:mma":"MMM Do, YYYY [at] h:mma"))])]),this.state.contexts?e.DOM.div({className:"planner-event-details card-details card-details-padded"},this.renderContexts()):null,this.props.notes?e.DOM.div({className:"planner-event-details card-details card-details-padded"},e.DOM.div({className:"planner-event-details-block"},[e.DOM.div({className:"planner-event-details-block-title",style:{color:this.props.evnt.palette?t.utils.palettes[this.props.evnt.palette].base:t.config.palette.base}},"Notes"),e.DOM.div({className:"planner-event-details-block-body"},this.props.notes)])):null,null===this.state.contexts||"object"==typeof this.state.contexts?null:e.DOM.div({className:"ajax-loader-wrapper"},e.DOM.div({className:"ajax-loader"}))]))}}),evntItemView:e.createClass({open:function(){a.openItem(this.props.item)},render:function(){return e.DOM.div({className:"planner-event-details-block-item"},e.DOM.a({className:"planner-event-details-block-item-description",onClick:this.open},this.props.item.description))}}),time:e.createClass({classPeriodChanged:function(){this.props.scrollToTimepicker(this.getDOMNode())},componentDidMount:function(){this.time=t.utils.timepicker(this.getDOMNode(),null,this.props.listenToChange?this.classPeriodChanged:null)},componentWillReceiveProps:function(e){e.scrollTo&&this.time.scrollTo(e.scrollTo)},componentWillUnmount:function(){this.time.el.parentNode.removeChild(this.time.el)},render:function(){return e.DOM.input({type:"text",placeholder:this.props.name,className:"planner-time",defaultValue:this.props.time,onChange:this.classPeriodChanged,ref:this.props.ref})}}),editEvnt:e.createClass({getInitialState:function(){return{contexts:this.props.contexts,scrollTo:null}},componentDidMount:function(){var e=this.refs.startDate.getDOMNode(),t=this.refs.endDate.getDOMNode();require(["pikaday"],function(n){var s,a;s=new n({field:e,onSelect:function(e){a.setMinDate(e)}}),a=new n({field:t})})},scrollToTimepicker:function(){this.setState({scrollTo:this.refs.startTime.getDOMNode()})},save:function(){var e=this,n={id:this.props.evnt.id,title:this.refs.newEventInput.getDOMNode().value,from_date:this.refs.startDate.getDOMNode().value,from_time:this.refs.startTime.getDOMNode().value,to_date:this.refs.endDate.getDOMNode().value,to_time:this.refs.endTime.getDOMNode().value,"class":this.refs.class.getDOMNode().value,notes:this.refs.notes.getDOMNode().value},s=this.props.evnt.id?!1:!0;t.api.planner.event.save(n,function(a){n.id?t.utils.messageBox.set("Saved"):(n.id=a.id,t.utils.messageBox.set("New event '"+n.title+"' saved"));var i,r="blue",o="None";for(i=0;i<t.planner.classes;i++)if(t.planner.classes[i].id===parseInt(n.class,10)){r=t.planner.classes[i].palette,o=t.planner.classes[i].title;break}var l={all_day:!1,class_link:{id:parseInt(n.class,10),title:o},start:a.start,end:a.end,id:n.id,palette:r,title:n.title};e.props.eventSaved(l,s),t.utils.messageBox.show()})},goBack:function(){this.props.closeEdit()},remove:function(e){var t,n,s=this.state.contexts;for(t in s){for(n=0;n<s[t].items.length&&s[t].items[n].id!==e;n++);s[t].items.splice(n,1)}this.setState({contexts:s})},renderClasses:function(){var n=t.planner.classes.map(function(t){return e.DOM.option({className:"planner-class-detail-select-option",value:t.id},t.title)});return n.push(e.DOM.option({className:"planner-class-detail-select-option",value:"none"},"None")),n},renderContexts:function(){var n,s,a,i=[];for(n in this.state.contexts){for(s=[],a=0;a<this.state.contexts[n].items.length;a++)s.push(l.evntItem({item:this.state.contexts[n].items[a],evnt:this.props.evnt,remove:this.remove}));i.push(e.DOM.div({className:"planner-event-details-block"},[e.DOM.div({className:"planner-event-details-block-title",style:{color:this.props.evnt.palette?t.utils.palettes[this.props.evnt.palette].base:t.config.palette.base}},this.state.contexts[n].title+" / "+this.state.contexts[n].unitTitle),e.DOM.div({className:"planner-event-details-block-items"},s)]))}return i},render:function(){var s,a,i=n(this.props.evnt.start),r=n(this.props.evnt.end);return this.props.evnt.class_link?(s={backgroundColor:t.utils.palettes[this.props.evnt.palette].dark},a={backgroundColor:t.utils.palettes[this.props.evnt.palette].base}):(s={backgroundColor:t.config.palette.dark},a={backgroundColor:t.config.palette.base}),e.DOM.div({className:"planner-event-wrapper card-wrapper"},e.DOM.div({className:"planner-event card"},[e.DOM.div({className:"planner-event-toolbar card-toolbar",style:s},[e.DOM.a({className:"card-toolbar-back planner-event-toolbar-back back-button "+(this.props.evnt.palette?this.props.evnt.palette:t.config.palette.title)+"-button",onClick:this.goBack},"Back"),e.DOM.div({className:"card-toolbar-secondary"},[e.DOM.a({className:"planner-event-toolbar-back card-toolbar-save "+(this.props.evnt.palette?this.props.evnt.palette:t.config.palette.title)+"-button",onClick:this.save},"Save")])]),e.DOM.div({className:"planner-event-title-wrapper card-title-wrapper card-title-wrapper-edit card-title-wrapper-small"},[e.DOM.input({className:"planner-event-title card-title "+(this.props.evnt.palette?this.props.evnt.palette:t.config.palette.title)+"-card-title",defaultValue:this.props.evnt.title,placeholder:"What is this event called?",ref:"newEventInput"})]),e.DOM.div({className:"planner-class-details planner-class-details-dates planner-class-details-times card-details card-details-padded"},[e.DOM.div({className:"planner-class-detail"},[e.DOM.div({className:"planner-class-detail-support planner-class-detail-input-support"},"From"),e.DOM.div({className:"planner-class-detail-body"},[e.DOM.input({type:"text",ref:"startDate",placeholder:"Start date",title:i.toISOString(),value:i.format("YYYY-MM-DD")}),l.time({time:this.props.evnt.start?i.format("hh:mma"):null,name:"Start time",ref:"startTime",scrollTo:null,scrollToTimepicker:this.scrollToTimepicker,listenToChange:!0})])]),e.DOM.div({className:"planner-class-detail"},[e.DOM.div({className:"planner-class-detail-support planner-class-detail-input-support"},"To"),e.DOM.div({className:"planner-class-detail-body"},[e.DOM.input({type:"text",ref:"endDate",placeholder:"End date",title:r.toISOString(),value:r.format("YYYY-MM-DD")}),l.time({time:this.props.evnt.end?r.format("hh:mma"):null,name:"End time",ref:"endTime",scrollTo:this.state.scrollTo,scrollToTimepicker:this.scrollToTimepicker,listenToChange:!1})])])]),e.DOM.div({className:"planner-class-details planner-class-details-class card-details card-details-padded"},[e.DOM.div({className:"planner-class-detail"},[e.DOM.div({className:"planner-class-detail-support"},"Class"),e.DOM.select({className:"planner-class-detail-body",ref:"class",defaultValue:this.props.evnt.class_link?this.props.evnt.class_link.id:"none"},this.renderClasses())])]),this.state.contexts?e.DOM.div({className:"planner-event-details card-details card-details-padded"},this.renderContexts()):null,e.DOM.div({className:"planner-class-details planner-class-details-colors card-details card-details-padded"},[e.DOM.div({className:"planner-class-detail"},[e.DOM.div({className:"planner-class-detail-support"},"Notes"),e.DOM.textarea({className:"planner-class-detail-body",ref:"notes"},this.props.notes)])])]))}}),evntItem:e.createClass({componentDidMount:function(){var e=this.refs.actions.getDOMNode();t.$.addClass(e,"show"),t.utils.menu(this.getDOMNode().querySelector("nav.item-menu"),this.refs.actions.getDOMNode()),t.$.removeClass(e,"show")},moveItem:function(){function s(e,n){require(["spin"],function(s){if(l.hasOwnProperty("moveEventSpinner"))l.moveEventSpinner.spin(e);else{var a=t.spinner.options;a.top="75%",l.moveEventSpinner=new s(a).spin(e)}n()})}function a(e,a){r.close();var o=t.utils.popup(".confirm-move-dialog"),c=o.dialog.querySelector(".popup-body-loader"),d=o.dialog.querySelector(".confirm-move-message"),u=o.dialog.querySelector(".confirm-move-none"),p=o.dialog.querySelector(".go-back-button"),h=o.dialog.querySelector(".confirm-button"),f=o.dialog.querySelector(".cancel-button"),m=null;t.$.removeClass(d,"show"),t.$.removeClass(u,"show"),s(c,function(){require(["atomic"],function(e){e.get("/planner/event/"+(a?"after":"before")+"/"+i.props.evnt.id+"/").success(function(e){if(l.moveEventSpinner.stop(),e){t.$.addClass(d,"show"),m=e.id;var s=n(e.start);o.dialog.querySelector(".confirm-move-dialog-date").innerHTML=s.format("dddd, MMMM Do YYYY"),o.dialog.querySelector(".confirm-move-dialog-time").innerHTML=s.format("h:mma"),o.dialog.querySelector(".confirm-move-dialog-class").innerHTML=e.class_link.title}else t.$.addClass(u,"show"),t.$.removeClass(p,"secondary-popup-button"),t.$.addClass(h,"hide")})})}),t.$.addListener(p,"click",function(){o.close(),r=t.utils.popup(".move-item-dialog")}),t.$.addListener(h,"click",function(){o.close(),require(["plannerAPI"],function(){t.api.planner.addItem(i.props.item.id,m),t.api.planner.removeItem(i.props.item.id,i.props.evnt.id),i.remove(),t.utils.messageBox.set("Moved item successfully"),t.utils.messageBox.show()})}),t.$.addListener(f,"click",function(){o.close()})}var i=this,r=t.utils.popup(".move-item-dialog");t.$.addListener(r.dialog.querySelector(".option-next"),"click",function(e){a(e,!0)}),t.$.addListener(r.dialog.querySelector(".option-before"),"click",function(e){a(e,!1)}),t.$.addListener(r.dialog.querySelector(".option-select"),"click",function(){r.close();var n=t.utils.popup(".move-item-widget-dialog"),a=n.dialog.querySelector(".popup-body-loader");s(a,function(){require(["plannerWidget","curriculumActions","plannerAPI"],function(s,a){e.renderComponent(s.Calendar({itemID:i.props.item.id},{cancelEventSelect:function(){a.clearEventSelection()},confirmEventSelect:function(e,s){a.confirmAddItemToEvent(e,s),a.removeItemFromEvent(e,i.props.evnt.id),i.remove(),n.close(),t.utils.messageBox.set("Moved item successfully"),t.utils.messageBox.show()},dateSelect:function(e){a.selectDate(e)},eventSelect:function(e,t){a.selectPlannerEvent(e,t)}}),document.querySelector(".move-item-widget"),function(){n.reposition()})})})})},remove:function(){this.props.remove(this.props.item.id)},getInitialState:function(){return{showMenu:!1}},toggleMenu:function(){this.setState({showMenu:!this.state.showMenu},function(){if(this.state.showMenu){var e=this,t=document.querySelector("body");t.addEventListener("click",function n(s){e.getDOMNode()===s.target||e.getDOMNode().contains(s.target)||(e.setState({showMenu:!1}),t.removeEventListener("click",n))})}})},render:function(){return e.DOM.div({className:"planner-event-details-block-item"},[e.DOM.div({className:"planner-event-details-block-item-description"},this.props.item.description),e.DOM.div({className:"planner-event-details-block-item-actions"+(this.state.showMenu?" show":""),onClick:this.toggleMenu,ref:"actions"}),l.itemMenu({open:this.state.showMenu,moveItem:this.moveItem})])}}),evntPreview:e.createClass({componentDidMount:function(){var e=this.refs.wrapper.getDOMNode();e.style.marginBottom="-"+t.$.css(e,"height")},openEvent:function(){this.props.openEvent(this.props.evnt)},render:function(){var s=[new Date(this.props.evnt.start),new Date(this.props.evnt.end)],a=Math.round((s[1]-s[0])/1e3/60)/60*this.props.hourHeight,i={top:(s[0].getHours()+s[0].getMinutes()/60)*this.props.hourHeight+"%",height:a+"%"};return this.props.evnt.palette&&(i.backgroundColor=t.utils.palettes[this.props.evnt.palette].base),e.DOM.div({className:"planner-calendar-canvas-day-event-wrapper",style:i,onClick:this.openEvent,ref:"wrapper"},e.DOM.div({className:"planner-calendar-canvas-day-event"},[e.DOM.div({className:"planner-calendar-canvas-day-event-title"},this.props.evnt.title),a>=40?e.DOM.div({className:"planner-calendar-canvas-day-event-time"},n(s[0]).format("ha")+"-"+n(s[1]).format("ha")):null]))}}),allDayEventPreview:e.createClass({openEvent:function(){this.props.openEvent(this.props.evnt)},render:function(){var t,n=[];for(t=0;t<this.props.evnt.padding;t++)n.push(e.DOM.div({className:"planner-calendar-allday-canvas-event-padding"},null));return n.push(e.DOM.div({className:"planner-calendar-allday-canvas-event-body-wrapper",style:{width:20*(this.props.evnt.width+1)+"%"}},e.DOM.div({className:"planner-calendar-allday-canvas-event-body"},this.props.evnt.title))),e.DOM.div({className:"planner-calendar-allday-canvas-event"},n)}}),calendarWrapper:e.createClass({getInitialState:function(){return{view:"calendar",evnt:null,week:{},currentWeek:0,allDayEvents:{},loaded:[],contexts:{},notes:{},drawer:i.getDrawer(),context:i.getItem()}},componentDidMount:function(){var e=this;this.loadSpinner(function(){require(["atomic","jstz"],function(n,s){var a=s.determine().name();n.get("/planner/events/"+t.config.profile.id+"/"+encodeURIComponent(a)+"/").success(function(t){e.updateEvents(t),e.setState({loaded:[-4,-3,-2,-1,0,1,2,3]}),l.spinner.stop()})})}),this.resizeUI(),window.addEventListener("resize",this.resizeUI),i.on("change",this._onChange)},componentWillUnmount:function(){i.removeListener("change",this._onChange)},_onChange:function(){this.setState({drawer:i.getDrawer(),context:i.getItem()},function(){function e(){t.$.addClass(o,"condensed"),o.style.width=t.$.css(document.querySelector("header"),"width")}this.state.drawer?(e(),t.$.addListener(window,"resize",e)):(t.$.removeClass(o,"condensed"),o.style.width="96%")})},loadSpinner:function(e){var n=document.querySelector(".ajax-loader");require(["spin"],function(s){l.hasOwnProperty("spinner")?l.spinner.spin(n):l.spinner=new s(t.spinner.options).spin(n),l.hasOwnProperty("spinner")&&l.spinner.spin(n),e()})},componentDidUpdate:function(){this.resizeUI()},resizeUI:function(){"calendar"===this.state.view&&(this.refs.titleBarWrapper.getDOMNode().style.width=t.$.css(document.querySelector(".content-panel header"),"width"))},openEvent:function(e){this.setState({view:"event",evnt:e})},closeEvent:function(){this.setState({view:"calendar"})},editEvent:function(){this.setState({view:"edit"})},closeEdit:function(){this.setState(this.state.evnt.id?{view:"event"}:{view:"calendar"})},updateEvents:function(e){var t=this;require(["deep_extend"],function(n){var s,a,i,r={};for(s in e)for(a=0;a<e[s].length;a++)i=e[s][a],i.all_day===!0&&(r.hasOwnProperty(s)?r[s].push(i):r[s]=[i]);t.setState({week:n(t.state.week,e),allDayEvents:r})})},fetch:function(e){var t=this,n=t.state.loaded,s=this.state.currentWeek,a=new Date;a.setMonth(e),this.loadSpinner(function(){require(["atomic"],function(i){i.get("/planner/events/around/"+a.toISOString()+"/").success(function(a){t.updateEvents(a),e>0?Array.prototype.push.apply(n,[s,s+1,s+2,s+3]):Array.prototype.push.apply(n,[s,s-1,s-2,s-3]),t.setState({loaded:n}),l.spinner.stop()})})})},moveWeekForward:function(){var e=this;this.setState({currentWeek:this.state.currentWeek+1},function(){if(-1===this.state.loaded.indexOf(this.state.currentWeek)){var t=0;this.state.loaded.forEach(function(e){e>t&&(t=e)}),e.fetch(Math.round(t/4))}})},moveWeekBackward:function(){var e=this;this.setState({currentWeek:this.state.currentWeek-1},function(){if(-1===this.state.loaded.indexOf(this.state.currentWeek)){var t=0;this.state.loaded.forEach(function(e){t>e&&(t=e)}),e.fetch(Math.round(t/4))}})},setContexts:function(e,t){var n=this.state.contexts;n[e]=t,this.setState({contexts:n})},getContext:function(e){return this.state.contexts[e]},setNotes:function(e,t){var n=this.state.notes;n[e]=t,this.setState({notes:n})},getNotes:function(e){return this.state.notes[e]},create:function(){var e=new Date,t={id:null,start:e.toISOString(),end:e.toISOString(),title:"",all_day:!1,palette:null,class_link:null};this.setState({view:"edit",evnt:t})},eventSaved:function(e,t){function s(e,t){for(a=0;a<e.length;a++)if(e[a].id===t)return a;return null}var a,i=this,r={},o=n(e.start).format("YYYY-MM-DD");if(i.state.week.hasOwnProperty(o))if(r[o]=i.state.week[o],t)r[o].push(e);else for(var l in i.state.week)index=s(i.state.week[l],e.id),index&&(r[l][index]=e);else r[o]=e;require(["deep_extend"],function(){i.setState({evnt:e,week:r})})},deleteEvent:function(){t.utils.messageBox.set("Deleted '"+this.state.evnt.title+"' successfully");var e=this;require(["atomic"],function(n){n.get("/planner/event/"+e.state.evnt.id+"/delete/").success(function(){t.utils.messageBox.show()})});var s=this.state.week,a=s[n(this.state.evnt.start).format("YYYY-MM-DD")];a.splice(a.indexOf(this.state.evnt),1),this.setState({week:s,view:"calendar"})},render:function(){if("calendar"===this.state.view){var a=n().add(this.state.currentWeek,"w").day(1),i=n().add(this.state.currentWeek,"w").day(5),o=a.month()===i.month();return e.DOM.div({className:"planner-wrapper"},[e.DOM.div({className:"content-panel-body-title-bar-wrapper",ref:"titleBarWrapper"},e.DOM.div({className:"content-panel-body-title-wrapper"},[e.DOM.div({className:"content-panel-body-context"},[e.DOM.div({className:"content-panel-body-context-view"},[e.DOM.a({className:"current"},"Week")]),e.DOM.div({className:"content-panel-body-context-period"},[e.DOM.div({className:"content-panel-body-context-period-back",onClick:this.moveWeekBackward},e.DOM.div({className:"content-panel-body-context-period-back-arrow"},null)),e.DOM.div({className:"content-panel-body-context-period-body"},a.format("MMM D")+" - "+(o?"":i.format("MMM")+" ")+i.date()),e.DOM.div({className:"content-panel-body-context-period-forward",onClick:this.moveWeekForward},e.DOM.div({className:"content-panel-body-context-period-forward-arrow"},null))])]),t.config.profile.id===t.config.user.id?e.DOM.div({className:"content-panel-body-create"},[e.DOM.a({className:"oc-button content-panel-body-create-button-pre oc-page-action-button",href:t.planner.classesURL},"Manage classes"),e.DOM.button({className:"oc-button oc-page-action-button",onClick:this.create},"+ Create new")]):null])),l.calendar({openEvent:this.openEvent,week:this.state.week,currentWeek:this.state.currentWeek,allDayEvents:this.state.allDayEvents})])}if("edit"===this.state.view)return l.editEvnt({closeEdit:this.closeEdit,evnt:this.state.evnt,contexts:this.getContext(this.state.evnt.id),notes:this.getNotes(this.state.evnt.id),eventSaved:this.eventSaved});var c;return this.state.drawer&&(c=this.state.context,c.resource_sets.forEach(function(e){e.resources=r.fromJS(e.resources)})),e.DOM.div({},[l.evnt({closeEvent:this.closeEvent,evnt:this.state.evnt,editEvent:this.editEvent,setContexts:this.setContexts,contexts:this.getContext(this.state.evnt.id),setNotes:this.setNotes,notes:this.getNotes(this.state.evnt.id),deleteEvent:this.deleteEvent,drawer:this.state.drawer}),this.state.drawer?e.DOM.div({className:"explorer-resource-module-support show planner-event-support"},s({host:"planner",item:r.Map(c),palette:this.state.evnt.palette})):null])}}),itemMenu:e.createClass({removeItem:function(){},moveItem:function(){this.props.moveItem(this.props.id)},render:function(){return e.DOM.nav({className:"oc-menu item-menu"+(this.props.open?" show-menu":"")},[e.DOM.div({className:"floating-menu-spacer"},null),e.DOM.ul({},e.DOM.li({},e.DOM.a({onClick:this.moveItem},"Move to...")),e.DOM.li({},e.DOM.a({onClick:this.removeItem},"Remove")))])}})};return e.renderComponent(l.calendarWrapper({week:{}}),o),l}),define("classes",["react","core_light"],function(e,t){t.api={planner:{"class":{save:function(e,t){require(["jstz","atomic"],function(n,s){e.zone=n.determine().name(),s.post("/planner/class/save/",e).success(function(e){t(e.id)})})},"delete":function(e,t){require(["atomic"],function(n){n.get("/planner/class/"+e.id+"/delete/").success(function(){t()})})}}}};var n={color:e.createClass({componentDidMount:function(){this.tip=t.utils.tip(this.getDOMNode())},getInitialState:function(){return{selected:this.props.selected}},componentWillReceiveProps:function(e){"selected"in e&&this.setState({selected:e.selected}),"schedule"in e&&setTimeout(this.tip.reposition,100)},setColor:function(){this.props.changeColor(this.props.paletteName),this.setState({selected:!0})},render:function(){return e.DOM.div({className:"planner-class-color"+(this.state.selected?" selected":""),style:{backgroundColor:this.props.palette.base},onClick:this.setColor,title:t.utils.palettes[this.props.paletteName].title})
}}),time:e.createClass({classPeriodChanged:function(){this.props.changed(this.getDOMNode().value,this.props.position,this.props.name,this.props.day)},componentDidMount:function(){this.time=t.utils.timepicker(this.getDOMNode(),null,this.classPeriodChanged)},componentWillUnmount:function(){this.time.el.parentNode.removeChild(this.time.el)},render:function(){return e.DOM.input({type:"text",placeholder:this.props.name,className:"class-period-"+this.props.name.toLowerCase(),value:this.props.time,onChange:this.classPeriodChanged})}}),day:e.createClass({checked:function(){if(this.props.schedule){var e;for(e=0;e<this.props.schedule.length;e++)if("from"in this.props.schedule[e]&&"to"in this.props.schedule[e])return!0}return!1},openDayView:function(){this.props.openDayView(this.props.day)},render:function(){return e.DOM.li({onClick:this.openDayView,className:"planner-class-details-schedule-day"+(this.props.isCurrent?" current":""),style:{borderColor:this.props.isCurrent?t.utils.palettes[this.props.palette].base:null}},e.DOM.div({className:"planner-class-details-schedule-day-body"},[e.DOM.input({type:"checkbox",checked:this.checked()},null),e.DOM.label({style:{color:t.utils.palettes[this.props.palette].base}},this.props.day.substring(0,3))]))}}),"class":e.createClass({getInitialState:function(){return{schedule:this.props.class.schedule,day:null,palette:this.props.palette}},componentDidMount:function(){this.refs.newClassInput.getDOMNode().focus();var e=this.refs.startDate.getDOMNode(),t=this.refs.endDate.getDOMNode();require(["pikaday"],function(n){var s,a;s=new n({field:e,onSelect:function(t){e.title=t.toISOString(),a.setMinDate(t)}}),a=new n({field:t,onSelect:function(e){t.title=e.toISOString()}})})},goBack:function(){this.props.listClasses()},save:function(){var e=this,s=document.querySelector(".ajax-spinner");require(["spin"],function(a){if(n.hasOwnProperty("spinner"))n.spinner.spin(s);else{var i=t.spinner.options;i.top="9%",n.spinner=new a(i).spin(s)}var r={id:e.props.class.id,title:e.refs.newClassInput.getDOMNode().value,palette:e.state.palette,schedule:e.state.schedule,from:e.refs.startDate.getDOMNode().title,to:e.refs.endDate.getDOMNode().title};t.api.planner.class.save(r,function(s){r.id?t.utils.messageBox.set("Saved"):(r.id=s,t.utils.messageBox.set("New class '"+r.title+"' saved")),e.props.newClassSaved(r),n.spinner.stop(),t.utils.messageBox.show()})})},"delete":function(){var e=this,n=this.props.class.title,s=this.props.class.id;e.props.deleted(s),t.api.planner.class.delete({id:s},function(){t.utils.messageBox.set("Deleted '"+n+"'"),t.utils.messageBox.show()})},setup:function(){var e=this;require(["scheduler"],function(t){var n=e.state.scheduler||t;e.state.scheduler||e.setState({scheduler:n}),n.init(function(t){e.setState({schedule:t})})})},changeColor:function(e){this.setState({palette:e})},classPeriodChanged:function(e,t,n,s){var a=this.state.schedule;try{a[s][t][n.toLowerCase()]=e}catch(i){a[s]?(a[s][t]={},a[s][t][n.toLowerCase()]=e):(a[s]=[{}],a[s][0][n.toLowerCase()]=e)}this.setState({schedule:a})},addClassPeriod:function(){var e=this.state.schedule;try{e[this.state.day].push({})}catch(t){e[this.state.day]=[{},{}]}this.setState({schedule:e})},openDayView:function(e){this.setState({day:e})},renderDaySelector:function(e){return n.day({openDayView:this.openDayView,day:e,palette:this.state.palette,isCurrent:this.state.day===e,schedule:this.state.schedule[e]})},renderDaySchedule:function(s){var a,i=[];for(a=0;a<(s?s.length:1);a++)i.push(e.DOM.div({className:"class-period"},[n.time({time:s?s[a].from:null,name:"From",changed:this.classPeriodChanged,position:a,day:this.state.day}),n.time({time:s?s[a].to:null,name:"To",changed:this.classPeriodChanged,position:a,day:this.state.day})]));return[e.DOM.div({className:"class-periods"},i),e.DOM.a({className:"add-class-period",onClick:this.addClassPeriod,style:{color:t.utils.palettes[this.state.palette].base}},"+ Add class period")]},renderSchedule:function(){return e.DOM.div({className:"planner-class-details planner-class-details-schedule card-details card-details-padded"},[e.DOM.ul({className:"planner-class-details-schedule-days"},["Monday","Tuesday","Wednesday","Thursday","Friday"].map(this.renderDaySelector)),this.state.day?e.DOM.div({className:"planner-class-details-schedule-body"},this.renderDaySchedule(this.state.schedule[this.state.day])):e.DOM.div({className:"planner-class-details-schedule-placeholder"},"Click on a tab to change the schedule for a particular day")])},renderColors:function(){var e,s=[],a=t.utils.palettes;for(e in a)s.push(n.color({palette:a[e],changeColor:this.changeColor,selected:this.state.palette===e,paletteName:e,schedule:this.state.schedule}));return s},render:function(){return e.DOM.div({className:"planner-class-wrapper card-wrapper"},e.DOM.div({className:"planner-class card"},[e.DOM.div({className:"planner-class-toolbar card-toolbar",style:{backgroundColor:t.utils.palettes[this.state.palette].dark}},[e.DOM.a({className:"planner-class-toolbar-back card-toolbar-back back-button "+(this.state.palette.toLowerCase()+"-button"),onClick:this.goBack},"Back"),e.DOM.div({className:"card-toolbar-secondary"},[e.DOM.a({className:"planner-class-toolbar-delete card-toolbar-delete "+(this.state.palette.toLowerCase()+"-button"),onClick:this.delete},"Delete"),e.DOM.a({className:"planner-class-toolbar-back card-toolbar-save "+(this.state.palette.toLowerCase()+"-button"),onClick:this.save},"Save")])]),e.DOM.div({className:"planner-class-title-wrapper card-title-wrapper card-title-wrapper-edit card-title-wrapper-small"},[e.DOM.input({className:"planner-class-title card-title "+this.state.palette.toLowerCase()+"-card-title",defaultValue:this.props.class.title,placeholder:"Name of class",ref:"newClassInput"})]),this.state.schedule?this.renderSchedule():e.DOM.div({className:"planner-class-details card-details card-details-padded"},[e.DOM.button({className:"oc-button oc-loud-button",onClick:this.setup},"Setup the class schedule")]),e.DOM.div({className:"planner-class-details planner-class-details-dates card-details card-details-padded"},[e.DOM.div({className:"planner-class-detail"},[e.DOM.div({className:"planner-class-detail-support planner-class-detail-input-support"},"Starts on"),e.DOM.div({className:"planner-class-detail-body"},e.DOM.input({type:"text",ref:"startDate",placeholder:"Start date",defaultValue:this.props.class.start?this.props.class.start:null}))]),e.DOM.div({className:"planner-class-detail"},[e.DOM.div({className:"planner-class-detail-support planner-class-detail-input-support"},"Ends on"),e.DOM.div({className:"planner-class-detail-body"},e.DOM.input({type:"text",ref:"endDate",placeholder:"End date",defaultValue:this.props.class.end?this.props.class.end:null}))])]),e.DOM.div({className:"planner-class-details planner-class-details-colors card-details card-details-padded"},[e.DOM.div({className:"planner-class-detail"},[e.DOM.div({className:"planner-class-detail-support"},"Color"),e.DOM.div({className:"planner-class-detail-body"},this.renderColors())])])]))}}),classPreview:e.createClass({openClass:function(){this.props.openClass(this.props._class)},render:function(){var t=[];for(var n in this.props._class.schedule)t.push(n);return e.DOM.div({className:"planner-classes-class planner-classes-class-"+this.props._class.paletteName.toLowerCase(),onClick:this.openClass},[e.DOM.div({className:"planner-classes-class-title"},this.props._class.title),e.DOM.div({className:"planner-classes-class-description"},t.length>0?"Repeats on "+t.join(", "):"(No schedule setup)")])}}),classes:e.createClass({getInitialState:function(){return{classes:this.props.classes}},addClass:function(){var e={id:null,title:"",palette:t.utils.palettes.blue,paletteName:"blue",schedule:null};this.props.addClass(e)},renderClass:function(e){return n.classPreview({_class:e,openClass:this.props.openClass})},render:function(){return e.DOM.div({className:"planner-classes-wrapper card-wrapper"},e.DOM.div({className:"planner-classes card"},[e.DOM.div({className:"planner-classes-toolbar card-toolbar",style:{backgroundColor:t.config.palette.dark}},[e.DOM.a({className:"planner-classes-toolbar-back card-toolbar-back back-button "+t.config.palette.title+"-button",onClick:this.goBack,href:t.planner.plannerURL},"Back"),e.DOM.a({className:"planner-class-toolbar-back card-toolbar-add add-button "+t.config.palette.title+"-button",onClick:this.addClass},"Add class")]),e.DOM.div({className:"planner-classes-title-wrapper card-title-wrapper card-title-wrapper-small",style:{backgroundColor:t.config.palette.base}},[e.DOM.div({className:"planner-classes-title card-title"},"Classes")]),this.state.classes.length>0?e.DOM.div({className:"planner-classes-details card-details"},this.state.classes.map(this.renderClass)):e.DOM.div({className:"empty-state-title empty-state-title-independent"},"You have no classes setup")]))}}),classesWrapper:e.createClass({getInitialState:function(){return{"class":null,classes:t.planner.classes}},openClass:function(e){this.setState({"class":e})},listClasses:function(){this.setState({"class":null})},newClassSaved:function(e){var n,s=this.state.classes;for(n=0;n<s.length;n++)if(!s[n].id){classToUpdateIndex=n;break}s[n]={id:e.id,title:e.title,paletteName:e.palette,palette:t.utils.palettes[e.palette],schedule:e.schedule,from:e.from,to:e.to},this.setState({classes:s,"class":null})},deleted:function(e){var t,n=this.state.classes;for(t=0;t<n.length;t++)if(n[t].id===e){classToDeleteIndex=t;break}n.splice(t,1),this.setState({classes:n,"class":null})},addClass:function(e){var t=this.state.classes;t.push(e),this.setState({classes:t},function(){this.openClass(e)})},render:function(){return this.state.class?n.class({openClass:this.openClass,"class":this.state.class,listClasses:this.listClasses,palette:this.state.class.paletteName,newClassSaved:this.newClassSaved,deleted:this.deleted}):n.classes({openClass:this.openClass,classes:this.state.classes,addClass:this.addClass})}})};return e.renderComponent(n.classesWrapper(),document.querySelector(".classes-box-wrapper")),n}),define("scheduler",["core_light"],function(e){var t={popup:null,classPeriodEl:null,classPeriodFromEl:null,classPeriodToEl:null,classPeriodWrapper:null,classDays:{},remainingClasses:null,k:null,replicateLabels:null,replicateLabelsWrapper:null,timesNextDone:null,day:null,bindTimes:function(t){function n(){a.scrollTo(i)}var s,a,i=t.querySelector(".class-period-from"),r=t.querySelector(".class-period-to");s=e.utils.timepicker(i,this.popup.el,n),a=e.utils.timepicker(r,this.popup.el),i.value="",r.value=""},toggleTimesButtonCallback:function(t){t?(this.timesNextDone.removeEventListener("click",this.boundCloseView),this.timesNextDone.removeEventListener("click",this.boundDayView),e.$.addListener(this.timesNextDone,"click",this.boundCloseView=this.closeSchedule.bind(this))):(this.timesNextDone.removeEventListener("click",this.boundCloseView),this.timesNextDone.removeEventListener("click",this.boundDayView),e.$.addListener(this.timesNextDone,"click",this.boundDayView=this.dayView.bind(this)))},replicateListener:function(){var e,t=this.replicateLabels.querySelectorAll('input[type="checkbox"]'),n=[];for(e=0;e<t.length;e++)t[e].checked===!1&&n.push(t[e]);0===n.length?(this.timesNextDone.innerHTML="Done",this.toggleTimesButtonCallback(!0)):(this.timesNextDone.innerHTML="Next &#187;",this.toggleTimesButtonCallback(!1))},dayView:function(t){if(t.target.removeEventListener("click",this.boundDayView),0===Object.keys(this.classDays).length){var n=this.popup.el.querySelectorAll('.select-days input[type="checkbox"]:checked');1===n.length&&e.$.addClass(this.replicateLabelsWrapper,"hidden");var s;for(s=0;s<n.length;s++)this.classDays[n[s].name]=[];this.initDayView(this.classDays)}else this.pushCurrentTimes(),this.replicateCurrentTimes.bind(this)();return t.stopPropagation(),t.preventDefault(),!1},addClassPeriod:function(e){return classPeriodEl=document.createElement("div"),classPeriodEl.className="class-period",classPeriodFromEl=document.createElement("input"),classPeriodFromEl.type="text",classPeriodFromEl.placeholder="From",classPeriodFromEl.className="class-period-from",classPeriodToEl=document.createElement("input"),classPeriodToEl.type="text",classPeriodToEl.placeholder="To",classPeriodToEl.className="class-period-to",classPeriodEl.appendChild(classPeriodFromEl),classPeriodEl.appendChild(classPeriodToEl),this.classPeriodWrapper.appendChild(classPeriodEl),this.bindTimes(classPeriodEl),e?(e.target.removeEventListener("click",this.addClassPeriodBound),e.stopPropagation(),e.preventDefault(),!1):void 0},initDayView:function(t){var n,s,a,i=!1;this.replicateLabels.innerHTML="";for(var r in t)i?(n=document.createElement("label"),n.className="inline-input-label",a=document.createElement("input"),a.type="checkbox",s=document.createElement("span"),s.innerHTML=r,n.appendChild(a),n.appendChild(s),this.replicateLabels.appendChild(n)):(this.day.innerHTML=r,i=!0);Object.keys(t).length>1?e.$.removeClass(this.replicateLabelsWrapper,"hidden"):e.$.addClass(this.replicateLabelsWrapper,"hidden"),this.replicateListener(),e.$.addClass(this.popup.el.querySelector(".select-days"),"hidden"),e.$.removeClass(this.popup.el.querySelector(".select-times"),"hidden");var o=this.popup.el.querySelectorAll(".class-period");for(j=0;j<o.length;j++)o[j].parentNode.removeChild(o[j]);this.addClassPeriod(),this.bindTimes(this.popup.el.querySelector(".class-period")),e.$.addListener(this.replicateLabels.querySelectorAll('input[type="checkbox"]'),"change",this.replicateListener.bind(this)),this.addClassPeriodBound=this.addClassPeriod.bind(this),e.$.addListener(this.popup.el.querySelector(".add-class-period"),"click",this.addClassPeriodBound)},pushCurrentTimes:function(){var e,t=this.popup.el.querySelectorAll(".class-period");for(e=0;e<t.length;e++)this.classDays[this.day.innerHTML].push({from:t[e].querySelector("input.class-period-from").value,to:t[e].querySelector("input.class-period-to").value})},replicateCurrentTimes:function(e){var t=this;require(["deep_extend"],function(n){var s=t.replicateLabels.querySelectorAll('.replicate-labels input[type="checkbox"]:checked');if(s.length>0){var a;for(a=0;a<s.length;a++)t.classDays[s[a].parentNode.querySelector("span").innerHTML]=n([],t.classDays[t.day.innerHTML])}t.remainingClasses={};for(var i in t.classDays)0===t.classDays[i].length&&(t.remainingClasses[i]=t.classDays[i]);t.initDayView(t.remainingClasses),e()})},refresh:function(){var t=this.popup.el.querySelectorAll("input");this.replicateLabels.innerHTML="",e.$.removeClass(this.replicateLabelsWrapper,"hidden"),this.timesNextDone.innerHTML="Next &#187;";var n;for(n=0;n<t.length;n++)"checkbox"===t[n].type?t[n].checked=!1:t[n].value=null},closeSchedule:function(){var e=this;this.pushCurrentTimes(),this.replicateCurrentTimes(function(){e.callback(e.classDays)}),this.popup.close()},init:function(t){this.popup=e.utils.popup(".setup-class-dialog"),this.classPeriodWrapper=this.popup.el.querySelector(".class-periods"),this.replicateLabels=this.popup.el.querySelector(".replicate-labels"),this.replicateLabelsWrapper=this.popup.el.querySelector(".replicate-labels-wrapper"),this.timesNextDone=this.popup.el.querySelector(".setup-times-days-button"),this.day=this.popup.el.querySelector(".select-times-day-name"),this.classDays={},this.callback=t;var n=this.popup.el.querySelector(".setup-class-days-button");e.$.addClass(this.popup.el.querySelectorAll(".popup-body-message"),"hidden"),e.$.removeClass(this.popup.el.querySelector(".select-days"),"hidden"),this.refresh(),"boundDayView"in this&&n.removeEventListener("click",this.boundDayView),this.boundDayView=this.dayView.bind(this),e.$.addListener(n,"click",this.boundDayView)}};return t}),function(e,t){var n;if("object"==typeof exports){try{n=require("moment")}catch(s){}module.exports=t(n)}else"function"==typeof define&&define.amd?define("pikaday",["require"],function(e){var s="moment";return n=e.defined&&e.defined(s)?e(s):void 0,t(n)}):e.Pikaday=t(e.moment)}(this,function(e){var t="function"==typeof e,n=!!window.addEventListener,s=window.document,a=window.setTimeout,i=function(e,t,s,a){n?e.addEventListener(t,s,!!a):e.attachEvent("on"+t,s)},r=function(e,t,s,a){n?e.removeEventListener(t,s,!!a):e.detachEvent("on"+t,s)},o=function(e,t,n){var a;s.createEvent?(a=s.createEvent("HTMLEvents"),a.initEvent(t,!0,!1),a=y(a,n),e.dispatchEvent(a)):s.createEventObject&&(a=s.createEventObject(),a=y(a,n),e.fireEvent("on"+t,a))},l=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},c=function(e,t){return-1!==(" "+e.className+" ").indexOf(" "+t+" ")},d=function(e,t){c(e,t)||(e.className=""===e.className?t:e.className+" "+t)},u=function(e,t){e.className=l((" "+e.className+" ").replace(" "+t+" "," "))},p=function(e){return/Array/.test(Object.prototype.toString.call(e))},h=function(e){return/Date/.test(Object.prototype.toString.call(e))&&!isNaN(e.getTime())},f=function(e){return e%4===0&&e%100!==0||e%400===0},m=function(e,t){return[31,f(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},v=function(e){h(e)&&e.setHours(0,0,0,0)},g=function(e,t){return e.getTime()===t.getTime()},y=function(e,t,n){var s,a;for(s in t)a=void 0!==e[s],a&&"object"==typeof t[s]&&void 0===t[s].nodeName?h(t[s])?n&&(e[s]=new Date(t[s].getTime())):p(t[s])?n&&(e[s]=t[s].slice(0)):e[s]=y({},t[s],n):(n||!a)&&(e[s]=t[s]);return e},D=function(e){return e.month<0&&(e.year-=Math.ceil(Math.abs(e.month)/12),e.month+=12),e.month>11&&(e.year+=Math.floor(Math.abs(e.month)/12),e.month-=12),e},_={field:null,bound:void 0,position:"bottom left",format:"YYYY-MM-DD",defaultDate:null,setDefaultDate:!1,firstDay:0,minDate:null,maxDate:null,yearRange:10,showWeekNumber:!1,minYear:0,maxYear:9999,minMonth:void 0,maxMonth:void 0,isRTL:!1,yearSuffix:"",showMonthAfterYear:!1,numberOfMonths:1,mainCalendar:"left",container:void 0,i18n:{previousMonth:"Previous Month",nextMonth:"Next Month",months:["January","February","March","April","May","June","July","August","September","October","November","December"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},onSelect:null,onOpen:null,onClose:null,onDraw:null},M=function(e,t,n){for(t+=e.firstDay;t>=7;)t-=7;return n?e.i18n.weekdaysShort[t]:e.i18n.weekdays[t]},b=function(e,t,n,s,a,i,r){if(r)return'<td class="is-empty"></td>';var o=[];return i&&o.push("is-disabled"),a&&o.push("is-today"),s&&o.push("is-selected"),'<td data-day="'+e+'" class="'+o.join(" ")+'"><button class="pika-button pika-day" type="button" data-pika-year="'+n+'" data-pika-month="'+t+'" data-pika-day="'+e+'">'+e+"</button></td>"},w=function(e,t,n){var s=new Date(n,0,1),a=Math.ceil(((new Date(n,t,e)-s)/864e5+s.getDay()+1)/7);return'<td class="pika-week">'+a+"</td>"},O=function(e,t){return"<tr>"+(t?e.reverse():e).join("")+"</tr>"},k=function(e){return"<tbody>"+e.join("")+"</tbody>"},S=function(e){var t,n=[];for(e.showWeekNumber&&n.push("<th></th>"),t=0;7>t;t++)n.push('<th scope="col"><abbr title="'+M(e,t)+'">'+M(e,t,!0)+"</abbr></th>");return"<thead>"+(e.isRTL?n.reverse():n).join("")+"</thead>"},C=function(e,t,n,s,a){var i,r,o,l,c,d=e._o,u=n===d.minYear,h=n===d.maxYear,f='<div class="pika-title">',m=!0,v=!0;for(o=[],i=0;12>i;i++)o.push('<option value="'+(n===a?i-t:12+i-t)+'"'+(i===s?" selected":"")+(u&&i<d.minMonth||h&&i>d.maxMonth?"disabled":"")+">"+d.i18n.months[i]+"</option>");for(l='<div class="pika-label">'+d.i18n.months[s]+'<select class="pika-select pika-select-month">'+o.join("")+"</select></div>",p(d.yearRange)?(i=d.yearRange[0],r=d.yearRange[1]+1):(i=n-d.yearRange,r=1+n+d.yearRange),o=[];r>i&&i<=d.maxYear;i++)i>=d.minYear&&o.push('<option value="'+i+'"'+(i===n?" selected":"")+">"+i+"</option>");return c='<div class="pika-label">'+n+d.yearSuffix+'<select class="pika-select pika-select-year">'+o.join("")+"</select></div>",f+=d.showMonthAfterYear?c+l:l+c,u&&(0===s||d.minMonth>=s)&&(m=!1),h&&(11===s||d.maxMonth<=s)&&(v=!1),0===t&&(f+='<button class="pika-prev'+(m?"":" is-disabled")+'" type="button">'+d.i18n.previousMonth+"</button>"),t===e._o.numberOfMonths-1&&(f+='<button class="pika-next'+(v?"":" is-disabled")+'" type="button">'+d.i18n.nextMonth+"</button>"),f+="</div>"},N=function(e,t){return'<table cellpadding="0" cellspacing="0" class="pika-table">'+S(e)+k(t)+"</table>"},E=function(r){var o=this,l=o.config(r);o._onMouseDown=function(e){if(o._v){e=e||window.event;var t=e.target||e.srcElement;if(t){if(!c(t,"is-disabled")){if(c(t,"pika-button")&&!c(t,"is-empty"))return o.setDate(new Date(t.getAttribute("data-pika-year"),t.getAttribute("data-pika-month"),t.getAttribute("data-pika-day"))),void(l.bound&&a(function(){o.hide(),l.field&&l.field.blur()},100));c(t,"pika-prev")?o.prevMonth():c(t,"pika-next")&&o.nextMonth()}if(c(t,"pika-select"))o._c=!0;else{if(!e.preventDefault)return e.returnValue=!1,!1;e.preventDefault()}}}},o._onChange=function(e){e=e||window.event;var t=e.target||e.srcElement;t&&(c(t,"pika-select-month")?o.gotoMonth(t.value):c(t,"pika-select-year")&&o.gotoYear(t.value))},o._onInputChange=function(n){var s;n.firedBy!==o&&(t?(s=e(l.field.value,l.format),s=s&&s.isValid()?s.toDate():null):s=new Date(Date.parse(l.field.value)),o.setDate(h(s)?s:null),o._v||o.show())},o._onInputFocus=function(){o.show()},o._onInputClick=function(){o.show()},o._onInputBlur=function(){o._c||(o._b=a(function(){o.hide()},50)),o._c=!1},o._onClick=function(e){e=e||window.event;var t=e.target||e.srcElement,s=t;if(t){!n&&c(t,"pika-select")&&(t.onchange||(t.setAttribute("onchange","return;"),i(t,"change",o._onChange)));do if(c(s,"pika-single"))return;while(s=s.parentNode);o._v&&t!==l.trigger&&o.hide()}},o.el=s.createElement("div"),o.el.className="pika-single"+(l.isRTL?" is-rtl":""),i(o.el,"mousedown",o._onMouseDown,!0),i(o.el,"change",o._onChange),l.field&&(l.container?l.container.appendChild(o.el):l.bound?s.body.appendChild(o.el):l.field.parentNode.insertBefore(o.el,l.field.nextSibling),i(l.field,"change",o._onInputChange),l.defaultDate||(l.defaultDate=t&&l.field.value?e(l.field.value,l.format).toDate():new Date(Date.parse(l.field.value)),l.setDefaultDate=!0));var d=l.defaultDate;h(d)?l.setDefaultDate?o.setDate(d,!0):o.gotoDate(d):o.gotoDate(new Date),l.bound?(this.hide(),o.el.className+=" is-bound",i(l.trigger,"click",o._onInputClick),i(l.trigger,"focus",o._onInputFocus),i(l.trigger,"blur",o._onInputBlur)):this.show()};return E.prototype={config:function(e){this._o||(this._o=y({},_,!0));var t=y(this._o,e,!0);t.isRTL=!!t.isRTL,t.field=t.field&&t.field.nodeName?t.field:null,t.bound=!!(void 0!==t.bound?t.field&&t.bound:t.field),t.trigger=t.trigger&&t.trigger.nodeName?t.trigger:t.field;var n=parseInt(t.numberOfMonths,10)||1;if(t.numberOfMonths=n>4?4:n,h(t.minDate)||(t.minDate=!1),h(t.maxDate)||(t.maxDate=!1),t.minDate&&t.maxDate&&t.maxDate<t.minDate&&(t.maxDate=t.minDate=!1),t.minDate&&(v(t.minDate),t.minYear=t.minDate.getFullYear(),t.minMonth=t.minDate.getMonth()),t.maxDate&&(v(t.maxDate),t.maxYear=t.maxDate.getFullYear(),t.maxMonth=t.maxDate.getMonth()),p(t.yearRange)){var s=(new Date).getFullYear()-10;t.yearRange[0]=parseInt(t.yearRange[0],10)||s,t.yearRange[1]=parseInt(t.yearRange[1],10)||s}else t.yearRange=Math.abs(parseInt(t.yearRange,10))||_.yearRange,t.yearRange>100&&(t.yearRange=100);return t},toString:function(n){return h(this._d)?t?e(this._d).format(n||this._o.format):this._d.toDateString():""},getMoment:function(){return t?e(this._d):null},setMoment:function(n,s){t&&e.isMoment(n)&&this.setDate(n.toDate(),s)},getDate:function(){return h(this._d)?new Date(this._d.getTime()):null},setDate:function(e,t){if(!e)return this._d=null,this._o.field&&(this._o.field.value="",o(this._o.field,"change",{firedBy:this})),this.draw();if("string"==typeof e&&(e=new Date(Date.parse(e))),h(e)){var n=this._o.minDate,s=this._o.maxDate;h(n)&&n>e?e=n:h(s)&&e>s&&(e=s),this._d=new Date(e.getTime()),v(this._d),this.gotoDate(this._d),this._o.field&&(this._o.field.value=this.toString(),o(this._o.field,"change",{firedBy:this})),t||"function"!=typeof this._o.onSelect||this._o.onSelect.call(this,this.getDate())}},gotoDate:function(e){var t=!0;if(h(e)){if(this.calendars){var n=new Date(this.calendars[0].year,this.calendars[0].month,1),s=new Date(this.calendars[this.calendars.length-1].year,this.calendars[this.calendars.length-1].month,1),a=e.getTime();s.setMonth(s.getMonth()+1),s.setDate(s.getDate()-1),t=a<n.getTime()||s.getTime()<a}t&&(this.calendars=[{month:e.getMonth(),year:e.getFullYear()}],"right"===this._o.mainCalendar&&(this.calendars[0].month+=1-this._o.numberOfMonths)),this.adjustCalendars()}},adjustCalendars:function(){this.calendars[0]=D(this.calendars[0]);for(var e=1;e<this._o.numberOfMonths;e++)this.calendars[e]=D({month:this.calendars[0].month+e,year:this.calendars[0].year});this.draw()},gotoToday:function(){this.gotoDate(new Date)},gotoMonth:function(e){isNaN(e)||(this.calendars[0].month=parseInt(e,10),this.adjustCalendars())},nextMonth:function(){this.calendars[0].month++,this.adjustCalendars()},prevMonth:function(){this.calendars[0].month--,this.adjustCalendars()},gotoYear:function(e){isNaN(e)||(this.calendars[0].year=parseInt(e,10),this.adjustCalendars())},setMinDate:function(e){this._o.minDate=e},setMaxDate:function(e){this._o.maxDate=e},draw:function(e){if(this._v||e){var t=this._o,n=t.minYear,s=t.maxYear,i=t.minMonth,r=t.maxMonth,o="";this._y<=n&&(this._y=n,!isNaN(i)&&this._m<i&&(this._m=i)),this._y>=s&&(this._y=s,!isNaN(r)&&this._m>r&&(this._m=r));for(var l=0;l<t.numberOfMonths;l++)o+='<div class="pika-lendar">'+C(this,l,this.calendars[l].year,this.calendars[l].month,this.calendars[0].year)+this.render(this.calendars[l].year,this.calendars[l].month)+"</div>";if(this.el.innerHTML=o,t.bound&&"hidden"!==t.field.type&&a(function(){t.trigger.focus()},1),"function"==typeof this._o.onDraw){var c=this;a(function(){c._o.onDraw.call(c)},0)}}},adjustPosition:function(){if(!this._o.container){var e,t,n,a=this._o.trigger,i=a,r=this.el.offsetWidth,o=this.el.offsetHeight,l=window.innerWidth||s.documentElement.clientWidth,c=window.innerHeight||s.documentElement.clientHeight,d=window.pageYOffset||s.body.scrollTop||s.documentElement.scrollTop;if("function"==typeof a.getBoundingClientRect)n=a.getBoundingClientRect(),e=n.left+window.pageXOffset,t=n.bottom+window.pageYOffset;else for(e=i.offsetLeft,t=i.offsetTop+i.offsetHeight;i=i.offsetParent;)e+=i.offsetLeft,t+=i.offsetTop;(e+r>l||this._o.position.indexOf("right")>-1&&e-r+a.offsetWidth>0)&&(e=e-r+a.offsetWidth),(t+o>c+d||this._o.position.indexOf("top")>-1&&t-o-a.offsetHeight>0)&&(t=t-o-a.offsetHeight),this.el.style.cssText=["position: absolute","left: "+e+"px","top: "+t+"px"].join(";")}},render:function(e,t){var n=this._o,s=new Date,a=m(e,t),i=new Date(e,t,1).getDay(),r=[],o=[];v(s),n.firstDay>0&&(i-=n.firstDay,0>i&&(i+=7));for(var l=a+i,c=l;c>7;)c-=7;l+=7-c;for(var d=0,u=0;l>d;d++){var p=new Date(e,t,1+(d-i)),f=n.minDate&&p<n.minDate||n.maxDate&&p>n.maxDate,y=h(this._d)?g(p,this._d):!1,D=g(p,s),_=i>d||d>=a+i;o.push(b(1+(d-i),t,e,y,D,f,_)),7===++u&&(n.showWeekNumber&&o.unshift(w(d-i,t,e)),r.push(O(o,n.isRTL)),o=[],u=0)}return N(n,r)},isVisible:function(){return this._v},show:function(){this._v||(u(this.el,"is-hidden"),this._v=!0,this.draw(),this._o.bound&&(i(s,"click",this._onClick),this.adjustPosition()),"function"==typeof this._o.onOpen&&this._o.onOpen.call(this))},hide:function(){var e=this._v;e!==!1&&(this._o.bound&&r(s,"click",this._onClick),this.el.style.cssText="",d(this.el,"is-hidden"),this._v=!1,void 0!==e&&"function"==typeof this._o.onClose&&this._o.onClose.call(this))},destroy:function(){this.hide(),r(this.el,"mousedown",this._onMouseDown,!0),r(this.el,"change",this._onChange),this._o.field&&(r(this._o.field,"change",this._onInputChange),this._o.bound&&(r(this._o.trigger,"click",this._onInputClick),r(this._o.trigger,"focus",this._onInputFocus),r(this._o.trigger,"blur",this._onInputBlur))),this.el.parentNode&&this.el.parentNode.removeChild(this.el)}},E}),define("jstz",[],function(){return function(e){var t=function(){var e="s",n={DAY:864e5,HOUR:36e5,MINUTE:6e4,SECOND:1e3,BASELINE_YEAR:2014,MAX_SCORE:864e6,AMBIGUITIES:{"America/Denver":["America/Mazatlan"],"America/Chicago":["America/Mexico_City"],"America/Santiago":["America/Asuncion","America/Campo_Grande"],"America/Montevideo":["America/Sao_Paulo"],"Asia/Beirut":["Asia/Amman","Asia/Jerusalem","Europe/Helsinki","Asia/Damascus","Africa/Cairo","Asia/Gaza","Europe/Minsk"],"Pacific/Auckland":["Pacific/Fiji"],"America/Los_Angeles":["America/Santa_Isabel"],"America/New_York":["America/Havana"],"America/Halifax":["America/Goose_Bay"],"America/Godthab":["America/Miquelon"],"Asia/Dubai":["Asia/Yerevan"],"Asia/Jakarta":["Asia/Krasnoyarsk"],"Asia/Shanghai":["Asia/Irkutsk","Australia/Perth"],"Australia/Sydney":["Australia/Lord_Howe"],"Asia/Tokyo":["Asia/Yakutsk"],"Asia/Dhaka":["Asia/Omsk"],"Asia/Baku":["Asia/Yerevan"],"Australia/Brisbane":["Asia/Vladivostok"],"Pacific/Noumea":["Asia/Vladivostok"],"Pacific/Majuro":["Asia/Kamchatka","Pacific/Fiji"],"Pacific/Tongatapu":["Pacific/Apia"],"Asia/Baghdad":["Europe/Minsk","Europe/Moscow"],"Asia/Karachi":["Asia/Yekaterinburg"],"Africa/Johannesburg":["Asia/Gaza","Africa/Cairo"]}},s=function(e){var t=-e.getTimezoneOffset();return null!==t?t:0},a=function(){var t=s(new Date(n.BASELINE_YEAR,0,2)),a=s(new Date(n.BASELINE_YEAR,5,2)),i=t-a;return 0>i?t+",1":i>0?a+",1,"+e:t+",0"},i=function(){if("undefined"!=typeof Intl&&"undefined"!=typeof Intl.DateTimeFormat){var e=Intl.DateTimeFormat();if("undefined"!=typeof e&&"undefined"!=typeof e.resolvedOptions)return e.resolvedOptions().timeZone}},r=function(e){for(var t=new Date(e,0,1,0,0,1,0).getTime(),n=new Date(e,12,31,23,59,59).getTime(),s=t,a=new Date(s).getTimezoneOffset(),i=null,r=null;n-864e5>s;){var l=new Date(s),c=l.getTimezoneOffset();c!==a&&(a>c&&(i=l),c>a&&(r=l),a=c),s+=864e5}return i&&r?{s:o(i).getTime(),e:o(r).getTime()}:!1},o=function p(e,t,s){"undefined"==typeof t&&(t=n.DAY,s=n.HOUR);for(var a=new Date(e.getTime()-t).getTime(),i=e.getTime()+t,r=new Date(a).getTimezoneOffset(),o=a,l=null;i-s>o;){var c=new Date(o),d=c.getTimezoneOffset();if(d!==r){l=c;break}o+=s}return t===n.DAY?p(l,n.HOUR,n.MINUTE):t===n.HOUR?p(l,n.MINUTE,n.SECOND):l},l=function(e,t,n,s){if("N/A"!==n)return n;if("Asia/Beirut"===t){if("Africa/Cairo"===s.name&&13983768e5===e[6].s&&14116788e5===e[6].e)return 0;if("Asia/Jerusalem"===s.name&&13959648e5===e[6].s&&14118588e5===e[6].e)return 0}else if("America/Santiago"===t){if("America/Asuncion"===s.name&&14124816e5===e[6].s&&1397358e6===e[6].e)return 0;if("America/Campo_Grande"===s.name&&14136912e5===e[6].s&&13925196e5===e[6].e)return 0}else if("America/Montevideo"===t){if("America/Sao_Paulo"===s.name&&14136876e5===e[6].s&&1392516e6===e[6].e)return 0}else if("Pacific/Auckland"===t&&"Pacific/Fiji"===s.name&&14142456e5===e[6].s&&13961016e5===e[6].e)return 0;return n},c=function(e,s){for(var a=function(t){for(var a=0,i=0;i<e.length;i++)if(t.rules[i]&&e[i]){if(!(e[i].s>=t.rules[i].s&&e[i].e<=t.rules[i].e)){a="N/A";break}if(a=0,a+=Math.abs(e[i].s-t.rules[i].s),a+=Math.abs(t.rules[i].e-e[i].e),a>n.MAX_SCORE){a="N/A";break}}return a=l(e,s,a,t)},i={},r=t.olson.dst_rules.zones,o=r.length,c=n.AMBIGUITIES[s],d=0;o>d;d++){var u=r[d],p=a(r[d]);"N/A"!==p&&(i[u.name]=p)}for(var h in i)if(i.hasOwnProperty(h)&&-1!=c.indexOf(h))return h;return s},d=function(e){var n=function(){for(var e=[],n=0;n<t.olson.dst_rules.years.length;n++){var s=r(t.olson.dst_rules.years[n]);e.push(s)}return e},s=function(e){for(var t=0;t<e.length;t++)if(e[t]!==!1)return!0;return!1},a=n(),i=s(a);return i?c(a,e):e},u=function(){var e=i();return e||(e=t.olson.timezones[a()],"undefined"!=typeof n.AMBIGUITIES[e]&&(e=d(e))),{name:function(){return e}}};return{determine:u}}();t.olson=t.olson||{},t.olson.timezones={"-720,0":"Etc/GMT+12","-660,0":"Pacific/Pago_Pago","-660,1,s":"Pacific/Apia","-600,1":"America/Adak","-600,0":"Pacific/Honolulu","-570,0":"Pacific/Marquesas","-540,0":"Pacific/Gambier","-540,1":"America/Anchorage","-480,1":"America/Los_Angeles","-480,0":"Pacific/Pitcairn","-420,0":"America/Phoenix","-420,1":"America/Denver","-360,0":"America/Guatemala","-360,1":"America/Chicago","-360,1,s":"Pacific/Easter","-300,0":"America/Bogota","-300,1":"America/New_York","-270,0":"America/Caracas","-240,1":"America/Halifax","-240,0":"America/Santo_Domingo","-240,1,s":"America/Santiago","-210,1":"America/St_Johns","-180,1":"America/Godthab","-180,0":"America/Argentina/Buenos_Aires","-180,1,s":"America/Montevideo","-120,0":"America/Noronha","-120,1":"America/Noronha","-60,1":"Atlantic/Azores","-60,0":"Atlantic/Cape_Verde","0,0":"UTC","0,1":"Europe/London","60,1":"Europe/Berlin","60,0":"Africa/Lagos","60,1,s":"Africa/Windhoek","120,1":"Asia/Beirut","120,0":"Africa/Johannesburg","180,0":"Asia/Baghdad","180,1":"Europe/Moscow","210,1":"Asia/Tehran","240,0":"Asia/Dubai","240,1":"Asia/Baku","270,0":"Asia/Kabul","300,1":"Asia/Yekaterinburg","300,0":"Asia/Karachi","330,0":"Asia/Kolkata","345,0":"Asia/Kathmandu","360,0":"Asia/Dhaka","360,1":"Asia/Omsk","390,0":"Asia/Rangoon","420,1":"Asia/Krasnoyarsk","420,0":"Asia/Jakarta","480,0":"Asia/Shanghai","480,1":"Asia/Irkutsk","525,0":"Australia/Eucla","525,1,s":"Australia/Eucla","540,1":"Asia/Yakutsk","540,0":"Asia/Tokyo","570,0":"Australia/Darwin","570,1,s":"Australia/Adelaide","600,0":"Australia/Brisbane","600,1":"Asia/Vladivostok","600,1,s":"Australia/Sydney","630,1,s":"Australia/Lord_Howe","660,1":"Asia/Kamchatka","660,0":"Pacific/Noumea","690,0":"Pacific/Norfolk","720,1,s":"Pacific/Auckland","720,0":"Pacific/Majuro","765,1,s":"Pacific/Chatham","780,0":"Pacific/Tongatapu","780,1,s":"Pacific/Apia","840,0":"Pacific/Kiritimati"},t.olson.dst_rules={years:[2008,2009,2010,2011,2012,2013,2014],zones:[{name:"Africa/Cairo",rules:[{e:12199572e5,s:12090744e5},{e:1250802e6,s:1240524e6},{e:12858804e5,s:12840696e5},!1,!1,!1,{e:14116788e5,s:1406844e6}]},{name:"America/Asuncion",rules:[{e:12050316e5,s:12243888e5},{e:12364812e5,s:12558384e5},{e:12709548e5,s:12860784e5},{e:13024044e5,s:1317528e6},{e:1333854e6,s:13495824e5},{e:1364094e6,s:1381032e6},{e:13955436e5,s:14124816e5}]},{name:"America/Campo_Grande",rules:[{e:12032172e5,s:12243888e5},{e:12346668e5,s:12558384e5},{e:12667212e5,s:1287288e6},{e:12981708e5,s:13187376e5},{e:13302252e5,s:1350792e6},{e:136107e7,s:13822416e5},{e:13925196e5,s:14136912e5}]},{name:"America/Goose_Bay",rules:[{e:122559486e4,s:120503526e4},{e:125704446e4,s:123648486e4},{e:128909886e4,s:126853926e4},{e:13205556e5,s:129998886e4},{e:13520052e5,s:13314456e5},{e:13834548e5,s:13628952e5},{e:14149044e5,s:13943448e5}]},{name:"America/Havana",rules:[{e:12249972e5,s:12056436e5},{e:12564468e5,s:12364884e5},{e:12885012e5,s:12685428e5},{e:13211604e5,s:13005972e5},{e:13520052e5,s:13332564e5},{e:13834548e5,s:13628916e5},{e:14149044e5,s:13943412e5}]},{name:"America/Mazatlan",rules:[{e:1225008e6,s:12074724e5},{e:12564576e5,s:1238922e6},{e:1288512e6,s:12703716e5},{e:13199616e5,s:13018212e5},{e:13514112e5,s:13332708e5},{e:13828608e5,s:13653252e5},{e:14143104e5,s:13967748e5}]},{name:"America/Mexico_City",rules:[{e:12250044e5,s:12074688e5},{e:1256454e6,s:12389184e5},{e:12885084e5,s:1270368e6},{e:1319958e6,s:13018176e5},{e:13514076e5,s:13332672e5},{e:13828572e5,s:13653216e5},{e:14143068e5,s:13967712e5}]},{name:"America/Miquelon",rules:[{e:12255984e5,s:12050388e5},{e:1257048e6,s:12364884e5},{e:12891024e5,s:12685428e5},{e:1320552e6,s:12999924e5},{e:13520016e5,s:1331442e6},{e:13834512e5,s:13628916e5},{e:14149008e5,s:13943412e5}]},{name:"America/Santa_Isabel",rules:[{e:12250116e5,s:1207476e6},{e:12564612e5,s:12389256e5},{e:12885156e5,s:12703752e5},{e:13199652e5,s:13018248e5},{e:13514148e5,s:13332744e5},{e:13828644e5,s:13653288e5},{e:1414314e6,s:13967784e5}]},{name:"America/Sao_Paulo",rules:[{e:12032136e5,s:12243852e5},{e:12346632e5,s:12558348e5},{e:12667176e5,s:12872844e5},{e:12981672e5,s:1318734e6},{e:13302216e5,s:13507884e5},{e:13610664e5,s:1382238e6},{e:1392516e6,s:14136876e5}]},{name:"Asia/Amman",rules:[{e:1225404e6,s:12066552e5},{e:12568536e5,s:12381048e5},{e:12883032e5,s:12695544e5},{e:13197528e5,s:13016088e5},!1,!1,{e:14147064e5,s:13959576e5}]},{name:"Asia/Damascus",rules:[{e:12254868e5,s:120726e7},{e:125685e7,s:12381048e5},{e:12882996e5,s:12701592e5},{e:13197492e5,s:13016088e5},{e:13511988e5,s:13330584e5},{e:13826484e5,s:1364508e6},{e:14147028e5,s:13959576e5}]},{name:"Asia/Dubai",rules:[!1,!1,!1,!1,!1,!1,!1]},{name:"Asia/Gaza",rules:[{e:12199572e5,s:12066552e5},{e:12520152e5,s:12381048e5},{e:1281474e6,s:126964086e4},{e:1312146e6,s:130160886e4},{e:13481784e5,s:13330584e5},{e:13802292e5,s:1364508e6},{e:14116788e5,s:13959576e5}]},{name:"Asia/Irkutsk",rules:[{e:12249576e5,s:12068136e5},{e:12564072e5,s:12382632e5},{e:12884616e5,s:12697128e5},!1,!1,!1,!1]},{name:"Asia/Jerusalem",rules:[{e:12231612e5,s:12066624e5},{e:1254006e6,s:1238112e6},{e:1284246e6,s:12695616e5},{e:131751e7,s:1301616e6},{e:13483548e5,s:13330656e5},{e:13828284e5,s:13645152e5},{e:1414278e6,s:13959648e5}]},{name:"Asia/Kamchatka",rules:[{e:12249432e5,s:12067992e5},{e:12563928e5,s:12382488e5},{e:12884508e5,s:12696984e5},!1,!1,!1,!1]},{name:"Asia/Krasnoyarsk",rules:[{e:12249612e5,s:12068172e5},{e:12564108e5,s:12382668e5},{e:12884652e5,s:12697164e5},!1,!1,!1,!1]},{name:"Asia/Omsk",rules:[{e:12249648e5,s:12068208e5},{e:12564144e5,s:12382704e5},{e:12884688e5,s:126972e7},!1,!1,!1,!1]},{name:"Asia/Vladivostok",rules:[{e:12249504e5,s:12068064e5},{e:12564e8,s:1238256e6},{e:12884544e5,s:12697056e5},!1,!1,!1,!1]},{name:"Asia/Yakutsk",rules:[{e:1224954e6,s:120681e7},{e:12564036e5,s:12382596e5},{e:1288458e6,s:12697092e5},!1,!1,!1,!1]},{name:"Asia/Yekaterinburg",rules:[{e:12249684e5,s:12068244e5},{e:1256418e6,s:1238274e6},{e:12884724e5,s:12697236e5},!1,!1,!1,!1]},{name:"Asia/Yerevan",rules:[{e:1224972e6,s:1206828e6},{e:12564216e5,s:12382776e5},{e:1288476e6,s:12697272e5},{e:13199256e5,s:13011768e5},!1,!1,!1]},{name:"Australia/Lord_Howe",rules:[{e:12074076e5,s:12231342e5},{e:12388572e5,s:12545838e5},{e:12703068e5,s:12860334e5},{e:13017564e5,s:1317483e6},{e:1333206e6,s:13495374e5},{e:13652604e5,s:1380987e6},{e:139671e7,s:14124366e5}]},{name:"Australia/Perth",rules:[{e:12068136e5,s:12249576e5},!1,!1,!1,!1,!1,!1]},{name:"Europe/Helsinki",rules:[{e:12249828e5,s:12068388e5},{e:12564324e5,s:12382884e5},{e:12884868e5,s:1269738e6},{e:13199364e5,s:13011876e5},{e:1351386e6,s:13326372e5},{e:13828356e5,s:13646916e5},{e:14142852e5,s:13961412e5}]},{name:"Europe/Minsk",rules:[{e:12249792e5,s:12068352e5},{e:12564288e5,s:12382848e5},{e:12884832e5,s:12697344e5},!1,!1,!1,!1]},{name:"Europe/Moscow",rules:[{e:12249756e5,s:12068316e5},{e:12564252e5,s:12382812e5},{e:12884796e5,s:12697308e5},!1,!1,!1,!1]},{name:"Pacific/Apia",rules:[!1,!1,!1,{e:13017528e5,s:13168728e5},{e:13332024e5,s:13489272e5},{e:13652568e5,s:13803768e5},{e:13967064e5,s:14118264e5}]},{name:"Pacific/Fiji",rules:[!1,!1,{e:12696984e5,s:12878424e5},{e:13271544e5,s:1319292e6},{e:1358604e6,s:13507416e5},{e:139005e7,s:1382796e6},{e:14215032e5,s:14148504e5}]}]},"undefined"!=typeof exports?exports.jstz=t:e.jstz=t
}(this),jstz}),define("plannerWidget",["react","plannerStore","moment"],function(e,t,n){var s={},a=function(e,t){return s=t,c(e)},i=function(e,t){return s=t,r(e)},r=e.createClass({componentDidMount:function(){t.on("change",this._onChange)},componentWillUnmount:function(){t.removeListener("change",this._onChange)},_onChange:function(){var e=t.getSelectedDate();this.setState({selectedDate:e,events:t.getEventsFor(e),selectedEvent:t.getSelectedEvent()}),t.hasPendingLoad()?this.load():this.turnOffLoad()},getInitialState:function(){return{day:n(),events:[],selectedDate:t.getSelectedDate(),selectedEvent:t.getSelectedEvent()}},load:function(){function e(e){require(["spin"],function(n){OC.hasOwnProperty("plannerSpinner")?OC.plannerSpinner.spin(t):OC.plannerSpinner=new n(OC.spinner.options).spin(t),e()})}var t=this.getDOMNode().querySelector(".ajax-loader");e(function(){OC.hasOwnProperty("plannerSpinner")&&OC.plannerSpinner.spin(t)})},turnOffLoad:function(){OC.hasOwnProperty("plannerSpinner")&&OC.plannerSpinner.stop()},renderDates:function(){var e,t,s=[],a=n(this.state.day).date(1),i=a.day();for(a.subtract(i,"d"),e=i;e>0;e--)s.push(o({isSibling:!0,date:a.date(),fulldate:a.format(),isSelected:this.state.selectedDate===a.format()})),a.add(1,"d");var r=n(this.state.day).endOf("month"),l=r.date(),c=n(),d=!1;for(r.date(0),t=1;l>=t;t++)d=r.isSame(c,"month")&&c.date()===t?!0:!1,r.add(1,"d"),s.push(o({date:r.date(),isToday:d,fulldate:r.format(),isSelected:this.state.selectedDate===r.format()}));for(lastDayOfMonth=r.day(),k=0;6-lastDayOfMonth>k;k++)r.add(1,"d"),s.push(o({isSibling:!0,date:r.date(),fulldate:r.format(),isSelected:this.state.selectedDate===r.format()}));return s},back:function(){this.setState({day:this.state.day.subtract(1,"M")})},forward:function(){this.setState({day:this.state.day.add(1,"M")})},cancelEventSelection:function(){s.cancelEventSelect()},confirmEventSelection:function(){s.confirmEventSelect(this.props.itemID,this.state.selectedEvent.id)},renderEvent:function(e){var t={event:e};return this.state.selectedEvent||(t.selected=!1),l(t)},renderDays:function(){return[e.DOM.div({className:"calendar-body-days-day"},"S"),e.DOM.div({className:"calendar-body-days-day"},"M"),e.DOM.div({className:"calendar-body-days-day"},"T"),e.DOM.div({className:"calendar-body-days-day"},"W"),e.DOM.div({className:"calendar-body-days-day"},"T"),e.DOM.div({className:"calendar-body-days-day"},"F"),e.DOM.div({className:"calendar-body-days-day"},"S")]},render:function(){return e.DOM.div({className:"planner-menu-body"},[e.DOM.div({className:"planner-menu-calendar"},[e.DOM.div({className:"calendar-header"},[e.DOM.div({className:"calendar-header-previous",onClick:this.back},e.DOM.span({className:"calendar-header-previous-arrow"})),e.DOM.div({className:"calendar-header-month"},this.state.day.format("MMMM YY")),e.DOM.div({className:"calendar-header-next",onClick:this.forward},e.DOM.span({className:"calendar-header-next-arrow"}))]),e.DOM.div({className:"calendar-body"},[e.DOM.div({className:"calendar-body-days"},this.renderDays()),e.DOM.div({className:"calendar-body-dates"},this.renderDates())])]),e.DOM.div({className:"planner-menu-events"},[this.state.events.length>0?e.DOM.div({className:"planner-menu-events-list"},this.state.events.map(this.renderEvent)):null,this.state.selectedEvent?e.DOM.div({className:"planner-menu-events-actions"},[e.DOM.div({className:"planner-menu-events-actions-buttons  popup-buttons"},[e.DOM.div({className:"planner-menu-events-actions-button popup-button secondary-popup-button",onClick:this.cancelEventSelection},"Cancel"),e.DOM.div({className:"planner-menu-events-actions-button popup-button",style:{color:OC.config.palette.base},onClick:this.confirmEventSelection},"Confirm")])]):null,e.DOM.div({className:"ajax-loader-wrapper"},e.DOM.div({className:"ajax-loader"}))])])}}),o=e.createClass({getInitialProps:function(){return{isSibling:!1,isToday:!1}},getInitialState:function(){return{isSelected:this.props.isSelected}},select:function(){s.dateSelect(this.props.fulldate),this.setState({isSelected:!0})},componentWillReceiveProps:function(e){e.isSelected!==this.state.isSelected&&this.setState({isSelected:e.isSelected})},render:function(){return e.DOM.div({className:"calendar-body-dates-date"+(this.props.isSibling?" sibling-month-date":"")+(this.props.isToday?" today":"")+(this.state.isSelected?" selected":""),onClick:this.select},this.props.date)}}),l=e.createClass({getInitialState:function(){return{selected:!1}},componentWillReceiveProps:function(e){e.hasOwnProperty("selected")&&e.selected!==this.props.selected&&this.setState({selected:e.selected})},select:function(){this.setState({selected:!this.state.selected},function(){this.state.selected?s.eventSelect(this.props.event.id,this.props.event.date):s.cancelEventSelect()})},render:function(){return e.DOM.div({className:"planner-menu-event "+OC.config.palette.title+"-planner-event"+(this.state.selected?" selected":""),onClick:this.select},[e.DOM.div({className:"planner-menu-event-title"},this.props.event.title),e.DOM.div({},[e.DOM.span({className:"planner-menu-event-time"},n(this.props.event.start).format("h:mma")+" - "+n(this.props.event.end).format("h:mma")+" ·"),e.DOM.a({className:"planner-menu-event-view",href:this.props.event.url},"View event")])])}}),c=e.createClass({render:function(){return e.DOM.nav({className:"oc-menu planner-menu"+(this.props.open?" show-menu":"")},[e.DOM.div({className:"floating-menu-spacer"},null),e.DOM.div({className:"menu-body"},[e.DOM.div({className:"planner-menu-body-wrapper"},r({itemID:this.props.id}))])])}});return{Widget:a,Calendar:i}}),define("curriculumActions",["dispatcher"],function(e){return{initTextbooks:function(t){e.dispatch({type:"SET_TEXTBOOKS",textbooks:t})},initUnits:function(t){e.dispatch({type:"SET_UNITS",units:t})},initSettings:function(t){e.dispatch({type:"INIT_SETTINGS",settings:t})},setNumWeeks:function(t){e.dispatch({type:"SET_NUM_WEEKS",count:t})},openUnit:function(t){e.dispatch({type:"OPEN_UNIT",unit:t})},buildSections:function(t,n){e.dispatch({type:"BUILD_SECTIONS",unitID:t,sections:n})},updateSettings:function(t){e.dispatch({type:"UPDATE_SETTINGS",settings:t})},saveSettings:function(t){e.dispatch({type:"SAVE_SETTINGS",settings:t})},settingsUpdated:function(){e.dispatch({type:"SETTINGS_UPDATED"})},openOverview:function(){e.dispatch({type:"OPEN_OVERVIEW"})},openSettings:function(){e.dispatch({type:"OPEN_SETTINGS"})},openUnits:function(t){e.dispatch({type:"OPEN_UNITS",mode:t?"add":"view"})},openTextbooks:function(){e.dispatch({type:"OPEN_TEXTBOOKS"})},addUnit:function(t,n,s,a){e.dispatch({type:"ADD_UNIT",name:t,textbook:n,from:s,to:a})},saveUnit:function(t){e.dispatch({type:"SAVE_UNIT",unit:t})},addUnitComplete:function(t){e.dispatch({type:"ADD_UNIT_COMPLETE",id:t})},addTextbook:function(t,n){e.dispatch({type:"ADD_TEXTBOOK",title:t,description:n})},saveTextbook:function(t){e.dispatch({type:"SAVE_TEXTBOOK",textbook:t})},addTextbookComplete:function(){e.dispatch({type:"ADD_TEXTBOOK_COMPLETE"})},openItem:function(t){e.dispatch({type:"OPEN_ITEM",item:t})},addItem:function(t){e.dispatch({type:"ADD_ITEM",sectionID:t})},addItemPost:function(t,n){e.dispatch({type:"ADD_ITEM_POST",item:t,sectionID:n||null})},addItemComplete:function(t,n,s){e.dispatch({type:"ADD_ITEM_COMPLETE",item:t,id:n,sectionID:s})},addToSection:function(t,n){e.dispatch({type:"ADD_ITEM_TO_SECTION",itemID:t,sectionID:n})},itemAddedToSection:function(t,n){e.dispatch({type:"ITEM_ADDED_TO_SECTION",itemID:t,sectionID:n})},addSection:function(t,n,s,a){e.dispatch({type:"ADD_SECTION",name:t,sectionType:n,moduleID:s,isUnit:a})},addSectionPost:function(t,n,s,a){e.dispatch({type:"ADD_SECTION_POST",section:t,moduleID:n,isUnit:s,callback:a})},addSectionComplete:function(t,n){e.dispatch({type:"ADD_SECTION_COMPLETE",section:n,id:t})},deleteSection:function(t){e.dispatch({type:"DELETE_SECTION",id:t})},updateItem:function(t,n){e.dispatch({type:"UPDATE_ITEM",props:t,callback:n})},itemUpdated:function(t){e.dispatch({type:"ITEM_UPDATED",props:t})},deleteItem:function(t){e.dispatch({type:"DELETE_ITEM",id:t})},addField:function(t,n,s,a){e.dispatch({type:"ADD_FIELD",name:t,fieldType:n,position:s,itemID:a})},addFieldPost:function(t,n,s){e.dispatch({type:"ADD_FIELD_POST",item:t,field:n,callback:s})},addFieldComplete:function(t,n){e.dispatch({type:"ADD_FIELD_COMPLETE",itemID:t,fieldID:n})},addResource:function(t,n){e.dispatch({type:"ADD_RESOURCE",resource:t,resourceSetID:n})},removeResource:function(t,n,s){e.dispatch({type:"REMOVE_RESOURCE",resourceID:t,resourceSetID:n,callback:s})},deleteMeta:function(t,n){e.dispatch({type:"DELETE_META",id:t,itemID:n})},deleteResourceSet:function(t){e.dispatch({type:"DELETE_RESOURCESET",id:t})},moveSection:function(t,n){e.dispatch({type:"MOVE_SECTION",sectionID:t,beforeSectionID:n})},moveSectionSave:function(t){e.dispatch({type:"MOVE_SECTION_SAVE",toShift:t})},moveSectionComplete:function(){e.dispatch({type:"MOVE_SECTION_COMPLETE"})},moveItem:function(t,n){e.dispatch({type:"MOVE_ITEM",itemID:t,beforeItemID:n})},moveItemSave:function(t){e.dispatch({type:"MOVE_ITEM_SAVE",toShift:t})},moveItemComplete:function(){e.dispatch({type:"MOVE_ITEM_COMPLETE"})},moveField:function(t,n,s,a,i){e.dispatch({type:"MOVE_FIELD",fieldID:t,beforeFieldID:n,itemID:s,toMoveIsMeta:a,beforeIsMeta:i})},moveFieldSave:function(t,n){e.dispatch({type:"MOVE_FIELD_SAVE",id:t,toShift:n})},moveFieldComplete:function(){e.dispatch({type:"MOVE_FIELD_COMPLETE"})},launchPlanner:function(){e.dispatch({type:"LAUNCH_PLANNER"})},selectDate:function(t){e.dispatch({type:"SELECT_DATE",date:t})},selectDateComplete:function(t,n){e.dispatch({type:"SELECT_DATE_COMPLETE",date:t,response:n})},selectPlannerEvent:function(t,n){e.dispatch({type:"SELECT_PLANNER_EVENT",id:t,date:n})},clearEventSelection:function(){e.dispatch({type:"CLEAR_EVENT_SELECTION"})},confirmAddItemToEvent:function(t,n){e.dispatch({type:"ADD_ITEM_TO_EVENT",itemID:t,eventID:n})},itemAddedToEvent:function(){e.dispatch({type:"ITEM_ADDED_TO_EVENT"})},removeItemFromEvent:function(t,n){e.dispatch({type:"REMOVE_ITEM_FROM_EVENT",itemID:t,eventID:n})},dim:function(){e.dispatch({type:"DIM"})},brighten:function(){e.dispatch({type:"BRIGHTEN"})}}}),define("plannerAPI",["atomic","dispatcher","curriculumActions"],function(e,t,n){OC.hasOwnProperty("api")||(OC.api={}),OC.api.planner={get:function(t){require(["jstz"],function(s){e.get("/planner/daily/"+t+"/zone/"+encodeURIComponent(s.determine().name())+"/").success(function(e){n.selectDateComplete(t,e)})})},addItem:function(t,s){e.post("/planner/event/add-item/",{item_id:t,event_id:s}).success(function(){n.itemAddedToEvent()})},removeItem:function(t,n){e.post("/planner/event/remove-item/",{item_id:t,event_id:n}).success(function(){})}},t.register(function(e){switch(e.type){case"SELECT_DATE":OC.api.planner.get(e.date);break;case"ADD_ITEM_TO_EVENT":OC.api.planner.addItem(e.itemID,e.eventID);break;case"REMOVE_ITEM_FROM_EVENT":OC.api.planner.removeItem(e.itemID,e.eventID);break;default:return!0}})});