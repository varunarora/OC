define(["atomic","curriculumAppDispatcher","curriculumActions","curriculumSettings","plannerAPI"],function(e,t,i,c){OC.api.curriculum={sectionItem:{update:function(t,c){e.post("/curriculum/api/section-item/update/",t).success(function(e){t.hasOwnProperty("meta")||i.itemUpdated(t),c(e)})},create:function(t,u){var s={description:t.get("description"),section_id:t.get("sectionID"),curriculum_id:c.getID(),position:t.get("position")};e.post("/curriculum/api/section-item/create/",s).success(function(e){i.addItemComplete(t,e.id),u(e.id)})},"delete":function(t){e.delete("/curriculum/api/section-item/"+t+"/delete/").success(function(){})},createResourceSet:function(t,i){e.post("/curriculum/api/section-item/create-resource-set/",t).success(function(e){i(t.id,e.id)})},deleteMeta:function(t,i){e.delete("/curriculum/api/section-item/"+t+"/delete-meta/"+i+"/").success(function(){})},reposition:function(t){e.post("/curriculum/api/section-items/reposition/",t).success(function(e){i.moveItemComplete(e)})},repositionMeta:function(t,c){e.post("/curriculum/api/meta/"+t+"/reposition/",c).success(function(e){i.moveFieldComplete(e)})}},section:{get:function(t){e.get("/curriculum/api/sections/"+t+"/").success(function(e){i.buildSections(t,e)})},addItem:function(t,c){e.post("/curriculum/api/section-item/add-item-to-section/",{id:c,item_id:t}).success(function(){i.itemAddedToSection(t)})},create:function(t,c,u,s){var r={title:t.get("title"),section_type:t.get("type"),position:t.get("position"),parent_id:c,is_unit:u};e.post("/curriculum/api/section/create/",r).success(function(e){i.addSectionComplete(t,e.id),s(e.id)})},"delete":function(t){e.delete("/curriculum/api/section/"+t+"/delete/").success(function(){})},reposition:function(t){e.post("/curriculum/api/sections/reposition/",t).success(function(e){i.moveSectionComplete(e)})}},issues:{update:function(t,i){e.post("/curriculum/api/issue/create-update/",JSON.stringify(t)).success(function(e){i(e)})}},resources:{"delete":function(t,i){e.post("/curriculum/api/section-item/remove-resource/",JSON.stringify(t)).success(function(e){i(e)})}},resourceSet:{"delete":function(t){e.delete("/curriculum/api/section-item-resources/"+t+"/delete/").success(function(){})}},textbook:{create:function(t){e.post("/curriculum/api/textbook/create/",t).success(function(e){i.addTextbookComplete(e.id)})}},unit:{create:function(t){e.post("/curriculum/api/unit/create/",t).success(function(e){i.addUnitComplete(e.id)})}},settings:{update:function(t){e.post("/curriculum/api/settings/update/",t).success(function(e){i.settingsUpdated(e)})},pushChanges:function(t,i){e.get("/curriculum/api/curriculum/"+t+"/push/").success(function(e){i(e)})},pauseChanges:function(t,i){e.get("/curriculum/api/curriculum/"+t+"/pause/").success(function(e){i(e)})}}},t.register(function(e){switch(e.type){case"SAVE_SETTINGS":OC.api.curriculum.settings.update(e.settings,function(){});break;case"OPEN_UNIT":e.unit.hasOwnProperty("sections")||OC.api.curriculum.section.get(e.unit.id);break;case"SAVE_UNIT":OC.api.curriculum.unit.create(e.unit);break;case"SAVE_TEXTBOOK":OC.api.curriculum.textbook.create(e.textbook);break;case"ADD_ITEM_POST":OC.api.curriculum.sectionItem.create(e.item,e.callback);break;case"ADD_ITEM_TO_SECTION":OC.api.curriculum.section.addItem(e.itemID,e.sectionID);break;case"DELETE_ITEM":OC.api.curriculum.sectionItem.delete(e.id);break;case"ADD_SECTION_POST":OC.api.curriculum.section.create(e.section,e.moduleID,e.isUnit,e.callback);break;case"DELETE_SECTION":OC.api.curriculum.section.delete(e.id);break;case"UPDATE_ITEM":OC.api.curriculum.sectionItem.update(e.props,e.callback);break;case"ADD_FIELD_POST":var t=e.item,i=e.field;i.hasOwnProperty("meta")?(serializedItem={meta:[i.meta],id:t.get("id")},OC.api.curriculum.sectionItem.update(serializedItem,e.callback)):OC.api.curriculum.sectionItem.createResourceSet({id:t.get("id"),title:i.get("resource_set").title,position:i.get("resource_set").position},e.callback);break;case"DELETE_META":OC.api.curriculum.sectionItem.deleteMeta(e.itemID,e.id);break;case"DELETE_RESOURCESET":OC.api.curriculum.resourceSet.delete(e.id);break;case"MOVE_SECTION_SAVE":OC.api.curriculum.section.reposition(e.toShift);break;case"MOVE_ITEM_SAVE":OC.api.curriculum.sectionItem.reposition(e.toShift);break;case"MOVE_FIELD_SAVE":OC.api.curriculum.sectionItem.repositionMeta(e.id,e.toShift);break;default:return!0}})});