{% include 'partials/header.html' with body_class='browse' %}

<script src="{{ STATIC_URL }}js/jquery.nanoscroller.min.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}js/backbone-min.js" type="text/javascript"></script>
<script src="{{ STATIC_URL }}js/category-resources.js" type="text/javascript"></script>
<script type="text/javascript">
    OC.categoryResources.currentCategoryID = '{{ current_category_id.id }}'
</script>

<div class="center-spread resource-browse">
    <div class="category-panel">
        <div class="category-panel-listing">
            <div class="category-choice-wrapper">
                Categories based on <a class="category-choice">Common Core</a>
            </div>
            {% if query %}
                <ul class="category-panel-listing-search-category">
                    <li class="selected-category"><a href="">Search for '{{ query }}'</a></li>
                </ul>
            {% else %}
            {% if selected_category.parent.slug != 'common-core' and selected_category.parent.slug != 'opencurriculum' %}
                <a href="{{ return_url }}" class="category-return"><span class="reverse-vertical-caret"></span>Back to {{ selected_category.parent.parent.title }}</a>
                <div class="category-parent">{{ selected_category.parent.title }}</div>
            {% endif %}
            {% endif %}
            <div class="category-panel-listing-categories scrollable-block">
                {% load browse_tags %}
                {{ browse_tree|category_resource_navigation:selected_category|safe }}
            </div>
        </div>
    </div>
    <div class="content-panel">
        <div class="content-panel-body-wrapper">
            <div class="content-panel-body" id="category-{{ selected_category.id }}">
                {% if query %}
                <div class="content-panel-body-search">
                {% include 'partials/search.html' %}
                </div>
                {% else %}
                <div class="content-panel-body-header">
                    <div class="content-panel-body-header-share action-button mini-action-button">Post new</div>
                    <div>
                        <h2>{{ selected_category.title }}</h2>
                        All grade levels
                    </div>
                </div>
                <div class="content-panel-body-listing">
                    <div class="content-panel-body-listing-filters">
                        <div class="content-panel-body-listing-filters-search">
                            <form>
                                <input type="text" placeholder="Filter search..." />
                            </form>
                        </div>
                        <div class="content-panel-body-listing-filters-sort">
                            <span class="sort-by">Sort by: </span><span class="filter-sort-option filter-sort-option-newest">Newest</span> <span class="filter-sort-option selected">Popularity</span>
                            <div class="sort-by-type">All types<span class="sort-by-type-button"></div>
                            <div class="sort-by-type-menu">
                                <div class="sort-by-type-menu-content">
                                    <h4>Content type</h4>
                                    <label><input type="checkbox" name="type" value="lesson" checked />Lesson</label>
                                    <label><input type="checkbox" name="type" value="project" checked />Project</label>
                                    <label><input type="checkbox" name="type" value="worksheet" checked />Worksheet</label>
                                    <label><input type="checkbox" name="type" value="handout" checked />Handout</label>
                                    <label><input type="checkbox" name="type" value="activity" checked />Activity</label>
                                    <label><input type="checkbox" name="type" value="test" checked />Test / assessment</label>
                                    <label><input type="checkbox" name="type" value="lecture" checked />Lecture</label>
                                </div>
                                 <div class="sort-by-type-menu-format">
                                    <h4>Format type</h4>
                                    <label><input type="checkbox" name="type" value="document" checked />Document</label>
                                    <label><input type="checkbox" name="type" value="slideshow" checked />Slideshow</label>
                                    <label><input type="checkbox" name="type" value="website" checked />Website</label>
                                    <label><input type="checkbox" name="type" value="video" checked />Video</label>
                                    <label><input type="checkbox" name="type" value="audio" checked />Audio</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="content-panel-body-listing-items">
                    <script type="text/javascript">
                    {% for item in items %}
                        {% if item.item_type == 'resource' %}
                        var resource = new Resource({
                            id: '{{ item.id }}',
                            url: '{% url read resource_id=item.id resource_slug=item.slug %}',
                            title: '{{ item.title }}',
                            user: '{{ item.revision.user }}',
                            user_thumbnail: '{{ MEDIA_URL }}{{ item.revision.user.get_profile.profile_pic.name }}',
                            user_url: '{% url user:user_profile username=item.revision.user.username %}',
                            favorites: '{{ item.favorites_count }}',
                            views: '{{ item.views }}',
                            type: '{{ item.type|upper }}',
                            thumbnail: '{{ MEDIA_URL }}{{ item.image.name }}',
                            favorited: false,
                            created: '{{ item.created|date:"U" }}',
                            tags: ["{{ item.tags.all|join:'","' }}"]
                        });
                        resourceSet.add(resource);
                        {% else %}
                        var collection = new Resource({
                            id: '{{ item.id }}',
                            url: '{% url user:list_collection username=item.creator collection_slug=item.slug %}',
                            title: '{{ item.title }}',
                            user: '{{ item.creator }}',
                            user_thumbnail: '{{ MEDIA_URL }}{{ item.creator.get_profile.profile_pic.name }}',
                            user_url: '{% url user:user_profile username=item.creator.username %}',
                            favorites: '{{ item.favorites_count }}',
                            views: '{{ item.views }}',
                            type: '{{ item.type|upper }}',
                            thumbnail: '{{ STATIC_URL }}images/folder-icon.png',
                            favorited: false,
                            created: '{{ item.created|date:"U" }}',
                            tags: []
                        });
                        resourceSet.add(collection);                        
                        {% endif %}
                    {% empty %}
                        //<p>No results found.</p>
                    {% endfor %}
                    </script>
                    </div>

                    <div class="filter-search-placeholder">Searching for your happiness...</div>
                    {% if current_category_id %}
                        <div class="lazy-load-button enabled">Load more...</div>
                    {% endif %}

                    {% if requests %}
                    <div class="content-panel-body-listing-requests">
                        <div class="content-panel-body-listing-requests-title">
                            <h3>Top requests</h3>
                            <a href="{% url projects:project_home project_slug=category_group.slug %}?post=new&redirect_to={{ selected_category.url }}" class="action-button mini-action-button content-panel-body-listing-requests-new-request">New request</a>
                        </div>
                        {% for request in requests %}
                        <a href="{% url projects:project_discussion project_slug=request.parent.slug discussion_id=request.id %}" class="content-panel-body-listing-request">
                            <div style="background-image: url('{{ MEDIA_URL }}{{ request.user.get_profile.profile_pic.name }}')" class="content-panel-body-listing-request-thumbnail"></div>
                            <div class="content-panel-body-listing-request-body"><span class="bold content-panel-body-listing-request-body-user">{{ request.user.get_full_name }}</span>{{ request.body_markdown_html|safe }}</div>
                        </a>
                        {% endfor %}
                    </div>
                    {% else %}
                        <a href="{% url projects:project_home project_slug=category_group.slug %}?post=new&redirect_to={{ selected_category.url }}" class="no-request-found">Can't find what you are looking for? Don't worry - just ask for it!</a>
                    {% endif %}

                </div>
                {% endif %}
            </div>
            {% include 'partials/footer.html' %}
        </div>
    </div>
</div>

<div class="browse-post-new-dialog oc-popup">
    <div class="oc-popup-title-bar">
        <div class="oc-popup-title"><h3>Post new lesson or resource...</h3></div>
        <div class="delete-button oc-popup-exit"></div>
    </div>
    <div class="oc-popup-body">
        <p>What would you like to share with the community today?</p>
        <ul class="browse-post-new-options">
            <li class="browse-post-new-option upload-option">
                <div class="browse-post-new-option-thumbnail"></div>
                <div class="browse-post-new-option-description">Upload something</div>
            </li>
            <li class="browse-post-new-option file-folder-option">
                <div class="browse-post-new-option-thumbnail"></div>
                <div class="browse-post-new-option-description">My file or folder</div>
            </li>
            <li class="browse-post-new-option url-option">
                <div class="browse-post-new-option-thumbnail"></div>
                <div class="browse-post-new-option-description">Website link</div>
            </li>
        </ul>
    </div>
</div>

{% include 'partials/upload-dialog.html' %}

<div class="post-new-file-folder-dialog oc-popup">
    <div class="oc-popup-title-bar">
        <div class="oc-popup-title"><h3>Select an existing file or folder</h3></div>
        <div class="delete-button oc-popup-exit"></div>
    </div>
    <div class="oc-popup-body">
        <div class="post-new-file-folder-profile-browser oc-popup-dialog-browser loading-browser"></div>

        <form id="post-new-file-folder-profile-form" method="POST" action="{% url resource:post_existing_resource_collection %}">
            {% csrf_token %}
            <input type="hidden" name="is_resource" value="" />
            <input type="hidden" name="resource_collection_ID" value="" />
            <input type="hidden" name="category_id" value="{{ selected_category.id }}" />
            <div class="post-new-file-folder-submit-wrapper oc-popup-submit-wrapper">
                <div class="resource-type-selector">This is a
                    <select name="type">
                        <option name="lesson" selected>Lesson</option>
                        <option name="project">Project</option>
                        <option name="worksheet">Worksheet</option>
                        <option name="handout">Handout</option>
                        <option name="activity">Activity</option>
                        <option name="assessment">Test / assessment</option>
                        <option name="lecture">Lecture</option>
                    </select>
                </div>
                <button class="action-button post-new-file-folder-submit oc-popup-submit-button">Post</button>
            </div>
        </form>
    </div>
</div>

<div class="post-new-url-dialog oc-popup">
    <div class="oc-popup-title-bar">
        <div class="oc-popup-title"><h3>Share a website URL</h3></div>
        <div class="delete-button oc-popup-exit"></div>
    </div>
    <div class="oc-popup-body">
        <form method="POST" action="{% url resource:post_url %}">
            {% csrf_token %}
            <input type="hidden" name="category_id" value="{{ selected_category.id }}" />
            <table>
                <tr><td>URL</td><td><input type="text" name="url" /></td></tr>
                <tr><td>Title</td><td><input type="text" name="title" /></td></tr>
                <tr><td>Type</td><td>
                    <select name="type">
                        <option name="lesson" selected>Lesson</option>
                        <option name="project">Project</option>
                        <option name="worksheet">Worksheet</option>
                        <option name="handout">Handout</option>
                        <option name="activity">Activity</option>
                        <option name="assessment">Test / assessment</option>
                        <option name="lecture">Lecture</option>
                    </select>
                </td></tr>
            </table>
            <div class="post-new-url-submit-wrapper oc-popup-submit-wrapper">
                <button class="action-button post-new-url-submit oc-popup-submit-button">Post</button>
            </div>
        </form>
    </div>
</div>