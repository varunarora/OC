!function(e,t){if("function"==typeof define&&define.amd)define(["react","backbone","underscore"],t);else if("undefined"!=typeof module&&module.exports){var o=require("react"),n=require("backbone"),i=require("underscore");module.exports=t(o,n,i)}else t(e.React,e.Backbone,e._)}(this,function(e,t,o){function n(e,t){t=t||{};var n=t.model,i=t.collection;"undefined"!=typeof n&&(n.attributes||"object"==typeof n&&o.values(n)[0].attributes)&&(delete t.model,this.model=n,this.setPropsBackbone(n,void 0,t)),"undefined"!=typeof i&&(i.models||"object"==typeof i&&o.values(i)[0].models)&&(delete t.collection,this.collection=i,this.setPropsBackbone(i,void 0,t)),this.component=e,e._owner||"undefined"==typeof document||(this.startModelListeners(),this.startCollectionListeners())}!t.React&&(t.React={}),!t.React.Component&&(t.React.Component={});t.React.Component.mixin={componentDidMount:function(){this.setElement(this.getDOMNode())},componentDidUpdate:function(){this.setElement(this.getDOMNode())},componentWillMount:function(){this.wrapper||(this.wrapper=new n(this,this.props))},componentWillUnmount:function(){this.wrapper&&(this.wrapper.stopListening(),delete this.wrapper)},componentWillReceiveProps:function(e){var t=e.model;if(this.wrapper.model&&t)if(delete e.model,this.wrapper.model.attributes)this.wrapper.setProps(t,void 0,e);else for(var o in t)this.wrapper.setProps(t[o],o,e)},$:function(){return this.$el&&this.$el.find.apply(this.$el,arguments)},getCollection:function(){for(var e=this,t=e.wrapper;!t.collection;){if(e=e._owner,!e)throw new Error("Collection not found");t=e.wrapper}return t.collection},getModel:function(){for(var e=this,t=e.wrapper;!t.model;){if(e=e._owner,!e)throw new Error("Model not found");t=e.wrapper}return t.model},getOwner:function(){for(var e=this;e._owner;)e=e._owner;return e},setElement:function(e){if(e&&t.$&&e instanceof t.$){if(e.length>1)throw new Error("You can only assign one element to a component");this.el=e[0],this.$el=e}else e&&(this.el=e,t.$&&(this.$el=t.$(e)));return this}};return o.extend(n.prototype,t.Events,{onError:function(e,t,o){o.silent||this.setProps({isRequesting:!1,hasError:!0,error:t})},onRequest:function(e,t,o){o.silent||this.setProps({isRequesting:!0,hasError:!1})},onSync:function(e,t,o){o.silent||this.setProps({isRequesting:!1})},setPropsBackbone:function(e,t,o){if(e.models||e.attributes)this.setProps.apply(this,arguments);else for(t in e)this.setPropsBackbone(e[t],t,o)},setProps:function(e,n,i){var s={},r=e.toJSON?e.toJSON():e;n?s[n]=r:e instanceof t.Collection?s.collection=r:s=r,i?o.extend(i,s):(this.nextProps=o.extend(this.nextProps||{},s),o.defer(o.bind(function(){this.nextProps&&(this.component&&this.component.setProps(this.nextProps),delete this.nextProps)},this)))},startCollectionListeners:function(e,t){if(e||(e=this.collection),e)if(e.models)this.listenTo(e,"add remove change sort reset",o.partial(this.setPropsBackbone,e,t,void 0)).listenTo(e,"error",this.onError).listenTo(e,"request",this.onRequest).listenTo(e,"sync",this.onSync);else if("object"==typeof e)for(t in e)e.hasOwnProperty(t)&&this.startCollectionListeners(e[t],t)},startModelListeners:function(e,t){if(e||(e=this.model),e)if(e.attributes)this.listenTo(e,"change",o.partial(this.setPropsBackbone,e,t,void 0)).listenTo(e,"error",this.onError).listenTo(e,"request",this.onRequest).listenTo(e,"sync",this.onSync);else if("object"==typeof e)for(t in e)this.startModelListeners(e[t],t)}}),t.React.Component.mixin});