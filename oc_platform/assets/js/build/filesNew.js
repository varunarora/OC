define("filesNew",["react","core_light","immutable"],function(e,t,s){var i=s.List,l={files:e.createClass({getInitialState:function(){return{selectedFiles:[],files:i(),folders:t.config.hasOwnProperty("organization")&&t.files.isHome?i([s.Map({title:"My Google Drive",modified:(new Date).toISOString(),url:t.files.driveURL,drive:!0})]):i(),showCreateMenu:!1,mode:t.files.drive===!0?"view":t.config.user.id===t.config.profile.id?"edit":"view"}},load:function(){var e=this;require(["atomic"],function(i){i.get("/resources/api/folder/"+t.config.profile.id+"/"+t.files.folderID+"/from/0/tfi/").success(function(i){i.folders.forEach(function(e){e.selected=!1}),i.files.forEach(function(e){e.selected=!1}),t.files.itemsCount+=i.files.length,e.setState({files:e.state.files.concat(s.fromJS(i.files)),folders:e.state.folders.concat(s.fromJS(i.folders))}),l.spinner.stop()})})},gLoad:function(){var e=this,t=function(e){var t,l,o,n=[],r=[];for(t=0;t<e.items.length;t++)l=e.items[t],o=s.Map({title:l.title,modified:l.modifiedDate,visibility:"private",url:l.alternateLink}),"application/vnd.google-apps.folder"===l.mimeType?r.push(o):n.push(o.set("file",!0));return[i(n),i(r)]},o=function(){var s=gapi.client.drive.files.list();s.execute(function(s){var i=t(s);e.setState({files:i[0],folders:i[1]}),l.spinner.stop()})};require(["gapi"]),window.gReady=function(){gapi.auth.authorize({client_id:"747453362533.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/drive.readonly",immediate:!0},function(){gapi.client.load("drive","v2",function(){o()})})}},componentDidMount:function(){function e(e){require(["spin"],function(s){l.hasOwnProperty("spinner")?l.spinner.spin(i):l.spinner=new s(t.spinner.options).spin(i),e()})}function s(){o.refs.tableWrapper.getDOMNode().style.height=parseInt(window.innerHeight,10)-parseInt(t.$.css(document.querySelector(".content-panel header"),"height"),10)-parseInt(t.$.css(document.querySelector(".content-panel-body-title-bar-wrapper"),"height"),10)+"px",o.refs.titleBarWrapper.getDOMNode().style.width=t.$.css(document.querySelector(".content-panel header"),"width")}var i=document.querySelector(".ajax-loader"),o=(document.querySelector(".ajax-loader-wrapper"),this);e(function(){(t.files.drive===!0?o.gLoad:o.load)()}),s(),window.addEventListener("resize",s),t.config.user.id===t.config.profile.id&&t.utils.menu(this.getDOMNode().querySelector("nav.files-create-menu"),this.refs.create.getDOMNode())},renderFile:function(e){return e=e.toJS(),e.onFileSelected=this.onFileSelected,l.file(e)},renderFolder:function(e){return e=e.toJS(),e.onFileSelected=this.onFileSelected,l.file(e)},onFileSelected:function(e){itemType=e.file?"files":"folders";var t,s=this.state[itemType];for(t=0;t<s.size&&s.get(t).get("id")!==e.id;t++);var i=s.get(t).set("selected",!s.get(t).get("selected")),l=this.state.selectedFiles;if(i.get("selected")===!1){var o=l.indexOf(s.get(t));l.splice(o,1)}else l.push(s.get(t));var n=this;newState=this.state,newState[itemType]=s.set(t,i),newState.selectedFiles=l,n.replaceState(newState,function(){n.selectedFilesChanged()})},selectedFilesChanged:function(){this.state.selectedFiles.length>=1&&(1===this.state.selectedFiles.length?this.enableButtons(["share-button","rename-button"]):this.disableButtons(["share-button","rename-button"]),this.enableButtons(["move-button","copy-button","delete-button"]))},enableButtons:function(e){var s,i;for(s=0;s<e.length;s++)i=this.refs[e[s]].getDOMNode(),t.$.removeClass(i,"disabled"),i.disabled=!1},disableButtons:function(e){var s,i;for(s=0;s<e.length;s++)i=this.refs[e[s]].getDOMNode(),t.$.addClass(i,"disabled"),i.disabled=!0},move:function(e){var s=this,i=t.utils.popup(".move-file-folder-dialog"),l=document.querySelector(".move-file-folder-browser");return l.innerHTML="",t.$.addClass(l,"loading-browser"),t.$.addListener(i.dialog.querySelector(".move-file-folder-submit-button"),"click",function(){var e=l.querySelector(".selected-destination-collection");if(i.close(),e){var t,o,n=e.id.substring(11),r=[],a=[],c=s.state.selectedFiles;for(t=0;t<c.length;t++)o=c[t],o.get("file")===!1?(s.moveFolderIntoFolder(o,n),a.push(o)):(s.moveFileIntoFolder(o,n),r.push(o));s.movedIntoFolder(r,a)}}),require(["atomic"],function(e){e.get("/resources/tree/collections/user/").success(function(e){"true"==e.status&&(t.utils.browser(e.tree,l,t.files.folderID),t.$.removeClass(l,"loading-browser"))})}),e.stopPropagation(),e.preventDefault(),!1},moveFolderIntoFolder:function(e,s){var i=t.files.folderID,l=this;require(["atomic"],function(t){t.get("/resources/move/collection/"+e.get("id")+"/from/"+i+"/to/"+s+"/").success(function(t){"true"==t.status&&l.fileFolderMoved(e)})})},moveFileIntoFolder:function(e,s){var i=t.files.folderID,l=this;require(["atomic"],function(t){t.get("/resources/move/resource/"+e.get("id")+"/from/"+i+"/to/"+s+"/").success(function(t){"true"==t.status&&l.fileFolderMoved(e)})})},fileFolderMoved:function(e){var t,s=e.get("file")?"files":"folders";this.state[s].find(function(s,i){return t=i,s.get("id")===e.get("id")}),newState={},newState[s]=this.state[s].remove(t),this.state.selectedFiles.splice(this.state.selectedFiles.indexOf(e),1),newState.selectedFiles=this.state.selectedFiles,this.setState(newState)},movedIntoFolder:function(e,s){var i=e||[],l=s||[];i.length>=1&&l.length>=1?t.utils.messageBox.set("Moved files and folders successfully"):i.length>=1?t.utils.messageBox.set("Moved file(s) into the folder successfully"):l.length>=1&&t.utils.messageBox.set("Moved folder(s) successfully"),t.utils.messageBox.show()},copy:function(e){this.copying();var s,i,o=[],n=[],r=this.state.selectedFiles;for(s=0;s<r.length;s++)i=r[s],i.get("file")===!1?(l.api.folder.copy(i,t.files.folderID,this.folderCopied),n.push(i)):(l.api.file.copy(t.file.folderID,i,t.files.folderID,this.fileCopied),o.push(i));return l.pendingActions.copyFiles.concat(o),l.pendingActions.copyFolders.concat(n),l.actionCompletionCallback=this.copied,e.stopPropagation(),e.preventDefault(),!1},copying:function(){t.utils.messageBox.set("Copying..."),t.utils.messageBox.show()},copied:function(){var e=l.actionsCompleted.copyFiles,s=l.actionsCompleted.copyFolders;e.length>=1&&s.length>=1?t.utils.messageBox.set("Copied files and folders successfully"):e.length>=1?t.utils.messageBox.set("Copied file(s) successfully"):s.length>=1&&t.utils.messageBox.set("Copied folder(s) successfully"),t.utils.messageBox.show()},fileCopied:function(e,t){e.selected=!1;var i=this.state.selectedFiles;i.splice(i.indexOf(t),1),this.setState({files:this.state.files.push(s.fromJS(e)),selectedFiles:i}),l.pendingActions.copyFiles.splice(t),l.actionsCompleted.copyFiles.push(t),l.actionCompleted()},folderCopied:function(e,t){e.selected=!1;var i=this.state.selectedFiles;i.splice(i.indexOf(file),1),this.setState({folders:this.state.folders.push(s.fromJS(e)),selectedFiles:i}),l.pendingActions.copyFolders.splice(t),l.actionsCompleted.copyFolders.push(t),l.actionCompleted()},rename:function(e){this.renaming();var s=this.state.selectedFiles[0],i=this,o=t.utils.popup(".rename-file-folder-dialog"),n=o.dialog.querySelector('input[name="new_name"]'),r=s.get("title");return n.value=r,function a(){t.$.addListener(o.dialog.querySelector(".rename-file-folder-submit-button"),"click",function(e){o.close();var t=n.value;if(t!==r){var c=[],d=[];s.get("file")===!1?(l.api.folder.rename(s,t,i.folderRenamed),d.push(s)):(l.api.file.rename(s,t,i.fileRenamed),c.push(s)),l.pendingActions.renameFiles.concat(c),l.pendingActions.renameFolders.concat(d),l.actionCompletionCallback=i.renamed}return n.value="",this.removeEventListener("click",a),e.stopPropagation(),e.preventDefault(),!1})}(),e.stopPropagation(),e.preventDefault(),!1},renaming:function(){t.utils.messageBox.set("Renaming..."),t.utils.messageBox.show()},renamed:function(){var e=l.actionsCompleted.renameFiles,s=l.actionsCompleted.renameFolders;1===e.length?t.utils.messageBox.set("Renamed file successfully"):1===s.length&&t.utils.messageBox.set("Renamed folder successfully"),t.utils.messageBox.show()},fileRenamed:function(e,t){var s;this.state.files.find(function(t,i){return s=i,t.get("id")===e.get("id")});var i=e.withMutations(function(e){e.set("title",t).set("selected",!1)}),o=this.state.selectedFiles;o.splice(o.indexOf(e),1),this.setState({files:this.state.files.set(s,i),selectedFiles:o}),l.pendingActions.renameFiles.splice(e),l.actionsCompleted.renameFiles.push(e),l.actionCompleted()},folderRenamed:function(e,t){var s;this.state.folders.find(function(t,i){return s=i,t.get("id")===e.get("id")});var i=e.withMutations(function(e){e.set("title",t).set("selected",!1)}),o=this.state.selectedFiles;o.splice(o.indexOf(e),1),this.setState({folders:this.state.folders.set(s,i),selectedFiles:o}),l.pendingActions.renameFolders.splice(e),l.actionsCompleted.renameFolders.push(e),l.actionCompleted()},"delete":function(e){var s,i,o=[],n=[],r=this.state.selectedFiles;for(s=0;s<r.length;s++)i=r[s],i.get("file")===!1?n.push(i):o.push(i);var a=this.getSelectedFilesFolders(),c=o.map(function(e){return e.get("id")}),d=n.map(function(e){return e.get("id")});return a[0].length>1&&a[1].length>1?(this.setDeleteMessage("Are you sure you want to delete these files and folders? This will also delete all the files and folders within these folders.","Delete files and folders"),l.api.file.deleteMultiple(c,t.files.folderID,this.filesDeleted),l.api.folder.deleteMultiple(d,this.foldersDeleted)):a[0].length>1&&1===a[1].length?(this.setDeleteMessage("Are you sure you want to delete these files and the selected folder? This will also delete all the files and folders within the folder.","Delete files and folder"),l.api.file.deleteMultiple(c,t.files.folderID,this.filesDeleted),l.api.folder.delete(d[0],this.foldersDeleted)):1===a[0].length&&a[1].length>1?(this.setDeleteMessage("Are you sure you want to delete these folders and the selected file? This will also delete all the files and folders within these folders.","Delete folders and file"),l.api.file.delete(c[0],t.files.folderID,this.filesDeleted),l.api.folder.deleteMultiple(d,this.foldersDeleted)):1===a[0].length&&1===a[1].length?(this.setDeleteMessage("Are you sure you want to delete this folder and this file? This will also delete all the files and folders within the folder.","Delete folder and file"),l.api.file.delete(c[0],t.files.folderID,this.filesDeleted),l.api.folder.delete(d[0],this.foldersDeleted)):a[0].length>1?(this.setDeleteMessage("Are you sure you want to delete these files?","Delete files"),l.api.file.deleteMultiple(c,t.files.folderID,this.filesDeleted)):a[1].length>1?(this.setDeleteMessage("Are you sure you want to delete these folders? This will also delete all the files and folders within these folders.","Delete folders"),l.api.folder.deleteMultiple(d,this.foldersDeleted)):1===a[0].length?(this.setDeleteMessage("Are you sure you want to delete this file?","Delete file"),l.api.file.delete(c[0],t.files.folderID,this.filesDeleted)):1===a[1].length&&(this.setDeleteMessage("Are you sure you want to delete this folder? This will also delete all the files and folders within the folder.","Delete folder"),l.api.folder.delete(d[0],this.foldersDeleted)),l.pendingActions.deleteFiles.concat(c),l.pendingActions.deleteFolders.concat(d),l.actionCompletionCallback=this.deleted,e.stopPropagation(),e.preventDefault(),!1},setDeleteMessage:function(e,t){document.querySelector(".delete-file-folder-dialog-message").innerHTML=e,document.querySelector(".delete-file-folder-dialog-title").innerHTML=t},foldersDeleted:function(e){var t;for(t=0;t<e.length;t++)l.pendingActions.deleteFolders.splice(e[t]),l.actionsCompleted.deleteFolders.push(e[t]);var s=this.state.selectedFiles,i=this.state.folders.filter(function(t){return-1===e.indexOf(t.get("id"))?!0:(s.splice(s.indexOf(t),1),!1)});this.setState({folders:i,selectedFiles:s}),l.actionCompleted()},filesDeleted:function(e){var t;for(t=0;t<e.length;t++)l.pendingActions.deleteFiles.splice(e[t]),l.actionsCompleted.deleteFiles.push(e[t]);var s=this.state.selectedFiles,i=this.state.files.filter(function(t){return-1===e.indexOf(t.get("id"))?!0:(s.splice(s.indexOf(t),1),!1)});this.setState({files:i,selectedFiles:s}),l.actionCompleted()},deleted:function(){var e=l.actionsCompleted.deleteFiles,s=l.actionsCompleted.deleteFolders;e.length>=1&&s.length>=1?t.utils.messageBox.set("Deleted files and folders successfully"):e.length>=1?t.utils.messageBox.set("Deleted file(s) successfully"):s.length>=1&&t.utils.messageBox.set("Deleted folder(s) successfully"),t.utils.messageBox.show()},getSelectedFilesFolders:function(){var e,t,s=[],i=[],l=this.state.selectedFiles;for(e=0;e<l.length;e++)t=l[e],t.get("file")===!1?i.push(t):s.push(t);return[s,i]},toggleCreateMenu:function(){this.setState({showCreateMenu:!this.state.showCreateMenu},function(){if(this.state.showCreateMenu){var e=this,t=document.querySelector("body");t.addEventListener("click",function s(i){return e.getDOMNode()===i.target||e.getDOMNode().contains(i.target)?void 0:(e.setState({showCreateMenu:!1}),t.removeEventListener("click",s),i.preventDefault(),i.stopPropagation(),!1)})}})},render:function(){return t.files.drive===!0||t.files.isHome===!0&&t.config.hasOwnProperty("organization")||t.files.itemsCount>0?e.DOM.div({className:"files-wrapper"},[e.DOM.div({className:"content-panel-body-title-bar-wrapper",ref:"titleBarWrapper"},e.DOM.div({className:"content-panel-body-title-wrapper"},[0===this.state.selectedFiles.length?e.DOM.h1({className:"content-panel-body-title"},"Files"):e.DOM.div({className:"files-button-wrapper"},[e.DOM.button({className:"oc-button oc-dull-button rename-button",ref:"rename-button",onClick:this.rename},"Rename"),e.DOM.button({className:"oc-button oc-dull-button move-button",ref:"move-button",onClick:this.move},"Move to"),e.DOM.button({className:"oc-button oc-dull-button delete-file-button",ref:"delete-button",onClick:this.delete},"Delete"),e.DOM.button({className:"oc-button oc-dull-button share-button",ref:"share-button"},"Share"),e.DOM.button({className:"oc-button oc-dull-button copy-button",ref:"copy-button",onClick:this.copy},"Make a copy")]),t.config.user.id===t.config.profile.id?e.DOM.button({className:"content-panel-body-create content-panel-body-create-files oc-button oc-page-action-button"+(this.state.showCreateMenu?" active":""),onClick:this.toggleCreateMenu,ref:"create"},[e.DOM.span({className:"content-panel-body-create-title"},"+ Create new"),e.DOM.span({className:"content-panel-body-create-dropdown"})]):null,t.config.user.id===t.config.profile.id?l.createMenu({open:this.state.showCreateMenu}):null])),e.DOM.div({className:"tabular-list-wrapper",ref:"tableWrapper"},e.DOM.table({className:"tabular-list files-list"},e.DOM.colgroup({},[e.DOM.col({className:"name-column"}),e.DOM.col({className:"modified-column"}),e.DOM.col({className:"actions-column"})]),e.DOM.tr({},[e.DOM.th({},"Name"),e.DOM.th({},"Last changed"),e.DOM.th({},"Sharing")]),this.state.folders.map(this.renderFolder).toJS().concat(this.state.files.map(this.renderFile).toJS())),e.DOM.div({className:"ajax-loader-wrapper files-loader-wrapper"},e.DOM.div({className:"ajax-loader"})))]):e.DOM.div({className:"empty-state-title empty-state-title-independent"},"No files.")}}),createMenu:e.createClass({render:function(){return e.DOM.nav({className:"oc-menu files-create-menu"+(this.props.open?" show-menu":"")},[e.DOM.div({className:"floating-menu-spacer"},null),e.DOM.ul({},e.DOM.li({},e.DOM.a({href:"/",className:"files-create-document"},"Document")),e.DOM.li({},e.DOM.a({href:"/",className:"files-create-upload"},"Upload")),e.DOM.li({},e.DOM.a({href:"/",className:"files-create-link"},"Website link")),e.DOM.li({},e.DOM.a({href:"/",className:"files-create-folder"},"Folder")))])}}),file:e.createClass({getInitialState:function(){return{selected:this.props.selected}},componentDidMount:function(){t.utils.timeago(this.getDOMNode().querySelector(".file-modified"))},componentWillReceiveProps:function(e){this.setState({selected:e.selected})},cholay:function(){var e=this.getDOMNode().querySelector(".file-selector");e.checked=e.checked?!1:!0,this.setState({selected:!this.props.selected}),this.props.onFileSelected(this.props)},inputClick:function(e){this.setState({selected:!this.props.selected}),this.props.onFileSelected(this.props),e.stopPropagation()},changeVisibility:function(e){return alert("visibility"),e.stopPropagation(),e.preventDefault(),!1},preventPropogation:function(e){e.stopPropagation()},getItemVisibility:function(){if(this.props.user_id!==t.config.user.id){if("public"===this.props.visibility)return"Public";if("private"===this.props.visibility)return"Shared with me"}else{if("public"===this.props.visibility)return"Public";if("private"===this.props.visibility)return 1===this.props.collaborator_count?"Only me":"Shared"}},render:function(){return e.DOM.tr({onClick:this.cholay,className:this.state.selected?"selected":""},[e.DOM.td({},e.DOM.input({type:"checkbox",className:"file-selector",onClick:this.inputClick,checked:this.state.selected?!0:!1}),e.DOM.a({className:"file-thumbnail"+(this.props.file?"":" folder-thumbnail")+(this.props.hasOwnProperty("drive")?" drive-thumbnail":"")}),e.DOM.a({className:"list-item-title",href:this.props.url,onClick:this.preventPropogation},this.props.title)),e.DOM.td({},e.DOM.span({title:this.props.modified,className:"file-modified"})),e.DOM.td({},e.DOM.span({className:"sharing-status",onClick:this.changeVisibility},this.getItemVisibility()))])}}),pendingActions:{copyFiles:[],copyFolders:[],deleteFiles:[],deleteFolders:[],renameFiles:[],renameFolders:[]},actionsCompleted:{copyFiles:[],copyFolders:[],deleteFiles:[],deleteFolders:[],renameFiles:[],renameFolders:[]},actionCompletionCallback:"",actionCompleted:function(){var e,t=!0;for(e in l.pendingActions)if(l.pendingActions[e].length>=1){t=!1;break}t&&l.actionCompletionCallback()},deleting:function(){t.utils.messageBox.set("Deleting..."),t.utils.messageBox.show()},api:{file:{copy:function(e,s,i,l){require(["atomic"],function(o){o.post("/resources/resource/"+s.get("id")+"/copy/from/"+e+"/to/"+i+"/").success(function(e){"true"==e.status?l(e.resource,s):t.utils.messageBox.dismiss()})})},"delete":function(e,s,i){var o=t.utils.popup(".delete-file-folder-dialog");!function n(){t.$.addListener(o.dialog.querySelector(".delete-file-folder-submit-button"),"click",function(r){return o.close(),l.deleting(),require(["atomic"],function(l){l.post("/resources/delete-resource/"+e+"/from/"+s+"/").success(function(e){"true"==e.status?i([e.resourceID]):(t.popup(e.message,e.title),t.utils.messageBox.dismiss())})}),this.removeEventListener("click",n),r.stopPropagation(),r.preventDefault(),!1})}()},deleteMultiple:function(e,s,i){var o=t.utils.popup(".delete-file-folder-dialog");!function n(){t.$.addListener(o.dialog.querySelector(".delete-file-folder-submit-button"),"click",function(r){o.close();var a=e.join();return l.deleting(),require(["atomic"],function(e){e.post("/resources/delete-resources/from/"+s+("/?ids="+a)).success(function(e){"true"==e.status?i(e.resourceIDs):(t.popup(e.message,e.title),t.utils.messageBox.dismiss())})}),this.removeEventListener("click",n),r.stopPropagation(),r.preventDefault(),!1})}()},rename:function(e,s,i){require(["atomic"],function(l){l.post("/resources/rename/resource/"+e.get("id")+"/"+encodeURIComponent(s)+"/").success(function(s){"true"==s.status?i(e,s.title):(t.popup(s.message,s.title),t.dismissMessageBox())})})}},folder:{copy:function(e,s,i){require(["atomic"],function(l){l.post("/resources/collection/"+e.get("id")+"/copy/to/"+s+"/").success(function(s){"true"==s.status?i(s.collection,e):t.utils.messageBox.dismiss()})})},"delete":function(e,s){var i=t.utils.popup(".delete-file-folder-dialog");!function o(){t.$.addListener(i.dialog.querySelector(".delete-file-folder-submit-button"),"click",function(n){return i.close(),l.deleting(),require(["atomic"],function(i){i.post("/resources/delete-collection/"+e+"/").success(function(e){"true"==e.status?s([e.collectionID]):(t.popup(e.message,e.title),t.utils.messageBox.dismiss())})}),this.removeEventListener("click",o),n.stopPropagation(),n.preventDefault(),!1})}()},deleteMultiple:function(e,s){var i=t.utils.popup(".delete-file-folder-dialog");!function o(){t.$.addListener(i.dialog.querySelector(".delete-file-folder-submit-button"),"click",function(n){i.close();var r=e.join();return l.deleting(),require(["atomic"],function(e){e.post("/resources/delete-collections/?ids="+r).success(function(e){"true"==e.status?s(e.collectionIDs):(t.popup(e.message,e.title),t.utils.messageBox.dismiss())})}),this.removeEventListener("click",o),n.stopPropagation(),n.preventDefault(),!1})}()},rename:function(e,s,i){require(["atomic"],function(l){l.post("/resources/rename/collection/"+e.get("id")+"/"+encodeURIComponent(s)+"/").success(function(s){"true"==s.status?i(e,s.title):(t.popup(s.message,s.title),t.dismissMessageBox())})})}}}};e.renderComponent(l.files(),document.querySelector(".content-panel-body-wrapper"))});