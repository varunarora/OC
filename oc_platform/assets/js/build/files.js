!function(e){"function"==typeof define&&define.amd?define("timeago",["jquery"],e):e(jQuery)}(function(e){function o(){var o=t(this),c=l.settings;return isNaN(o.datetime)||(0==c.cutoff||Math.abs(i(o.datetime))<c.cutoff)&&e(this).text(s(o.datetime)),this}function t(o){if(o=e(o),!o.data("timeago")){o.data("timeago",{datetime:l.datetime(o)});var t=e.trim(o.text());l.settings.localeTitle?o.attr("title",o.data("timeago").datetime.toLocaleString()):!(t.length>0)||l.isTime(o)&&o.attr("title")||o.attr("title",t)}return o.data("timeago")}function s(e){return l.inWords(i(e))}function i(e){return(new Date).getTime()-e.getTime()}e.timeago=function(o){return s(o instanceof Date?o:"string"==typeof o?e.timeago.parse(o):"number"==typeof o?new Date(o):e.timeago.datetime(o))};var l=e.timeago;e.extend(e.timeago,{settings:{refreshMillis:6e4,allowPast:!0,allowFuture:!1,localeTitle:!1,cutoff:0,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",inPast:"any moment now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(o){function t(t,i){var l=e.isFunction(t)?t(i,o):t,c=s.numbers&&s.numbers[i]||i;return l.replace(/%d/i,c)}if(!this.settings.allowPast&&!this.settings.allowFuture)throw"timeago allowPast and allowFuture settings can not both be set to false.";var s=this.settings.strings,i=s.prefixAgo,l=s.suffixAgo;if(this.settings.allowFuture&&0>o&&(i=s.prefixFromNow,l=s.suffixFromNow),!this.settings.allowPast&&o>=0)return this.settings.strings.inPast;var c=Math.abs(o)/1e3,r=c/60,n=r/60,a=n/24,u=a/365,d=45>c&&t(s.seconds,Math.round(c))||90>c&&t(s.minute,1)||45>r&&t(s.minutes,Math.round(r))||90>r&&t(s.hour,1)||24>n&&t(s.hours,Math.round(n))||42>n&&t(s.day,1)||30>a&&t(s.days,Math.round(a))||45>a&&t(s.month,1)||365>a&&t(s.months,Math.round(a/30))||1.5>u&&t(s.year,1)||t(s.years,Math.round(u)),C=s.wordSeparator||"";return void 0===s.wordSeparator&&(C=" "),e.trim([i,d,l].join(C))},parse:function(o){var t=e.trim(o);return t=t.replace(/\.\d+/,""),t=t.replace(/-/,"/").replace(/-/,"/"),t=t.replace(/T/," ").replace(/Z/," UTC"),t=t.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),t=t.replace(/([\+\-]\d\d)$/," $100"),new Date(t)},datetime:function(o){var t=e(o).attr(l.isTime(o)?"datetime":"title");return l.parse(t)},isTime:function(o){return"time"===e(o).get(0).tagName.toLowerCase()}});var c={init:function(){var t=e.proxy(o,this);t();var s=l.settings;s.refreshMillis>0&&(this._timeagoInterval=setInterval(t,s.refreshMillis))},update:function(t){var s=l.parse(t);e(this).data("timeago",{datetime:s}),l.settings.localeTitle&&e(this).attr("title",s.toLocaleString()),o.apply(this)},updateFromDOM:function(){e(this).data("timeago",{datetime:l.parse(e(this).attr(l.isTime(this)?"datetime":"title"))}),o.apply(this)},dispose:function(){this._timeagoInterval&&(window.clearInterval(this._timeagoInterval),this._timeagoInterval=null)}};e.fn.timeago=function(e,o){var t=e?c[e]:c.init;if(!t)throw new Error("Unknown function name '"+e+"' for timeago");return this.each(function(){t.call(this,o)}),this},document.createElement("abbr"),document.createElement("time")}),function(e){"function"==typeof define&&define.amd?define("droppable",["jquery","ui_core","widget","mouse","draggable"],e):e(jQuery)}(function(e){return e.widget("ui.droppable",{version:"@VERSION",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var o,t=this.options,s=t.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(s)?s:function(e){return e.is(s)},this.proportions=function(){return arguments.length?void(o=arguments[0]):o?o:o={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(t.scope),t.addClasses&&this.element.addClass("ui-droppable")},_addToManager:function(o){e.ui.ddmanager.droppables[o]=e.ui.ddmanager.droppables[o]||[],e.ui.ddmanager.droppables[o].push(this)},_splice:function(e){for(var o=0;o<e.length;o++)e[o]===this&&e.splice(o,1)},_destroy:function(){var o=e.ui.ddmanager.droppables[this.options.scope];this._splice(o),this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(o,t){if("accept"===o)this.accept=e.isFunction(t)?t:function(e){return e.is(t)};else if("scope"===o){var s=e.ui.ddmanager.droppables[this.options.scope];this._splice(s),this._addToManager(t)}this._super(o,t)},_activate:function(o){var t=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),t&&this._trigger("activate",o,this.ui(t))},_deactivate:function(o){var t=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),t&&this._trigger("deactivate",o,this.ui(t))},_over:function(o){var t=e.ui.ddmanager.current;t&&(t.currentItem||t.element)[0]!==this.element[0]&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",o,this.ui(t)))},_out:function(o){var t=e.ui.ddmanager.current;t&&(t.currentItem||t.element)[0]!==this.element[0]&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",o,this.ui(t)))},_drop:function(o,t){var s=t||e.ui.ddmanager.current,i=!1;return s&&(s.currentItem||s.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var t=e(this).droppable("instance");return t.options.greedy&&!t.options.disabled&&t.options.scope===s.options.scope&&t.accept.call(t.element[0],s.currentItem||s.element)&&e.ui.intersect(s,e.extend(t,{offset:t.element.offset()}),t.options.tolerance,o)?(i=!0,!1):void 0}),i?!1:this.accept.call(this.element[0],s.currentItem||s.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",o,this.ui(s)),this.element):!1):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(){function e(e,o,t){return e>=o&&o+t>e}return function(o,t,s,i){if(!t.offset)return!1;var l=(o.positionAbs||o.position.absolute).left+o.margins.left,c=(o.positionAbs||o.position.absolute).top+o.margins.top,r=l+o.helperProportions.width,n=c+o.helperProportions.height,a=t.offset.left,u=t.offset.top,d=a+t.proportions().width,C=u+t.proportions().height;switch(s){case"fit":return l>=a&&d>=r&&c>=u&&C>=n;case"intersect":return a<l+o.helperProportions.width/2&&r-o.helperProportions.width/2<d&&u<c+o.helperProportions.height/2&&n-o.helperProportions.height/2<C;case"pointer":return e(i.pageY,u,t.proportions().height)&&e(i.pageX,a,t.proportions().width);case"touch":return(c>=u&&C>=c||n>=u&&C>=n||u>c&&n>C)&&(l>=a&&d>=l||r>=a&&d>=r||a>l&&r>d);default:return!1}}}(),e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(o,t){var s,i,l=e.ui.ddmanager.droppables[o.options.scope]||[],c=t?t.type:null,r=(o.currentItem||o.element).find(":data(ui-droppable)").addBack();e:for(s=0;s<l.length;s++)if(!(l[s].options.disabled||o&&!l[s].accept.call(l[s].element[0],o.currentItem||o.element))){for(i=0;i<r.length;i++)if(r[i]===l[s].element[0]){l[s].proportions().height=0;continue e}l[s].visible="none"!==l[s].element.css("display"),l[s].visible&&("mousedown"===c&&l[s]._activate.call(l[s],t),l[s].offset=l[s].element.offset(),l[s].proportions({width:l[s].element[0].offsetWidth,height:l[s].element[0].offsetHeight}))}},drop:function(o,t){var s=!1;return e.each((e.ui.ddmanager.droppables[o.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(o,this,this.options.tolerance,t)&&(s=this._drop.call(this,t)||s),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],o.currentItem||o.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,t)))}),s},dragStart:function(o,t){o.element.parentsUntil("body").bind("scroll.droppable",function(){o.options.refreshPositions||e.ui.ddmanager.prepareOffsets(o,t)})},drag:function(o,t){o.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(o,t),e.each(e.ui.ddmanager.droppables[o.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var s,i,l,c=e.ui.intersect(o,this,this.options.tolerance,t),r=!c&&this.isover?"isout":c&&!this.isover?"isover":null;r&&(this.options.greedy&&(i=this.options.scope,l=this.element.parents(":data(ui-droppable)").filter(function(){return e(this).droppable("instance").options.scope===i}),l.length&&(s=e(l[0]).droppable("instance"),s.greedyChild="isover"===r)),s&&"isover"===r&&(s.isover=!1,s.isout=!0,s._out.call(s,t)),this[r]=!0,this["isout"===r?"isover":"isout"]=!1,this["isover"===r?"_over":"_out"].call(this,t),s&&"isout"===r&&(s.isout=!1,s.isover=!0,s._over.call(s,t)))}})},dragStop:function(o,t){o.element.parentsUntil("body").unbind("scroll.droppable"),o.options.refreshPositions||e.ui.ddmanager.prepareOffsets(o,t)}},e.ui.droppable}),define("resourcesCollections",["jquery","underscore","core","timeago","draggable","droppable"],function(e,o){o.extend(OC.resourcesCollections,{resourceItemTemplate:o.template('<div class="<%= host %>-browse-item resource-collection-item resource <%= type %>-resource" id="resource-<%= id %>"><input type="checkbox" name="resource_id" value="<%= id %>"/><a href="<%= url %>"><%= title %> <span class="<%= host %>-browse-item-date"><%= created %></span><div class="resource-collection-actions <%= resource_type %> <%= is_collaborator %> is-owner"><span class="<%= host %>-browse-item-visibility browse-item-visibility visibility-<%= visibility %>" title=" Who has access: <%= access %>"></span><div class="<%= host %>-resource-delete resource-collection-delete" id="resource-<%= id %>" title="Delete"></div></div></a></div>'),resourceCollectionItemTemplate:o.template('<div class="resource-collection-item <%= category %>" id="<%= category %>-<%= id %>"><% if (owner){ %> <div class="resource-item-selector"><input type="checkbox" name="resource_collection_id" value="<%= id %>"/></div><% } %><a href="<%= url %>"<% if (open_url){ %> target="_blank"<% } %> class="resource-item-thumbnail" style="background-image: url(\'<%= thumbnail %>\');"><div class="resource-item-thumbnail-selector"></div><div class="resource-item-thumbnail-<%= type %>"></div></a><div class="resource-item-description"><div class="resource-item-description-title"><a href="<%= url %>"<% if (open_url){ %> target="_blank"<% } %>><%= title %></a></div><div class="resource-item-description-modified" title="<%= modified %>"><%= modified %></div><div class="resource-item-description-actions"><div class="resource-item-description-actions-visibility"><span class=" <%= host %>-browse-item-visibility browse-item-visibility visibility-<%= visibility %> <%= visibility_classes %>"><span class="visibility-icon"></span><%= visibility_title %></span></div></div></div></div>'),collectionItemTemplate:o.template('<div class="<%= host %>-browse-item resource-collection-item directory " id="collection-<%= id %>"><input type="checkbox" name="collection_id" value="<%= id %>"/><a href="<%= url %>"><%= title %> <span class="<%= host %>-browse-item-date"><%= created %></span><div class="resource-collection-actions <%= collection_type %> <%= is_collaborator %> is-owner"><span class="<%= host %>-browse-item-visibility browse-item-visibility visibility-<%= visibility %>" title=" Who has access: <%= access %>"></span><div class="<%= host %>-collection-delete resource-collection-delete" id="collection-<%= id %>" title="Delete"></div></div></a></div>'),currentResourceCollectionVisibility:"",initResourcesCollections:function(){e(".resource-collection-item").length>=1&&(OC.resourcesCollections.initFavoriteStates(),OC.resourcesCollections.initCopyAction(),OC.resourcesCollections.ownerView&&OC.resourcesCollections.bindItemSelect(),OC.resourcesCollections.infiniteScroll()),e(".resources-collections-added").length>=1&&(e(".project-browse-item-visibility, .profile-browse-item-visibility").tipsy({gravity:"n"}),e(".resource-collection-delete").tipsy({gravity:"n"}),OC.resourcesCollections.bindItemVisibilityButton(),OC.resourcesCollectionsActions.initResourcesCollectionsActions())},initFavoriteStates:function(){function o(o,s){t=e(".resource-collection-item#resource-"+o);var i=e(".resource-favorite",t),l=e(".resource-favorite-wrapper",t);s&&(l.addClass("favorited"),i.text("Favorited")),i.click(function(t){var s=e(this),i=s.parent(".resource-favorite-wrapper");return OC.favoriteClickHandler("resource",o,function(){i.addClass("favorited"),s.text("Favorited")},function(){i.removeClass("favorited"),s.text("Favorite")}),t.stopPropagation(),t.preventDefault(),!1})}var t,s,i,l=e(".resource-collection-item");for(s=0;s<l.length;s++)i=e(l[s]).attr("id").substring(9),OC.getFavoriteState("resource",i,o)},infiniteScroll:function(){if(OC.resourcesCollections.resourceCount>20){var o,t,s=e(".lazy-load-button");e(".profile-content").on("DOMContentLoaded load resize scroll",function(){o=e(".resources-collections-added").attr("id").substring(11),e.contains(document,s[0])&&isElementInViewport(s)&&!s.hasClass("loading")&&(s.addClass("loading"),e.get("/resources/api/load-resources/"+o+"/from/"+OC.resourcesCollections.currentCount+"/",function(o){if("true"==o.status){var i=Object.keys(o.resources);if(0!==i.length){var l,c;for(t=0;t<i.length;t++){c=o.resources[i[t]],c.owner=OC.resourcesCollections.ownerView,e(".resources-collections-added").append(OC.resourcesCollections.resourceCollectionItemTemplate(c));var r=".resources-collections-added .resource-collection-item:last";l=e(r),OC.resourcesCollections.bindItemSelect(r),OC.resourcesCollectionsActions.bindResourceCollectionSelectors(r),e(".resource-item-description-modified",l).timeago()}OC.resourcesCollections.currentCount+=i.length}else s.remove()}else OC.popup(o.message,o.title);s.removeClass("loading")},"json"))})}},initCopyAction:function(){var o,t=e(".resource-collection-item"),s=e(".resources-collections-added");s.length>=1&&(o=s.attr("id").substring(11));var i;for(i=0;i<t.length;i++){var l,c;resourceCollectionItem=e(t[i]),resourceCollectionCopyButton=e(".resource-copy",resourceCollectionItem),resourceCollectionItem.hasClass("collection")?c=resourceCollectionItem.attr("id").substring(11):(l=resourceCollectionItem.attr("id").substring(9),c=void 0),o?c?OC.resourcesCollections.bindResourceCollectionCopyButton("collection",c,o):OC.resourcesCollections.bindResourceCollectionCopyButton("resource",l,o):c?OC.resourcesCollections.fetchParentCollectionAndBindCopyButton("collection",c,OC.resourcesCollections.bindResourceCollectionCopyButton):OC.resourcesCollections.fetchParentCollectionAndBindCopyButton("resource",l,OC.resourcesCollections.bindResourceCollectionCopyButton)}},synchronizeSelectors:function(){var o,t,s,i=e(".resource-item-thumbnail-selector"),l=0;for(l=0;l<i.length;l++)o=e(i[l]),s=o.parents(".resource-collection-item"),t=s.find("input[name=resource_collection_id]")[0],t.checked?s.addClass("selected"):s.removeClass("selected")},bindItemSelect:function(o){var t=o||".resource-collection-item";e(t).click(OC.resourcesCollections.itemSelectClickHandlers.itemClick),e(t+" input[name=resource_collection_id]").click(OC.resourcesCollections.itemSelectClickHandlers.inputClick),OC.resourcesCollections.itemSelectClickHandlers.preventPropagationOnItemClick(t)},itemSelectClickHandlers:{itemClick:function(){var o=e(this),t=e("input[name=resource_collection_id]",o),s=t[0];s.checked?t.prop("checked",!1):t.prop("checked",!0),o.toggleClass("selected"),t.trigger("itemSelected")},inputClick:function(o){var t=e(o.target).parents(".resource-collection-item");t.toggleClass("selected"),e(o.target).trigger("itemSelected")},preventPropagationOnItemClick:function(o){e(o+" input[name=resource_collection_id], "+o+" a.resource-item-thumbnail, "+o+" .resource-item-description-title a").click(function(e){e.stopPropagation()})}},bindResourceCollectionCopyButton:function(e,o,t){resourceCollectionCopyButton.click(function(s){OC.addCopyClickHandler(e,o,t,s)})},fetchParentCollectionAndBindCopyButton:function(o,t,s){"collection"===o?e.get("/resources/parent-collection-from-collection/"+t+"/",function(e){"true"==e.status?s("collection",collectionID,e.collectionID):OC.popup(e.message,e.title)},"json"):e.get("/resources/collection-from-resource/"+t+"/",function(e){"true"==e.status?s("resource",resourceID,e.collectionID):OC.popup(e.message,e.title)},"json")},bindItemVisibilityButton:function(){e(".browse-item-visibility").click(OC.resourcesCollections.itemVisibilityButtonClickHandler)},itemVisibilityButtonClickHandler:function(o){var t=e(o.target);if(t.hasClass("is-owner")||t.hasClass("is-collaborator")){var s=t.hasClass("project-browse-item-visibility"),i=e(o.target).closest(".resource-collection-item");i.type=i.hasClass("collection")?"collection":"resource",i.id=i.attr("id").substring("collection"===i.type?11:9),OC.collaborators.currentResourceCollectionVisibility=OC.resourcesCollections.getResourceCollectionVisibility(t,s),OC.collaborators.init(i,OC.resourcesCollections.resourceVisibility.setupToggler,OC.resourcesCollections.collectionVisibility.setupToggler,OC.resourcesCollections.closeCollaboratorPopupCallback,t.hasClass("is-owner"))}return o.stopPropagation(),o.preventDefault(),!1},getResourceCollectionVisibility:function(e,o){return e.hasClass("visibility-private")?"private":o?"project":"public"},collectionVisibility:{setupToggler:function(o,t){var s=e(".resources-collections-added #collection-"+o+" .browse-item-visibility");if(t){var i=e('.resource-collection-visibility-form-tabs li a[href="#project-access"]');i.click(function(){OC.resourcesCollections.collectionVisibility.setProjectVisibility(s,o)})}else{var l=e('.resource-collection-visibility-form-tabs li a[href="#profile-access"]');l.click(function(){OC.resourcesCollections.collectionVisibility.setPublicVisibility(s,o)})}var c=e('.resource-collection-visibility-form-tabs li a[href="#private-access"]');c.click(function(){OC.resourcesCollections.collectionVisibility.setPrivateVisibility(s,o)})},setProjectVisibility:function(e){e.removeClass("visibility-private"),e.addClass("visibility-project"),e.html('<span class="group-shared-icon"></span>Shared with group')},setPrivateVisibility:function(e){e.removeClass("visibility-project"),e.removeClass("visibility-public"),e.addClass("visibility-private"),e.html('<span class="private-shared-icon"></span>Shared')},setPublicVisibility:function(e){e.removeClass("visibility-private"),e.addClass("visibility-public"),e.html('<span class="publicly-shared-icon"></span>Public')}},resourceVisibility:{setupToggler:function(o,t){var s=e(".resources-collections-added #resource-"+o+" .browse-item-visibility");if(t){var i=e('.resource-collection-visibility-form-tabs li a[href="#project-access"]');i.click(function(){OC.resourcesCollections.resourceVisibility.setProjectVisibility(s,o)})}else{var l=e('.resource-collection-visibility-form-tabs li a[href="#profile-access"]');l.click(function(){OC.resourcesCollections.resourceVisibility.setPublicVisibility(s,o)})}var c=e('.resource-collection-visibility-form-tabs li a[href="#private-access"]');c.click(function(){OC.resourcesCollections.resourceVisibility.setPrivateVisibility(s,o)})},setProjectVisibility:function(e){e.removeClass("visibility-private"),e.addClass("visibility-project"),e.html('<span class="group-shared-icon"></span>Shared with group')},setPrivateVisibility:function(e){e.removeClass("visibility-project"),e.removeClass("visibility-public"),e.addClass("visibility-private"),e.html('<span class="private-shared-icon"></span>Shared')},setPublicVisibility:function(e){e.removeClass("visibility-private"),e.addClass("visibility-public"),e.html('<span class="publicly-shared-icon"></span>Public')}},closeCollaboratorPopupCallback:function(){var o=e("form#add-collection-collaborator-form input[name=collection_id]").val(),t=e("form#add-collection-collaborator-form input[name=resource_id]").val(),s=""===o?"resource-"+t:"collection-"+o,i=e(".resources-collections-added").hasClass("project-resources-collections"),l=e(".resources-collections-added #"+s+" .browse-item-visibility"),c=OC.resourcesCollections.getResourceCollectionVisibility(l,i);c!==OC.resourcesCollections.currentResourceCollectionVisibility&&""!==o&&(OC.setMessageBoxMessage("Changing access control of resources and folders inside..."),OC.showMessageBox(),OC.resourcesCollections.collectionVisibilityChangePropagation(o))},collectionVisibilityChangePropagation:function(o){e.get("/resources/collection/"+o+"/visibility/propagate-changes/",function(e){"true"===e.status?OC.resourcesCollections.collectionVisibilityPropagationSuccess():OC.popup(e.message,e.title)},"json")},collectionVisibilityPropagationSuccess:function(){OC.dismissMessageBox()}}),OC.resourcesCollectionsActions={pendingActions:{copyResources:[],copyCollections:[],deleteResources:[],deleteCollections:[],renameResources:[],renameCollections:[]},actionsCompleted:{copyResources:[],copyCollections:[],deleteResources:[],deleteCollections:[],renameResources:[],renameCollections:[]},actionCompletionCallback:"",actionCompleted:function(){var e,o=!0;for(e in OC.resourcesCollectionsActions.pendingActions)if(OC.resourcesCollectionsActions.pendingActions[e].length>=1){o=!1;break}o&&OC.resourcesCollectionsActions.actionCompletionCallback()},initResourcesCollectionsActions:function(){var o=e(".resources-collections-added");o.length>0&&(OC.resourcesCollectionsActions.initBrowseNavigation(),OC.resourcesCollectionsActions.initMoveResourcesCollections(),OC.resourcesCollectionsActions.initResourceCollectionActions())},initMoveResourcesCollections:function(){OC.resourcesCollectionsActions.initResourceCollectionsDraggability(e(".resource-collection-item")),OC.resourcesCollectionsActions.initResourceCollectionsDroppability(e(".resource-collection-item.directory"))},initResourceCollectionsDraggability:function(e){e.draggable({revert:"invalid"})},initResourceCollectionsDroppability:function(o){o.droppable({hoverClass:"droppable",accept:".directory, .resource",drop:function(o,t){t.draggable.hasClass("directory")?(OC.resourcesCollectionsActions.moveCollectionIntoCollection(t.draggable.attr("id").substring(11),e(o.target).attr("id").substring(11)),OC.resourcesCollectionsActions.movedIntoCollection([],[t.draggable])):(OC.resourcesCollectionsActions.moveResourceIntoCollection(t.draggable.attr("id").substring(9),e(o.target).attr("id").substring(11)),OC.resourcesCollectionsActions.movedIntoCollection([t.draggable],[]))}})},moveResourceIntoCollection:function(o,t){var s=e(".resources-collections-added").attr("id").substring(11);e.get("/resources/move/resource/"+o+"/from/"+s+"/to/"+t+"/",function(e){"true"==e.status?OC.resourcesCollectionsActions.resourceCollectionMovedSuccess(".resource-collection-item#resource-"+o):OC.popup(e.message,e.title)},"json")},moveCollectionIntoCollection:function(o,t){var s=e(".resources-collections-added").attr("id").substring(11);e.get("/resources/move/collection/"+o+"/from/"+s+"/to/"+t+"/",function(e){"true"==e.status?OC.resourcesCollectionsActions.resourceCollectionMovedSuccess(".resource-collection-item#collection-"+o):OC.popup(e.message,e.title)},"json")},resourceCollectionMovedSuccess:function(o){e(o).fadeOut("fast")},movedIntoCollection:function(e,o){var t=e||[],s=o||[];t.length>=1&&s.length>=1?OC.setMessageBoxMessage("Moved resources and folders successfully"):t.length>=1?OC.setMessageBoxMessage("Moved resource(s) into the folder successfully"):s.length>=1&&OC.setMessageBoxMessage("Moved folder(s) successfully"),OC.showMessageBox()},resourceCopiedSuccessfully:function(o,t){var s="project"===o.host?"":"profile-resource",i="collection"===o.visibility?"Private (collection)":o.visibility.charAt(0).toUpperCase();o.resource_type=s,o.access=i;var l=OC.resourcesCollections.resourceCollectionItemTemplate(o);e("."+o.host+"-resources-added-list").append(l);var c=e("."+o.host+"-resources-added-list .resource-collection-item:last"),r=e("input[type=checkbox]",c),n=e(".browse-item-visibility",c);r.click(OC.resourcesCollectionsActions.resourceCollectionCheckboxHandler),n.click(OC.resourcesCollections.itemVisibilityButtonClickHandler),OC.resourcesCollectionsActions.initResourceCollectionsDraggability(c),e(".resource-item-description-modified",c).timeago(),OC.resourcesCollectionsActions.pendingActions.copyResources.splice(t),OC.resourcesCollectionsActions.actionsCompleted.copyResources.push(t),OC.resourcesCollectionsActions.actionCompleted()},collectionCopiedSuccessfully:function(o,t){var s="project"===o.host?"":"profile-collection",i="collection"===o.visibility?"Private (collection)":o.visibility.charAt(0).toUpperCase();o.collection_type=s,o.access=i;var l=OC.resourcesCollections.collectionItemTemplate(o);e("."+o.host+"-collections-added-list").append(l);var c=e("."+o.host+"-collections-added-list .resource-collection-item:last"),r=e("input[type=checkbox]",c),n=e(".browse-item-visibility",c);r.click(OC.resourcesCollectionsActions.resourceCollectionCheckboxHandler),n.click(OC.resourcesCollections.itemVisibilityButtonClickHandler),OC.resourcesCollectionsActions.initResourceCollectionsDraggability(c),OC.resourcesCollectionsActions.initResourceCollectionsDroppability(c),e(".resource-item-description-modified",c).timeago(),OC.resourcesCollectionsActions.pendingActions.copyCollections.splice(t),OC.resourcesCollectionsActions.actionsCompleted.copyCollections.push(t),OC.resourcesCollectionsActions.actionCompleted()},resourceRenamedSuccessfully:function(o,t){var s=e(".resource-collection-item#resource-"+o),i=e(".resource-item-description-title a",s);i.text(t),s.trigger("click"),OC.resourcesCollectionsActions.pendingActions.renameResources.splice(o),OC.resourcesCollectionsActions.actionsCompleted.renameResources.push(o),OC.resourcesCollectionsActions.actionCompleted()},collectionRenamedSuccessfully:function(o,t){var s=e(".resource-collection-item#collection-"+o),i=e(".resource-item-description-title a",s);i.text(t),s.trigger("click"),OC.resourcesCollectionsActions.pendingActions.renameCollections.splice(o),OC.resourcesCollectionsActions.actionsCompleted.renameCollections.push(o),OC.resourcesCollectionsActions.actionCompleted()},copying:function(){OC.setMessageBoxMessage("Copying..."),OC.showMessageBox()},copied:function(){var e=OC.resourcesCollectionsActions.actionsCompleted.copyResources,o=OC.resourcesCollectionsActions.actionsCompleted.copyCollections;e.length>=1&&o.length>=1?OC.setMessageBoxMessage("Copied resources and folders successfully"):e.length>=1?OC.setMessageBoxMessage("Copied resource(s) successfully"):o.length>=1&&OC.setMessageBoxMessage("Copied folder(s) successfully"),OC.showMessageBox()},renaming:function(){OC.setMessageBoxMessage("Renaming..."),OC.showMessageBox()},renamed:function(){var e=OC.resourcesCollectionsActions.actionsCompleted.renameResources,o=OC.resourcesCollectionsActions.actionsCompleted.renameCollections;1===e.length?OC.setMessageBoxMessage("Renamed resource successfully"):1===o.length&&OC.setMessageBoxMessage("Renamed folder successfully"),OC.showMessageBox()},collectionsDeletedSuccessfully:function(o){var t;for(t=0;t<o.length;t++)OC.resourcesCollectionsActions.pendingActions.deleteCollections.splice(o[t]),OC.resourcesCollectionsActions.actionsCompleted.deleteCollections.push(o[t]),e(".resource-collection-item#collection-"+o[t]).fadeOut();OC.resourcesCollectionsActions.actionCompleted()},resourcesDeletedSuccessfully:function(o){var t;for(t=0;t<o.length;t++)OC.resourcesCollectionsActions.pendingActions.deleteResources.splice(o[t]),OC.resourcesCollectionsActions.actionsCompleted.deleteResources.push(o[t]),e(".resource-collection-item#resource-"+o[t]).fadeOut();OC.resourcesCollectionsActions.actionCompleted()},deleting:function(){OC.setMessageBoxMessage("Deleting..."),OC.showMessageBox()},deleted:function(){var e=OC.resourcesCollectionsActions.actionsCompleted.deleteResources,o=OC.resourcesCollectionsActions.actionsCompleted.deleteCollections;e.length>=1&&o.length>=1?OC.setMessageBoxMessage("Deleted resources and folders successfully"):e.length>=1?OC.setMessageBoxMessage("Deleted resource(s) successfully"):o.length>=1&&OC.setMessageBoxMessage("Deleted folder(s) successfully"),OC.showMessageBox()},initResourceCollectionActions:function(){function o(){var o=e(".profile-resources-collections-wrapper"),t=e(".profile-resources-collections-actions-menu");return isElementInViewport(o)?t.height()>o.height()?t.height():o.height():e(window).height()-o.offset().top}function t(){i.height(a)}var s=e(".profile-resources-collections-actions"),i=e(".profile-resources-collections-actions-shadow"),l=e(".profile-resources-collections-wrapper"),c=e(".profile-tabs"),r=c.position().top+c.outerHeight(!0),n=s.position().left;s.css({top:r,left:n});var a=o();e(".profile-content").on("scroll",function(){isElementInViewport(s)&&!s.hasClass("floating")?s.position().top<r&&(s.addClass("floating"),i.height(e(window).height()-r)):s.hasClass("floating")&&l.position().top>r&&(s.removeClass("floating"),i.height(a))}),t(),e(window).resize(function(){a=o(),t()}),OC.resourcesCollectionsActions.bindResourceCollectionSelectors(),OC.resourcesCollectionsActions.actionButtonsClickHandler();var u=e(".resource-collection-item input[type=checkbox]:checked");if(u.length>=1){var d;for(d=0;d<u.length;d++)OC.resourcesCollectionsActions.selectedResourcesCollections.push(u[d])}else OC.resourcesCollectionsActions.selectedResourcesCollectionsChangeListener()},actionButtonsClickHandler:function(){var o=e(".collection-actions .move-button");o.click(OC.resourcesCollectionsActions.moveButtonClickHandler);var t=e(".collection-actions .copy-button");t.click(OC.resourcesCollectionsActions.copyButtonClickHandler);var s=e(".collection-actions .rename-button");s.click(OC.resourcesCollectionsActions.renameButtonClickHandler);var i=e(".collection-actions .del-button");i.click(OC.resourcesCollectionsActions.deleteButtonClickHandler)},moveButtonClickHandler:function(o){var t=OC.customPopup(".move-resource-collection-dialog"),s=e(".move-resource-collection-browser"),i=e(".resources-collections-added").attr("id").substring(11);s.children().remove(),s.addClass("loading-browser"),e(".move-resource-collection-submit-button").click(function(){var o=s.find(".selected-destination-collection");if(t.close(),o){var i,l=o.attr("id").substring(11),c=[],r=[];for(i=0;i<OC.resourcesCollectionsActions.selectedResourcesCollections.length;i++){var n=e(OC.resourcesCollectionsActions.selectedResourcesCollections[i]).closest(".resource-collection-item");n.hasClass("collection")?(OC.resourcesCollectionsActions.moveCollectionIntoCollection(n.attr("id").substring(11),l),r.push(OC.resourcesCollectionsActions.selectedResourcesCollections[i])):(OC.resourcesCollectionsActions.moveResourceIntoCollection(n.attr("id").substring(9),l),c.push(OC.resourcesCollectionsActions.selectedResourcesCollections[i]))}OC.resourcesCollectionsActions.movedIntoCollection(c,r)}});var l=e(".resources-collections-added").hasClass("project-resources-collections");return l?e.get("/resources/collection/"+i+"/tree/collections/project/",function(e){"true"==e.status?(OC.renderBrowser(e.tree,s,i),s.removeClass("loading-browser")):OC.popup(e.message,e.title)},"json"):e.get("/resources/tree/collections/user/",function(e){"true"==e.status?(OC.renderBrowser(e.tree,s,i),s.removeClass("loading-browser")):OC.popup(e.message,e.title)},"json"),o.stopPropagation(),o.preventDefault(),!1},copyButtonClickHandler:function(o){var t=e(".resources-collections-added").attr("id").substring(11);OC.resourcesCollectionsActions.copying();
var s,i=[],l=[];for(s=0;s<OC.resourcesCollectionsActions.selectedResourcesCollections.length;s++){var c=e(OC.resourcesCollectionsActions.selectedResourcesCollections[s]).closest(".resource-collection-item");if(c.hasClass("collection")){var r=c.attr("id").substring(11);OC.collection.copy(r,t,OC.resourcesCollectionsActions.collectionCopiedSuccessfully),l.push(r)}else{var n=c.attr("id").substring(9);OC.resource.copy(t,n,t,OC.resourcesCollectionsActions.resourceCopiedSuccessfully),i.push(n)}}return OC.resourcesCollectionsActions.pendingActions.copyResources.concat(i),OC.resourcesCollectionsActions.pendingActions.copyCollections.concat(l),OC.resourcesCollectionsActions.actionCompletionCallback=OC.resourcesCollectionsActions.copied,o.stopPropagation(),o.preventDefault(),!1},renameButtonClickHandler:function(o){OC.resourcesCollectionsActions.renaming();var t=e(OC.resourcesCollectionsActions.selectedResourcesCollections[0]).closest(".resource-collection-item"),s=OC.customPopup(".rename-file-folder-dialog"),i=e('input[name="new_name"]',s.dialog),l=e(".resource-item-description-title a",t).text();return i.val(l),e(".rename-file-folder-submit-button",s.dialog).click(function(o){s.close();var c=i.val();if(c!==l){var r=[],n=[];if(t.hasClass("collection")){var a=t.attr("id").substring(11);OC.collection.rename(a,c,OC.resourcesCollectionsActions.collectionRenamedSuccessfully),n.push(a)}else{var u=t.attr("id").substring(9);OC.resource.rename(u,c,OC.resourcesCollectionsActions.resourceRenamedSuccessfully),r.push(u)}OC.resourcesCollectionsActions.pendingActions.renameResources.concat(r),OC.resourcesCollectionsActions.pendingActions.renameCollections.concat(n),OC.resourcesCollectionsActions.actionCompletionCallback=OC.resourcesCollectionsActions.renamed}return i.val(""),e(this).unbind("click"),o.stopPropagation(),o.preventDefault(),!1}),o.stopPropagation(),o.preventDefault(),!1},setDialogMessage:function(o,t,s){e(o+"-message").text(t),e(o+"-title").text(s)},getSelectedResourcesCollections:function(){var o,t=[],s=[];for(o=0;o<OC.resourcesCollectionsActions.selectedResourcesCollections.length;o++){var i=e(OC.resourcesCollectionsActions.selectedResourcesCollections[o]).closest(".resource-collection-item");i.hasClass("collection")?s.push(OC.resourcesCollectionsActions.selectedResourcesCollections[o]):t.push(OC.resourcesCollectionsActions.selectedResourcesCollections[o])}return[t,s]},deleteButtonClickHandler:function(o){var t=e(".resources-collections-added").attr("id").substring(11);OC.resourcesCollectionsActions.deleting();var s,i=[],l=[],c=[],r=[];for(s=0;s<OC.resourcesCollectionsActions.selectedResourcesCollections.length;s++){var n=e(OC.resourcesCollectionsActions.selectedResourcesCollections[s]).closest(".resource-collection-item");n.hasClass("collection")?(l.push(n.attr("id").substring(11)),r.push(OC.resourcesCollectionsActions.selectedResourcesCollections[s])):(i.push(n.attr("id").substring(9)),c.push(OC.resourcesCollectionsActions.selectedResourcesCollections[s]))}return resourceCollections=OC.resourcesCollectionsActions.getSelectedResourcesCollections(),resourceCollections[0].length>1&&resourceCollections[1].length>1?(OC.resourcesCollectionsActions.setDialogMessage(".delete-resource-collection-dialog","Are you sure you want to delete these files and folders? This will also delete all the files and folders within these folders.","Delete files and folders"),OC.resource.deleteMultiple(i,t,OC.resourcesCollectionsActions.resourcesDeletedSuccessfully),OC.collection.deleteMultiple(l,OC.resourcesCollectionsActions.collectionsDeletedSuccessfully)):resourceCollections[0].length>1&&1===resourceCollections[1].length?(OC.resourcesCollectionsActions.setDialogMessage(".delete-resource-collection-dialog","Are you sure you want to delete these files and the selected folder? This will also delete all the files and folders within the folder.","Delete files and folder"),OC.resource.deleteMultiple(i,t,OC.resourcesCollectionsActions.resourcesDeletedSuccessfully),OC.collection.delete(l[0],OC.resourcesCollectionsActions.collectionsDeletedSuccessfully)):1===resourceCollections[0].length&&resourceCollections[1].length>1?(OC.resourcesCollectionsActions.setDialogMessage(".delete-resource-collection-dialog","Are you sure you want to delete these folders and the selected file? This will also delete all the files and folders within these folders.","Delete folders and file"),OC.resource.delete(i[0],t,OC.resourcesCollectionsActions.resourcesDeletedSuccessfully),OC.collection.deleteMultiple(l,OC.resourcesCollectionsActions.collectionsDeletedSuccessfully)):1===resourceCollections[0].length&&1===resourceCollections[1].length?(OC.resourcesCollectionsActions.setDialogMessage(".delete-resource-collection-dialog","Are you sure you want to delete this folder and this file? This will also delete all the files and folders within the folder.","Delete folder and file"),OC.resource.delete(i[0],t,OC.resourcesCollectionsActions.resourcesDeletedSuccessfully),OC.collection.delete(l[0],OC.resourcesCollectionsActions.collectionsDeletedSuccessfully)):resourceCollections[0].length>1?(OC.resourcesCollectionsActions.setDialogMessage(".delete-resource-collection-dialog","Are you sure you want to delete these resources?","Delete resources"),OC.resource.deleteMultiple(i,t,OC.resourcesCollectionsActions.resourcesDeletedSuccessfully)):resourceCollections[1].length>1?(OC.resourcesCollectionsActions.setDialogMessage(".delete-resource-collection-dialog","Are you sure you want to delete these folders? This will also delete all the files and folders within these folders.","Delete folders"),OC.collection.deleteMultiple(l,OC.resourcesCollectionsActions.resourcesDeletedSuccessfully)):1===resourceCollections[0].length?(OC.resourcesCollectionsActions.setDialogMessage(".delete-resource-collection-dialog","Are you sure you want to delete this resource?","Delete resource"),OC.resource.delete(i[0],t,OC.resourcesCollectionsActions.resourcesDeletedSuccessfully)):1===resourceCollections[1].length&&(OC.resourcesCollectionsActions.setDialogMessage(".delete-resource-collection-dialog","Are you sure you want to delete this folder? This will also delete all the files and folders within the folder.","Delete folder"),OC.collection.delete(l[0],OC.resourcesCollectionsActions.collectionsDeletedSuccessfully)),OC.resourcesCollectionsActions.pendingActions.deleteResources.concat(c),OC.resourcesCollectionsActions.pendingActions.deleteCollections.concat(r),OC.resourcesCollectionsActions.actionCompletionCallback=OC.resourcesCollectionsActions.deleted,o.stopPropagation(),o.preventDefault(),!1},bindResourceCollectionSelectors:function(o){var t=o||".resource-collection-item";e(t+" input[type=checkbox]").on("itemSelected",OC.resourcesCollectionsActions.resourceCollectionCheckboxHandler)},selectedResourcesCollections:[],resourceCollectionCheckboxHandler:function(o){var t=e(o.target).closest(".resource-collection-item");if(o.target.checked===!1){var s=OC.resourcesCollectionsActions.selectedResourcesCollections.indexOf(t);OC.resourcesCollectionsActions.selectedResourcesCollections.splice(s,1)}else OC.resourcesCollectionsActions.selectedResourcesCollections.push(t);OC.resourcesCollectionsActions.selectedResourcesCollectionsChangeListener()},selectedResourcesCollectionsChangeListener:function(){var o=e(".collection-actions .move-button"),t=e(".collection-actions .copy-button"),s=e(".collection-actions .del-button"),i=e(".collection-actions .rename-button"),l=e(".collection-actions .share-button"),c=e(".profile-resources-collections-actions-menu-edit"),r=e(".profile-resources-collections-actions-menu-add");OC.resourcesCollectionsActions.selectedResourcesCollections.length>=1?(c.hasClass("show")||(c.addClass("show"),r.addClass("fade-out")),1==OC.resourcesCollectionsActions.selectedResourcesCollections.length?(OC.resourcesCollectionsActions.enableActionButton(l),OC.resourcesCollectionsActions.enableActionButton(i)):(OC.resourcesCollectionsActions.disableActionButton(l),OC.resourcesCollectionsActions.disableActionButton(i)),OC.resourcesCollectionsActions.enableActionButton(o),OC.resourcesCollectionsActions.enableActionButton(t),OC.resourcesCollectionsActions.enableActionButton(s),OC.resourcesCollectionsActions.actionButtonsClickHandler()):(OC.resourcesCollectionsActions.disableActionButton(o),OC.resourcesCollectionsActions.disableActionButton(t),OC.resourcesCollectionsActions.disableActionButton(s),OC.resourcesCollectionsActions.disableActionButton(i),OC.resourcesCollectionsActions.disableActionButton(l),c.removeClass("show"),r.removeClass("fade-out"))},enableActionButton:function(e){e.removeClass("disabled-collection-button"),e.disabled=!1,e.unbind("click")},disableActionButton:function(e){e.addClass("disabled-collection-button"),e.disabled=!0,e.unbind("click"),e.click(function(e){return e.stopPropagation(),e.preventDefault(),!1})},initBrowseNavigation:function(){var o=e(".resources-collections-added").attr("id").substring(11),t=e("nav.collections-navigation").find("a#collection-"+o);t.addClass("current-navigation-collection"),t.parents(".parent-collection").each(function(){e(this).find(".toggle-collection:first").click()})}},e(document).ready(function(e){OC.resourcesCollections.initResourcesCollections(),OC.resourcesCollections.ownerView&&OC.resourcesCollections.synchronizeSelectors(),e(".resource-item-description-modified").timeago()})}),define("files",["jquery","core","resourcesCollections"],function(){});