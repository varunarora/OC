/**
 * Timeago is a jQuery plugin that makes it easy to support automatically
 * updating fuzzy timestamps (e.g. "4 minutes ago" or "about 1 day ago").
 *
 * @name timeago
 * @version 1.4.1
 * @requires jQuery v1.2.3+
 * @author Ryan McGeary
 * @license MIT License - http://www.opensource.org/licenses/mit-license.php
 *
 * For usage and examples, visit:
 * http://timeago.yarp.com/
 *
 * Copyright (c) 2008-2013, Ryan McGeary (ryan -[at]- mcgeary [*dot*] org)
 */

/*!
 * jQuery UI Mouse @VERSION
 * http://jqueryui.com
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/mouse/
 */

/*!
 * jQuery UI Draggable @VERSION
 * http://jqueryui.com
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/draggable/
 */

/*!
 * jQuery UI Droppable @VERSION
 * http://jqueryui.com
 *
 * Copyright 2014 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/droppable/
 */

!function(e){"function"==typeof define&&define.amd?define("timeago",["jquery"],e):e(jQuery)}(function(e){function t(){var t=s(this),l=n.settings;return isNaN(t.datetime)||(0==l.cutoff||Math.abs(i(t.datetime))<l.cutoff)&&e(this).text(o(t.datetime)),this}function s(t){if(t=e(t),!t.data("timeago")){t.data("timeago",{datetime:n.datetime(t)});var s=e.trim(t.text());n.settings.localeTitle?t.attr("title",t.data("timeago").datetime.toLocaleString()):!(s.length>0)||n.isTime(t)&&t.attr("title")||t.attr("title",s)}return t.data("timeago")}function o(e){return n.inWords(i(e))}function i(e){return(new Date).getTime()-e.getTime()}e.timeago=function(t){return o(t instanceof Date?t:"string"==typeof t?e.timeago.parse(t):"number"==typeof t?new Date(t):e.timeago.datetime(t))};var n=e.timeago;e.extend(e.timeago,{settings:{refreshMillis:6e4,allowPast:!0,allowFuture:!1,localeTitle:!1,cutoff:0,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",inPast:"any moment now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",wordSeparator:" ",numbers:[]}},inWords:function(t){function s(s,i){var n=e.isFunction(s)?s(i,t):s,l=o.numbers&&o.numbers[i]||i;return n.replace(/%d/i,l)}if(!this.settings.allowPast&&!this.settings.allowFuture)throw"timeago allowPast and allowFuture settings can not both be set to false.";var o=this.settings.strings,i=o.prefixAgo,n=o.suffixAgo;if(this.settings.allowFuture&&0>t&&(i=o.prefixFromNow,n=o.suffixFromNow),!this.settings.allowPast&&t>=0)return this.settings.strings.inPast;var l=Math.abs(t)/1e3,r=l/60,c=r/60,a=c/24,u=a/365,d=45>l&&s(o.seconds,Math.round(l))||90>l&&s(o.minute,1)||45>r&&s(o.minutes,Math.round(r))||90>r&&s(o.hour,1)||24>c&&s(o.hours,Math.round(c))||42>c&&s(o.day,1)||30>a&&s(o.days,Math.round(a))||45>a&&s(o.month,1)||365>a&&s(o.months,Math.round(a/30))||1.5>u&&s(o.year,1)||s(o.years,Math.round(u)),p=o.wordSeparator||"";return void 0===o.wordSeparator&&(p=" "),e.trim([i,d,n].join(p))},parse:function(t){var s=e.trim(t);return s=s.replace(/\.\d+/,""),s=s.replace(/-/,"/").replace(/-/,"/"),s=s.replace(/T/," ").replace(/Z/," UTC"),s=s.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),s=s.replace(/([\+\-]\d\d)$/," $100"),new Date(s)},datetime:function(t){var s=e(t).attr(n.isTime(t)?"datetime":"title");return n.parse(s)},isTime:function(t){return"time"===e(t).get(0).tagName.toLowerCase()}});var l={init:function(){var s=e.proxy(t,this);s();var o=n.settings;o.refreshMillis>0&&(this._timeagoInterval=setInterval(s,o.refreshMillis))},update:function(s){var o=n.parse(s);e(this).data("timeago",{datetime:o}),n.settings.localeTitle&&e(this).attr("title",o.toLocaleString()),t.apply(this)},updateFromDOM:function(){e(this).data("timeago",{datetime:n.parse(e(this).attr(n.isTime(this)?"datetime":"title"))}),t.apply(this)},dispose:function(){this._timeagoInterval&&(window.clearInterval(this._timeagoInterval),this._timeagoInterval=null)}};e.fn.timeago=function(e,t){var s=e?l[e]:l.init;if(!s)throw new Error("Unknown function name '"+e+"' for timeago");return this.each(function(){s.call(this,t)}),this},document.createElement("abbr"),document.createElement("time")}),function(e){"function"==typeof define&&define.amd?define("mouse",["jquery","widget"],e):e(jQuery)}(function(e){var t=!1;return e(document).mouseup(function(){t=!1}),e.widget("ui.mouse",{version:"@VERSION",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(s){return!0===e.data(s.target,t.widgetName+".preventClickEvent")?(e.removeData(s.target,t.widgetName+".preventClickEvent"),s.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(s){if(!t){this._mouseMoved=!1,this._mouseStarted&&this._mouseUp(s),this._mouseDownEvent=s;var o=this,i=1===s.which,n="string"==typeof this.options.cancel&&s.target.nodeName?e(s.target).closest(this.options.cancel).length:!1;return i&&!n&&this._mouseCapture(s)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){o.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(s)&&this._mouseDelayMet(s)&&(this._mouseStarted=this._mouseStart(s)!==!1,!this._mouseStarted)?(s.preventDefault(),!0):(!0===e.data(s.target,this.widgetName+".preventClickEvent")&&e.removeData(s.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return o._mouseMove(e)},this._mouseUpDelegate=function(e){return o._mouseUp(e)},this.document.bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),s.preventDefault(),t=!0,!0)):!0}},_mouseMove:function(t){if(this._mouseMoved){if(e.ui.ie&&(!document.documentMode||document.documentMode<9)&&!t.button)return this._mouseUp(t);if(!t.which)return this._mouseUp(t)}return(t.which||t.button)&&(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(s){return this.document.unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,s.target===this._mouseDownEvent.target&&e.data(s.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(s)),t=!1,!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}),function(e){"function"==typeof define&&define.amd?define("draggable",["jquery","ui_core","mouse","widget"],e):e(jQuery)}(function(e){return e.widget("ui.draggable",e.ui.mouse,{version:"@VERSION",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"===this.options.helper&&this._setPositionRelative(),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._setHandleClassName(),this._mouseInit()},_setOption:function(e,t){this._super(e,t),"handle"===e&&(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(".ui-draggable-dragging")?void(this.destroyOnClear=!0):(this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._removeHandleClassName(),void this._mouseDestroy())},_mouseCapture:function(t){var s=this.options;return this._blurActiveElement(t),this.helper||s.disabled||e(t.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(t),this.handle?(e(s.iframeFix===!0?"iframe":s.iframeFix).each(function(){e("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0):!1)},_blurActiveElement:function(t){var s=this.document[0];if(this.handleElement.is(t.target))try{s.activeElement&&"body"!==s.activeElement.nodeName.toLowerCase()&&e(s.activeElement).blur()}catch(o){}},_mouseStart:function(t){var s=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t,!1),this.originalPageX=t.pageX,this.originalPageY=t.pageY,s.cursorAt&&this._adjustOffsetFromHelper(s.cursorAt),this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!s.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._normalizeRightBottom(),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,s){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t,!0),this.positionAbs=this._convertPositionTo("absolute"),!s){var o=this._uiHash();if(this._trigger("drag",t,o)===!1)return this._mouseUp({}),!1;this.position=o.position}return this.helper[0].style.left=this.position.left+"px",this.helper[0].style.top=this.position.top+"px",e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var s=this,o=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(o=e.ui.ddmanager.drop(this,t)),this.dropped&&(o=this.dropped,this.dropped=!1),"invalid"===this.options.revert&&!o||"valid"===this.options.revert&&o||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,o)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){s._trigger("stop",t)!==!1&&s._clear()}):this._trigger("stop",t)!==!1&&this._clear(),!1},_mouseUp:function(t){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),this.handleElement.is(t.target)&&this.element.focus(),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return this.options.handle?!!e(t.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this.handleElement.addClass("ui-draggable-handle")},_removeHandleClassName:function(){this.handleElement.removeClass("ui-draggable-handle")},_createHelper:function(t){var s=this.options,o=e.isFunction(s.helper),i=o?e(s.helper.apply(this.element[0],[t])):"clone"===s.helper?this.element.clone().removeAttr("id"):this.element;return i.parents("body").length||i.appendTo("parent"===s.appendTo?this.element[0].parentNode:s.appendTo),o&&i[0]===this.element[0]&&this._setPositionRelative(),i[0]===this.element[0]||/(fixed|absolute)/.test(i.css("position"))||i.css("position","absolute"),i},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative")},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_isRootNode:function(e){return/(html|body)/i.test(e.tagName)||e===this.document[0]},_getParentOffset:function(){var t=this.offsetParent.offset(),s=this.document[0];return"absolute"===this.cssPosition&&this.scrollParent[0]!==s&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"!==this.cssPosition)return{top:0,left:0};var e=this.element.position(),t=this._isRootNode(this.scrollParent[0]);return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+(t?0:this.scrollParent.scrollTop()),left:e.left-(parseInt(this.helper.css("left"),10)||0)+(t?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,s,o,i=this.options,n=this.document[0];return this.relativeContainer=null,i.containment?"window"===i.containment?void(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||n.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===i.containment?void(this.containment=[0,0,e(n).width()-this.helperProportions.width-this.margins.left,(e(n).height()||n.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):i.containment.constructor===Array?void(this.containment=i.containment):("parent"===i.containment&&(i.containment=this.helper[0].parentNode),s=e(i.containment),o=s[0],void(o&&(t=/(scroll|auto)/.test(s.css("overflow")),this.containment=[(parseInt(s.css("borderLeftWidth"),10)||0)+(parseInt(s.css("paddingLeft"),10)||0),(parseInt(s.css("borderTopWidth"),10)||0)+(parseInt(s.css("paddingTop"),10)||0),(t?Math.max(o.scrollWidth,o.offsetWidth):o.offsetWidth)-(parseInt(s.css("borderRightWidth"),10)||0)-(parseInt(s.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(o.scrollHeight,o.offsetHeight):o.offsetHeight)-(parseInt(s.css("borderBottomWidth"),10)||0)-(parseInt(s.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=s))):void(this.containment=null)},_convertPositionTo:function(e,t){t||(t=this.position);var s="absolute"===e?1:-1,o=this._isRootNode(this.scrollParent[0]);return{top:t.top+this.offset.relative.top*s+this.offset.parent.top*s-("fixed"===this.cssPosition?-this.offset.scroll.top:o?0:this.offset.scroll.top)*s,left:t.left+this.offset.relative.left*s+this.offset.parent.left*s-("fixed"===this.cssPosition?-this.offset.scroll.left:o?0:this.offset.scroll.left)*s}},_generatePosition:function(e,t){var s,o,i,n,l=this.options,r=this._isRootNode(this.scrollParent[0]),c=e.pageX,a=e.pageY;return r&&this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),t&&(this.containment&&(this.relativeContainer?(o=this.relativeContainer.offset(),s=[this.containment[0]+o.left,this.containment[1]+o.top,this.containment[2]+o.left,this.containment[3]+o.top]):s=this.containment,e.pageX-this.offset.click.left<s[0]&&(c=s[0]+this.offset.click.left),e.pageY-this.offset.click.top<s[1]&&(a=s[1]+this.offset.click.top),e.pageX-this.offset.click.left>s[2]&&(c=s[2]+this.offset.click.left),e.pageY-this.offset.click.top>s[3]&&(a=s[3]+this.offset.click.top)),l.grid&&(i=l.grid[1]?this.originalPageY+Math.round((a-this.originalPageY)/l.grid[1])*l.grid[1]:this.originalPageY,a=s?i-this.offset.click.top>=s[1]||i-this.offset.click.top>s[3]?i:i-this.offset.click.top>=s[1]?i-l.grid[1]:i+l.grid[1]:i,n=l.grid[0]?this.originalPageX+Math.round((c-this.originalPageX)/l.grid[0])*l.grid[0]:this.originalPageX,c=s?n-this.offset.click.left>=s[0]||n-this.offset.click.left>s[2]?n:n-this.offset.click.left>=s[0]?n-l.grid[0]:n+l.grid[0]:n),"y"===l.axis&&(c=this.originalPageX),"x"===l.axis&&(a=this.originalPageY)),{top:a-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top),left:c-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&&this.destroy()},_normalizeRightBottom:function(){"y"!==this.options.axis&&"auto"!==this.helper.css("right")&&(this.helper.width(this.helper.width()),this.helper.css("right","auto")),"x"!==this.options.axis&&"auto"!==this.helper.css("bottom")&&(this.helper.height(this.helper.height()),this.helper.css("bottom","auto"))},_trigger:function(t,s,o){return o=o||this._uiHash(),e.ui.plugin.call(this,t,[s,o,this],!0),/^(drag|start|stop)/.test(t)&&(this.positionAbs=this._convertPositionTo("absolute"),o.offset=this.positionAbs),e.Widget.prototype._trigger.call(this,t,s,o)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,s,o){var i=o.options,n=e.extend({},s,{item:o.element});o.sortables=[],e(i.connectToSortable).each(function(){var s=e(this).sortable("instance");s&&!s.options.disabled&&(o.sortables.push({instance:s,shouldRevert:s.options.revert}),s.refreshPositions(),s._trigger("activate",t,n))})},stop:function(t,s,o){var i=e.extend({},s,{item:o.element});e.each(o.sortables,function(){this.instance.isOver?(this.instance.isOver=0,o.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,"original"===o.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,i))})},drag:function(t,s,o){var i=this;e.each(o.sortables,function(){var n=!1,l=this;this.instance.positionAbs=o.positionAbs,this.instance.helperProportions=o.helperProportions,this.instance.offset.click=o.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(n=!0,e.each(o.sortables,function(){return this.instance.positionAbs=o.positionAbs,this.instance.helperProportions=o.helperProportions,this.instance.offset.click=o.offset.click,this!==l&&this.instance._intersectsWith(this.instance.containerCache)&&e.contains(l.instance.element[0],this.instance.element[0])&&(n=!1),n})),n?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(i).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return s.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=o.offset.click.top,this.instance.offset.click.left=o.offset.click.left,this.instance.offset.parent.left-=o.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=o.offset.parent.top-this.instance.offset.parent.top,o._trigger("toSortable",t),o.dropped=this.instance.element,o.currentItem=o.element,this.instance.fromOutside=o),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),o._trigger("fromSortable",t),o.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(t,s,o){var i=e("body"),n=o.options;i.css("cursor")&&(n._cursor=i.css("cursor")),i.css("cursor",n.cursor)},stop:function(t,s,o){var i=o.options;i._cursor&&e("body").css("cursor",i._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,s,o){var i=e(s.helper),n=o.options;i.css("opacity")&&(n._opacity=i.css("opacity")),i.css("opacity",n.opacity)},stop:function(t,s,o){var i=o.options;i._opacity&&e(s.helper).css("opacity",i._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(e,t,s){s.scrollParentNotHidden||(s.scrollParentNotHidden=s.helper.scrollParent(!1)),s.scrollParentNotHidden[0]!==s.document[0]&&"HTML"!==s.scrollParentNotHidden[0].tagName&&(s.overflowOffset=s.scrollParentNotHidden.offset())},drag:function(t,s,o){var i=o.options,n=!1,l=o.scrollParentNotHidden[0],r=o.document[0];l!==r&&"HTML"!==l.tagName?(i.axis&&"x"===i.axis||(o.overflowOffset.top+l.offsetHeight-t.pageY<i.scrollSensitivity?l.scrollTop=n=l.scrollTop+i.scrollSpeed:t.pageY-o.overflowOffset.top<i.scrollSensitivity&&(l.scrollTop=n=l.scrollTop-i.scrollSpeed)),i.axis&&"y"===i.axis||(o.overflowOffset.left+l.offsetWidth-t.pageX<i.scrollSensitivity?l.scrollLeft=n=l.scrollLeft+i.scrollSpeed:t.pageX-o.overflowOffset.left<i.scrollSensitivity&&(l.scrollLeft=n=l.scrollLeft-i.scrollSpeed))):(i.axis&&"x"===i.axis||(t.pageY-e(r).scrollTop()<i.scrollSensitivity?n=e(r).scrollTop(e(r).scrollTop()-i.scrollSpeed):e(window).height()-(t.pageY-e(r).scrollTop())<i.scrollSensitivity&&(n=e(r).scrollTop(e(r).scrollTop()+i.scrollSpeed))),i.axis&&"y"===i.axis||(t.pageX-e(r).scrollLeft()<i.scrollSensitivity?n=e(r).scrollLeft(e(r).scrollLeft()-i.scrollSpeed):e(window).width()-(t.pageX-e(r).scrollLeft())<i.scrollSensitivity&&(n=e(r).scrollLeft(e(r).scrollLeft()+i.scrollSpeed)))),n!==!1&&e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(o,t)}}),e.ui.plugin.add("draggable","snap",{start:function(t,s,o){var i=o.options;o.snapElements=[],e(i.snap.constructor!==String?i.snap.items||":data(ui-draggable)":i.snap).each(function(){var t=e(this),s=t.offset();this!==o.element[0]&&o.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:s.top,left:s.left})})},drag:function(t,s,o){var i,n,l,r,c,a,u,d,p,h,f=o.options,m=f.snapTolerance,C=s.offset.left,g=C+o.helperProportions.width,v=s.offset.top,b=v+o.helperProportions.height;for(p=o.snapElements.length-1;p>=0;p--)c=o.snapElements[p].left-o.margins.left,a=c+o.snapElements[p].width,u=o.snapElements[p].top-o.margins.top,d=u+o.snapElements[p].height,c-m>g||C>a+m||u-m>b||v>d+m||!e.contains(o.snapElements[p].item.ownerDocument,o.snapElements[p].item)?(o.snapElements[p].snapping&&o.options.snap.release&&o.options.snap.release.call(o.element,t,e.extend(o._uiHash(),{snapItem:o.snapElements[p].item})),o.snapElements[p].snapping=!1):("inner"!==f.snapMode&&(i=Math.abs(u-b)<=m,n=Math.abs(d-v)<=m,l=Math.abs(c-g)<=m,r=Math.abs(a-C)<=m,i&&(s.position.top=o._convertPositionTo("relative",{top:u-o.helperProportions.height,left:0}).top),n&&(s.position.top=o._convertPositionTo("relative",{top:d,left:0}).top),l&&(s.position.left=o._convertPositionTo("relative",{top:0,left:c-o.helperProportions.width}).left),r&&(s.position.left=o._convertPositionTo("relative",{top:0,left:a}).left)),h=i||n||l||r,"outer"!==f.snapMode&&(i=Math.abs(u-v)<=m,n=Math.abs(d-b)<=m,l=Math.abs(c-C)<=m,r=Math.abs(a-g)<=m,i&&(s.position.top=o._convertPositionTo("relative",{top:u,left:0}).top),n&&(s.position.top=o._convertPositionTo("relative",{top:d-o.helperProportions.height,left:0}).top),l&&(s.position.left=o._convertPositionTo("relative",{top:0,left:c}).left),r&&(s.position.left=o._convertPositionTo("relative",{top:0,left:a-o.helperProportions.width}).left)),!o.snapElements[p].snapping&&(i||n||l||r||h)&&o.options.snap.snap&&o.options.snap.snap.call(o.element,t,e.extend(o._uiHash(),{snapItem:o.snapElements[p].item})),o.snapElements[p].snapping=i||n||l||r||h)}}),e.ui.plugin.add("draggable","stack",{start:function(t,s,o){var i,n=o.options,l=e.makeArray(e(n.stack)).sort(function(t,s){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(s).css("zIndex"),10)||0)});l.length&&(i=parseInt(e(l[0]).css("zIndex"),10)||0,e(l).each(function(t){e(this).css("zIndex",i+t)}),this.css("zIndex",i+l.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,s,o){var i=e(s.helper),n=o.options;i.css("zIndex")&&(n._zIndex=i.css("zIndex")),i.css("zIndex",n.zIndex)},stop:function(t,s,o){var i=o.options;i._zIndex&&e(s.helper).css("zIndex",i._zIndex)}}),e.ui.draggable}),function(e){"function"==typeof define&&define.amd?define("droppable",["jquery","ui_core","widget","mouse","draggable"],e):e(jQuery)}(function(e){return e.widget("ui.droppable",{version:"@VERSION",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t,s=this.options,o=s.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(o)?o:function(e){return e.is(o)},this.proportions=function(){return arguments.length?void(t=arguments[0]):t?t:t={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(s.scope),s.addClasses&&this.element.addClass("ui-droppable")},_addToManager:function(t){e.ui.ddmanager.droppables[t]=e.ui.ddmanager.droppables[t]||[],e.ui.ddmanager.droppables[t].push(this)},_splice:function(e){for(var t=0;t<e.length;t++)e[t]===this&&e.splice(t,1)},_destroy:function(){var t=e.ui.ddmanager.droppables[this.options.scope];this._splice(t),this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,s){if("accept"===t)this.accept=e.isFunction(s)?s:function(e){return e.is(s)};else if("scope"===t){var o=e.ui.ddmanager.droppables[this.options.scope];this._splice(o),this._addToManager(s)}this._super(t,s)},_activate:function(t){var s=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),s&&this._trigger("activate",t,this.ui(s))},_deactivate:function(t){var s=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),s&&this._trigger("deactivate",t,this.ui(s))},_over:function(t){var s=e.ui.ddmanager.current;s&&(s.currentItem||s.element)[0]!==this.element[0]&&this.accept.call(this.element[0],s.currentItem||s.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(s)))},_out:function(t){var s=e.ui.ddmanager.current;s&&(s.currentItem||s.element)[0]!==this.element[0]&&this.accept.call(this.element[0],s.currentItem||s.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(s)))},_drop:function(t,s){var o=s||e.ui.ddmanager.current,i=!1;return o&&(o.currentItem||o.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var s=e(this).droppable("instance");return s.options.greedy&&!s.options.disabled&&s.options.scope===o.options.scope&&s.accept.call(s.element[0],o.currentItem||o.element)&&e.ui.intersect(o,e.extend(s,{offset:s.element.offset()}),s.options.tolerance,t)?(i=!0,!1):void 0}),i?!1:this.accept.call(this.element[0],o.currentItem||o.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(o)),this.element):!1):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(){function e(e,t,s){return e>=t&&t+s>e}return function(t,s,o,i){if(!s.offset)return!1;var n=(t.positionAbs||t.position.absolute).left+t.margins.left,l=(t.positionAbs||t.position.absolute).top+t.margins.top,r=n+t.helperProportions.width,c=l+t.helperProportions.height,a=s.offset.left,u=s.offset.top,d=a+s.proportions().width,p=u+s.proportions().height;switch(o){case"fit":return n>=a&&d>=r&&l>=u&&p>=c;case"intersect":return a<n+t.helperProportions.width/2&&r-t.helperProportions.width/2<d&&u<l+t.helperProportions.height/2&&c-t.helperProportions.height/2<p;case"pointer":return e(i.pageY,u,s.proportions().height)&&e(i.pageX,a,s.proportions().width);case"touch":return(l>=u&&p>=l||c>=u&&p>=c||u>l&&c>p)&&(n>=a&&d>=n||r>=a&&d>=r||a>n&&r>d);default:return!1}}}(),e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,s){var o,i,n=e.ui.ddmanager.droppables[t.options.scope]||[],l=s?s.type:null,r=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();e:for(o=0;o<n.length;o++)if(!(n[o].options.disabled||t&&!n[o].accept.call(n[o].element[0],t.currentItem||t.element))){for(i=0;i<r.length;i++)if(r[i]===n[o].element[0]){n[o].proportions().height=0;continue e}n[o].visible="none"!==n[o].element.css("display"),n[o].visible&&("mousedown"===l&&n[o]._activate.call(n[o],s),n[o].offset=n[o].element.offset(),n[o].proportions({width:n[o].element[0].offsetWidth,height:n[o].element[0].offsetHeight}))}},drop:function(t,s){var o=!1;return e.each((e.ui.ddmanager.droppables[t.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance,s)&&(o=this._drop.call(this,s)||o),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,s)))}),o},dragStart:function(t,s){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,s)})},drag:function(t,s){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,s),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var o,i,n,l=e.ui.intersect(t,this,this.options.tolerance,s),r=!l&&this.isover?"isout":l&&!this.isover?"isover":null;r&&(this.options.greedy&&(i=this.options.scope,n=this.element.parents(":data(ui-droppable)").filter(function(){return e(this).droppable("instance").options.scope===i}),n.length&&(o=e(n[0]).droppable("instance"),o.greedyChild="isover"===r)),o&&"isover"===r&&(o.isover=!1,o.isout=!0,o._out.call(o,s)),this[r]=!0,this["isout"===r?"isover":"isout"]=!1,this["isover"===r?"_over":"_out"].call(this,s),o&&"isout"===r&&(o.isout=!1,o.isover=!0,o._over.call(o,s)))}})},dragStop:function(t,s){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,s)}},e.ui.droppable}),define("resourcesCollections",["jquery","underscore","core","timeago","draggable","droppable"],function(e,t){t.extend(OC.resourcesCollections,{resourceItemTemplate:t.template('<div class="<%= host %>-browse-item resource-collection-item resource <%= type %>-resource" id="resource-<%= id %>"><input type="checkbox" name="resource_id" value="<%= id %>"/><a href="<%= url %>"><%= title %> <span class="<%= host %>-browse-item-date"><%= created %></span><div class="resource-collection-actions <%= resource_type %> <%= is_collaborator %> is-owner"><span class="<%= host %>-browse-item-visibility browse-item-visibility visibility-<%= visibility %>" title=" Who has access: <%= access %>"></span><div class="<%= host %>-resource-delete resource-collection-delete" id="resource-<%= id %>" title="Delete"></div></div></a></div>'),resourceCollectionItemTemplate:t.template('<div class="resource-collection-item <%= category %>" id="<%= category %>-<%= id %>"><% if (owner){ %> <div class="resource-item-selector"><input type="checkbox" name="resource_collection_id" value="<%= id %>"/></div><% } %><a href="<%= url %>"<% if (open_url){ %> target="_blank"<% } %> class="resource-item-thumbnail" style="background-image: url(\'<%= thumbnail %>\');"><div class="resource-item-thumbnail-selector"></div><div class="resource-item-thumbnail-<%= type %>"></div></a><div class="resource-item-description"><div class="resource-item-description-title"><a href="<%= url %>"<% if (open_url){ %> target="_blank"<% } %>><%= title %></a></div><div class="resource-item-description-modified" title="<%= modified %>"><%= modified %></div><div class="resource-item-description-actions"><div class="resource-item-description-actions-visibility"><span class=" <%= host %>-browse-item-visibility browse-item-visibility visibility-<%= visibility %> <%= visibility_classes %>"><span class="visibility-icon"></span><%= visibility_title %></span></div></div></div></div>'),collectionItemTemplate:t.template('<div class="<%= host %>-browse-item resource-collection-item directory " id="collection-<%= id %>"><input type="checkbox" name="collection_id" value="<%= id %>"/><a href="<%= url %>"><%= title %> <span class="<%= host %>-browse-item-date"><%= created %></span><div class="resource-collection-actions <%= collection_type %> <%= is_collaborator %> is-owner"><span class="<%= host %>-browse-item-visibility browse-item-visibility visibility-<%= visibility %>" title=" Who has access: <%= access %>"></span><div class="<%= host %>-collection-delete resource-collection-delete" id="collection-<%= id %>" title="Delete"></div></div></a></div>'),currentResourceCollectionVisibility:"",initResourcesCollections:function(){e(".resource-collection-item").length>=1&&(OC.resourcesCollections.initFavoriteStates(),OC.resourcesCollections.initCopyAction(),OC.resourcesCollections.ownerView&&OC.resourcesCollections.bindItemSelect(),OC.resourcesCollections.infiniteScroll()),e(".resources-collections-added").length>=1&&(e(".project-browse-item-visibility, .profile-browse-item-visibility").tipsy({gravity:"n"}),e(".resource-collection-delete").tipsy({gravity:"n"}),OC.resourcesCollections.bindItemVisibilityButton(),OC.resourcesCollectionsActions.initResourcesCollectionsActions())
},initFavoriteStates:function(){function t(t,o){s=e(".resource-collection-item#resource-"+t);var i=e(".resource-favorite",s),n=e(".resource-favorite-wrapper",s);o&&(n.addClass("favorited"),i.text("Favorited")),i.click(function(s){var o=e(this),i=o.parent(".resource-favorite-wrapper");return OC.favoriteClickHandler("resource",t,function(){i.addClass("favorited"),o.text("Favorited")},function(){i.removeClass("favorited"),o.text("Favorite")}),s.stopPropagation(),s.preventDefault(),!1})}var s,o,i,n=e(".resource-collection-item");for(o=0;o<n.length;o++)i=e(n[o]).attr("id").substring(9),OC.getFavoriteState("resource",i,t)},infiniteScroll:function(){if(OC.resourcesCollections.resourceCount>20){var t,s,o=e(".lazy-load-button");e(".profile-content").on("DOMContentLoaded load resize scroll",function(){t=e(".resources-collections-added").attr("id").substring(11),e.contains(document,o[0])&&isElementInViewport(o)&&!o.hasClass("loading")&&(o.addClass("loading"),e.get("/resources/api/load-resources/"+t+"/from/"+OC.resourcesCollections.currentCount+"/",function(t){if("true"==t.status){var i=Object.keys(t.resources);if(0!==i.length){var n,l;for(s=0;s<i.length;s++){l=t.resources[i[s]],l.owner=OC.resourcesCollections.ownerView,e(".resources-collections-added").append(OC.resourcesCollections.resourceCollectionItemTemplate(l));var r=".resources-collections-added .resource-collection-item:last";n=e(r),OC.resourcesCollections.bindItemSelect(r),OC.resourcesCollectionsActions.bindResourceCollectionSelectors(r),e(".resource-item-description-modified",n).timeago()}OC.resourcesCollections.currentCount+=i.length}else o.remove()}else OC.popup(t.message,t.title);o.removeClass("loading")},"json"))})}},initCopyAction:function(){var t,s=e(".resource-collection-item"),o=e(".resources-collections-added");o.length>=1&&(t=o.attr("id").substring(11));var i;for(i=0;i<s.length;i++){var n,l;resourceCollectionItem=e(s[i]),resourceCollectionCopyButton=e(".resource-copy",resourceCollectionItem),resourceCollectionItem.hasClass("collection")?l=resourceCollectionItem.attr("id").substring(11):(n=resourceCollectionItem.attr("id").substring(9),l=void 0),t?l?OC.resourcesCollections.bindResourceCollectionCopyButton("collection",l,t):OC.resourcesCollections.bindResourceCollectionCopyButton("resource",n,t):l?OC.resourcesCollections.fetchParentCollectionAndBindCopyButton("collection",l,OC.resourcesCollections.bindResourceCollectionCopyButton):OC.resourcesCollections.fetchParentCollectionAndBindCopyButton("resource",n,OC.resourcesCollections.bindResourceCollectionCopyButton)}},synchronizeSelectors:function(){var t,s,o,i=e(".resource-item-thumbnail-selector"),n=0;for(n=0;n<i.length;n++)t=e(i[n]),o=t.parents(".resource-collection-item"),s=o.find("input[name=resource_collection_id]")[0],s.checked?o.addClass("selected"):o.removeClass("selected")},bindItemSelect:function(t){var s=t||".resource-collection-item";e(s).click(OC.resourcesCollections.itemSelectClickHandlers.itemClick),e(s+" input[name=resource_collection_id]").click(OC.resourcesCollections.itemSelectClickHandlers.inputClick),OC.resourcesCollections.itemSelectClickHandlers.preventPropagationOnItemClick(s)},itemSelectClickHandlers:{itemClick:function(){var t=e(this),s=e("input[name=resource_collection_id]",t),o=s[0];o.checked?s.prop("checked",!1):s.prop("checked",!0),t.toggleClass("selected"),s.trigger("itemSelected")},inputClick:function(t){var s=e(t.target).parents(".resource-collection-item");s.toggleClass("selected"),e(t.target).trigger("itemSelected")},preventPropagationOnItemClick:function(t){e(t+" input[name=resource_collection_id], "+t+" a.resource-item-thumbnail, "+t+" .resource-item-description-title a").click(function(e){e.stopPropagation()})}},bindResourceCollectionCopyButton:function(e,t,s){resourceCollectionCopyButton.click(function(o){OC.addCopyClickHandler(e,t,s,o)})},fetchParentCollectionAndBindCopyButton:function(t,s,o){"collection"===t?e.get("/resources/parent-collection-from-collection/"+s+"/",function(e){"true"==e.status?o("collection",collectionID,e.collectionID):OC.popup(e.message,e.title)},"json"):e.get("/resources/collection-from-resource/"+s+"/",function(e){"true"==e.status?o("resource",resourceID,e.collectionID):OC.popup(e.message,e.title)},"json")},bindItemVisibilityButton:function(){e(".browse-item-visibility").click(OC.resourcesCollections.itemVisibilityButtonClickHandler)},itemVisibilityButtonClickHandler:function(t){var s=e(t.target);if(s.hasClass("is-owner")||s.hasClass("is-collaborator")){var o=s.hasClass("project-browse-item-visibility"),i=e(t.target).closest(".resource-collection-item");i.type=i.hasClass("collection")?"collection":"resource",i.id=i.attr("id").substring("collection"===i.type?11:9),OC.collaborators.currentResourceCollectionVisibility=OC.resourcesCollections.getResourceCollectionVisibility(s,o),OC.collaborators.init(i,OC.resourcesCollections.resourceVisibility.setupToggler,OC.resourcesCollections.collectionVisibility.setupToggler,OC.resourcesCollections.closeCollaboratorPopupCallback,s.hasClass("is-owner"))}return t.stopPropagation(),t.preventDefault(),!1},getResourceCollectionVisibility:function(e,t){return e.hasClass("visibility-private")?"private":t?"project":"public"},collectionVisibility:{setupToggler:function(t,s){var o=e(".resources-collections-added #collection-"+t+" .browse-item-visibility");if(s){var i=e('.resource-collection-visibility-form-tabs li a[href="#project-access"]');i.click(function(){OC.resourcesCollections.collectionVisibility.setProjectVisibility(o,t)})}else{var n=e('.resource-collection-visibility-form-tabs li a[href="#profile-access"]');n.click(function(){OC.resourcesCollections.collectionVisibility.setPublicVisibility(o,t)})}var l=e('.resource-collection-visibility-form-tabs li a[href="#private-access"]');l.click(function(){OC.resourcesCollections.collectionVisibility.setPrivateVisibility(o,t)})},setProjectVisibility:function(e){e.removeClass("visibility-private"),e.addClass("visibility-project"),e.html('<span class="group-shared-icon"></span>Shared with group')},setPrivateVisibility:function(e){e.removeClass("visibility-project"),e.removeClass("visibility-public"),e.addClass("visibility-private"),e.html('<span class="private-shared-icon"></span>Shared')},setPublicVisibility:function(e){e.removeClass("visibility-private"),e.addClass("visibility-public"),e.html('<span class="publicly-shared-icon"></span>Public')}},resourceVisibility:{setupToggler:function(t,s){var o=e(".resources-collections-added #resource-"+t+" .browse-item-visibility");if(s){var i=e('.resource-collection-visibility-form-tabs li a[href="#project-access"]');i.click(function(){OC.resourcesCollections.resourceVisibility.setProjectVisibility(o,t)})}else{var n=e('.resource-collection-visibility-form-tabs li a[href="#profile-access"]');n.click(function(){OC.resourcesCollections.resourceVisibility.setPublicVisibility(o,t)})}var l=e('.resource-collection-visibility-form-tabs li a[href="#private-access"]');l.click(function(){OC.resourcesCollections.resourceVisibility.setPrivateVisibility(o,t)})},setProjectVisibility:function(e){e.removeClass("visibility-private"),e.addClass("visibility-project"),e.html('<span class="group-shared-icon"></span>Shared with group')},setPrivateVisibility:function(e){e.removeClass("visibility-project"),e.removeClass("visibility-public"),e.addClass("visibility-private"),e.html('<span class="private-shared-icon"></span>Shared')},setPublicVisibility:function(e){e.removeClass("visibility-private"),e.addClass("visibility-public"),e.html('<span class="publicly-shared-icon"></span>Public')}},closeCollaboratorPopupCallback:function(){var t=e("form#add-collection-collaborator-form input[name=collection_id]").val(),s=e("form#add-collection-collaborator-form input[name=resource_id]").val(),o=""===t?"resource-"+s:"collection-"+t,i=e(".resources-collections-added").hasClass("project-resources-collections"),n=e(".resources-collections-added #"+o+" .browse-item-visibility"),l=OC.resourcesCollections.getResourceCollectionVisibility(n,i);l!==OC.resourcesCollections.currentResourceCollectionVisibility&&""!==t&&(OC.setMessageBoxMessage("Changing access control of resources and folders inside..."),OC.showMessageBox(),OC.resourcesCollections.collectionVisibilityChangePropagation(t))},collectionVisibilityChangePropagation:function(t){e.get("/resources/collection/"+t+"/visibility/propagate-changes/",function(e){"true"===e.status?OC.resourcesCollections.collectionVisibilityPropagationSuccess():OC.popup(e.message,e.title)},"json")},collectionVisibilityPropagationSuccess:function(){OC.dismissMessageBox()}}),OC.resourcesCollectionsActions={pendingActions:{copyResources:[],copyCollections:[],deleteResources:[],deleteCollections:[],renameResources:[],renameCollections:[]},actionsCompleted:{copyResources:[],copyCollections:[],deleteResources:[],deleteCollections:[],renameResources:[],renameCollections:[]},actionCompletionCallback:"",actionCompleted:function(){var e,t=!0;for(e in OC.resourcesCollectionsActions.pendingActions)if(OC.resourcesCollectionsActions.pendingActions[e].length>=1){t=!1;break}t&&OC.resourcesCollectionsActions.actionCompletionCallback()},initResourcesCollectionsActions:function(){var t=e(".resources-collections-added");t.length>0&&(OC.resourcesCollectionsActions.initBrowseNavigation(),OC.resourcesCollectionsActions.initMoveResourcesCollections(),OC.resourcesCollectionsActions.initResourceCollectionActions())},initMoveResourcesCollections:function(){OC.resourcesCollectionsActions.initResourceCollectionsDraggability(e(".resource-collection-item")),OC.resourcesCollectionsActions.initResourceCollectionsDroppability(e(".resource-collection-item.directory"))},initResourceCollectionsDraggability:function(e){e.draggable({revert:"invalid"})},initResourceCollectionsDroppability:function(t){t.droppable({hoverClass:"droppable",accept:".directory, .resource",drop:function(t,s){s.draggable.hasClass("directory")?(OC.resourcesCollectionsActions.moveCollectionIntoCollection(s.draggable.attr("id").substring(11),e(t.target).attr("id").substring(11)),OC.resourcesCollectionsActions.movedIntoCollection([],[s.draggable])):(OC.resourcesCollectionsActions.moveResourceIntoCollection(s.draggable.attr("id").substring(9),e(t.target).attr("id").substring(11)),OC.resourcesCollectionsActions.movedIntoCollection([s.draggable],[]))}})},moveResourceIntoCollection:function(t,s){var o=e(".resources-collections-added").attr("id").substring(11);e.get("/resources/move/resource/"+t+"/from/"+o+"/to/"+s+"/",function(e){"true"==e.status?OC.resourcesCollectionsActions.resourceCollectionMovedSuccess(".resource-collection-item#resource-"+t):OC.popup(e.message,e.title)},"json")},moveCollectionIntoCollection:function(t,s){var o=e(".resources-collections-added").attr("id").substring(11);e.get("/resources/move/collection/"+t+"/from/"+o+"/to/"+s+"/",function(e){"true"==e.status?OC.resourcesCollectionsActions.resourceCollectionMovedSuccess(".resource-collection-item#collection-"+t):OC.popup(e.message,e.title)},"json")},resourceCollectionMovedSuccess:function(t){e(t).fadeOut("fast")},movedIntoCollection:function(e,t){var s=e||[],o=t||[];s.length>=1&&o.length>=1?OC.setMessageBoxMessage("Moved resources and folders successfully"):s.length>=1?OC.setMessageBoxMessage("Moved resource(s) into the folder successfully"):o.length>=1&&OC.setMessageBoxMessage("Moved folder(s) successfully"),OC.showMessageBox()},resourceCopiedSuccessfully:function(t,s){var o="project"===t.host?"":"profile-resource",i="collection"===t.visibility?"Private (collection)":t.visibility.charAt(0).toUpperCase();t.resource_type=o,t.access=i;var n=OC.resourcesCollections.resourceCollectionItemTemplate(t);e("."+t.host+"-resources-added-list").append(n);var l=e("."+t.host+"-resources-added-list .resource-collection-item:last"),r=e("input[type=checkbox]",l),c=e(".browse-item-visibility",l);r.click(OC.resourcesCollectionsActions.resourceCollectionCheckboxHandler),c.click(OC.resourcesCollections.itemVisibilityButtonClickHandler),OC.resourcesCollectionsActions.initResourceCollectionsDraggability(l),e(".resource-item-description-modified",l).timeago(),OC.resourcesCollectionsActions.pendingActions.copyResources.splice(s),OC.resourcesCollectionsActions.actionsCompleted.copyResources.push(s),OC.resourcesCollectionsActions.actionCompleted()},collectionCopiedSuccessfully:function(t,s){var o="project"===t.host?"":"profile-collection",i="collection"===t.visibility?"Private (collection)":t.visibility.charAt(0).toUpperCase();t.collection_type=o,t.access=i;var n=OC.resourcesCollections.collectionItemTemplate(t);e("."+t.host+"-collections-added-list").append(n);var l=e("."+t.host+"-collections-added-list .resource-collection-item:last"),r=e("input[type=checkbox]",l),c=e(".browse-item-visibility",l);r.click(OC.resourcesCollectionsActions.resourceCollectionCheckboxHandler),c.click(OC.resourcesCollections.itemVisibilityButtonClickHandler),OC.resourcesCollectionsActions.initResourceCollectionsDraggability(l),OC.resourcesCollectionsActions.initResourceCollectionsDroppability(l),e(".resource-item-description-modified",l).timeago(),OC.resourcesCollectionsActions.pendingActions.copyCollections.splice(s),OC.resourcesCollectionsActions.actionsCompleted.copyCollections.push(s),OC.resourcesCollectionsActions.actionCompleted()},resourceRenamedSuccessfully:function(t,s){var o=e(".resource-collection-item#resource-"+t),i=e(".resource-item-description-title a",o);i.text(s),o.trigger("click"),OC.resourcesCollectionsActions.pendingActions.renameResources.splice(t),OC.resourcesCollectionsActions.actionsCompleted.renameResources.push(t),OC.resourcesCollectionsActions.actionCompleted()},collectionRenamedSuccessfully:function(t,s){var o=e(".resource-collection-item#collection-"+t),i=e(".resource-item-description-title a",o);i.text(s),o.trigger("click"),OC.resourcesCollectionsActions.pendingActions.renameCollections.splice(t),OC.resourcesCollectionsActions.actionsCompleted.renameCollections.push(t),OC.resourcesCollectionsActions.actionCompleted()},copying:function(){OC.setMessageBoxMessage("Copying..."),OC.showMessageBox()},copied:function(){var e=OC.resourcesCollectionsActions.actionsCompleted.copyResources,t=OC.resourcesCollectionsActions.actionsCompleted.copyCollections;e.length>=1&&t.length>=1?OC.setMessageBoxMessage("Copied resources and folders successfully"):e.length>=1?OC.setMessageBoxMessage("Copied resource(s) successfully"):t.length>=1&&OC.setMessageBoxMessage("Copied folder(s) successfully"),OC.showMessageBox()},renaming:function(){OC.setMessageBoxMessage("Renaming..."),OC.showMessageBox()},renamed:function(){var e=OC.resourcesCollectionsActions.actionsCompleted.renameResources,t=OC.resourcesCollectionsActions.actionsCompleted.renameCollections;1===e.length?OC.setMessageBoxMessage("Renamed resource successfully"):1===t.length&&OC.setMessageBoxMessage("Renamed folder successfully"),OC.showMessageBox()},collectionsDeletedSuccessfully:function(t){var s;for(s=0;s<t.length;s++)OC.resourcesCollectionsActions.pendingActions.deleteCollections.splice(t[s]),OC.resourcesCollectionsActions.actionsCompleted.deleteCollections.push(t[s]),e(".resource-collection-item#collection-"+t[s]).fadeOut();OC.resourcesCollectionsActions.actionCompleted()},resourcesDeletedSuccessfully:function(t){var s;for(s=0;s<t.length;s++)OC.resourcesCollectionsActions.pendingActions.deleteResources.splice(t[s]),OC.resourcesCollectionsActions.actionsCompleted.deleteResources.push(t[s]),e(".resource-collection-item#resource-"+t[s]).fadeOut();OC.resourcesCollectionsActions.actionCompleted()},deleting:function(){OC.setMessageBoxMessage("Deleting..."),OC.showMessageBox()},deleted:function(){var e=OC.resourcesCollectionsActions.actionsCompleted.deleteResources,t=OC.resourcesCollectionsActions.actionsCompleted.deleteCollections;e.length>=1&&t.length>=1?OC.setMessageBoxMessage("Deleted resources and folders successfully"):e.length>=1?OC.setMessageBoxMessage("Deleted resource(s) successfully"):t.length>=1&&OC.setMessageBoxMessage("Deleted folder(s) successfully"),OC.showMessageBox()},initResourceCollectionActions:function(){function t(){var t=e(".profile-resources-collections-wrapper"),s=e(".profile-resources-collections-actions-menu");return isElementInViewport(t)?s.height()>t.height()?s.height():t.height():e(window).height()-t.offset().top}function s(){i.height(a)}var o=e(".profile-resources-collections-actions"),i=e(".profile-resources-collections-actions-shadow"),n=e(".profile-resources-collections-wrapper"),l=e(".profile-tabs"),r=l.position().top+l.outerHeight(!0),c=o.position().left;o.css({top:r,left:c});var a=t();e(".profile-content").on("scroll",function(){isElementInViewport(o)&&!o.hasClass("floating")?o.position().top<r&&(o.addClass("floating"),i.height(e(window).height()-r)):o.hasClass("floating")&&n.position().top>r&&(o.removeClass("floating"),i.height(a))}),s(),e(window).resize(function(){a=t(),s()}),OC.resourcesCollectionsActions.bindResourceCollectionSelectors(),OC.resourcesCollectionsActions.actionButtonsClickHandler();var u=e(".resource-collection-item input[type=checkbox]:checked");if(u.length>=1){var d;for(d=0;d<u.length;d++)OC.resourcesCollectionsActions.selectedResourcesCollections.push(u[d])}else OC.resourcesCollectionsActions.selectedResourcesCollectionsChangeListener()},actionButtonsClickHandler:function(){var t=e(".collection-actions .move-button");t.click(OC.resourcesCollectionsActions.moveButtonClickHandler);var s=e(".collection-actions .copy-button");s.click(OC.resourcesCollectionsActions.copyButtonClickHandler);var o=e(".collection-actions .rename-button");o.click(OC.resourcesCollectionsActions.renameButtonClickHandler);var i=e(".collection-actions .del-button");i.click(OC.resourcesCollectionsActions.deleteButtonClickHandler)},moveButtonClickHandler:function(t){var s=OC.customPopup(".move-resource-collection-dialog"),o=e(".move-resource-collection-browser"),i=e(".resources-collections-added").attr("id").substring(11);o.children().remove(),o.addClass("loading-browser"),e(".move-resource-collection-submit-button").click(function(){var t=o.find(".selected-destination-collection");if(s.close(),t){var i,n=t.attr("id").substring(11),l=[],r=[];for(i=0;i<OC.resourcesCollectionsActions.selectedResourcesCollections.length;i++){var c=e(OC.resourcesCollectionsActions.selectedResourcesCollections[i]).closest(".resource-collection-item");c.hasClass("collection")?(OC.resourcesCollectionsActions.moveCollectionIntoCollection(c.attr("id").substring(11),n),r.push(OC.resourcesCollectionsActions.selectedResourcesCollections[i])):(OC.resourcesCollectionsActions.moveResourceIntoCollection(c.attr("id").substring(9),n),l.push(OC.resourcesCollectionsActions.selectedResourcesCollections[i]))}OC.resourcesCollectionsActions.movedIntoCollection(l,r)}});var n=e(".resources-collections-added").hasClass("project-resources-collections");return n?e.get("/resources/collection/"+i+"/tree/collections/project/",function(e){"true"==e.status?(OC.renderBrowser(e.tree,o,i),o.removeClass("loading-browser")):OC.popup(e.message,e.title)},"json"):e.get("/resources/tree/collections/user/",function(e){"true"==e.status?(OC.renderBrowser(e.tree,o,i),o.removeClass("loading-browser")):OC.popup(e.message,e.title)},"json"),t.stopPropagation(),t.preventDefault(),!1},copyButtonClickHandler:function(t){var s=e(".resources-collections-added").attr("id").substring(11);OC.resourcesCollectionsActions.copying();var o,i=[],n=[];for(o=0;o<OC.resourcesCollectionsActions.selectedResourcesCollections.length;o++){var l=e(OC.resourcesCollectionsActions.selectedResourcesCollections[o]).closest(".resource-collection-item");if(l.hasClass("collection")){var r=l.attr("id").substring(11);OC.collection.copy(r,s,OC.resourcesCollectionsActions.collectionCopiedSuccessfully),n.push(r)}else{var c=l.attr("id").substring(9);OC.resource.copy(s,c,s,OC.resourcesCollectionsActions.resourceCopiedSuccessfully),i.push(c)}}return OC.resourcesCollectionsActions.pendingActions.copyResources.concat(i),OC.resourcesCollectionsActions.pendingActions.copyCollections.concat(n),OC.resourcesCollectionsActions.actionCompletionCallback=OC.resourcesCollectionsActions.copied,t.stopPropagation(),t.preventDefault(),!1},renameButtonClickHandler:function(t){OC.resourcesCollectionsActions.renaming();var s=e(OC.resourcesCollectionsActions.selectedResourcesCollections[0]).closest(".resource-collection-item"),o=OC.customPopup(".rename-file-folder-dialog"),i=e('input[name="new_name"]',o.dialog),n=e(".resource-item-description-title a",s).text();return i.val(n),e(".rename-file-folder-submit-button",o.dialog).click(function(t){o.close();var l=i.val();if(l!==n){var r=[],c=[];if(s.hasClass("collection")){var a=s.attr("id").substring(11);OC.collection.rename(a,l,OC.resourcesCollectionsActions.collectionRenamedSuccessfully),c.push(a)}else{var u=s.attr("id").substring(9);OC.resource.rename(u,l,OC.resourcesCollectionsActions.resourceRenamedSuccessfully),r.push(u)}OC.resourcesCollectionsActions.pendingActions.renameResources.concat(r),OC.resourcesCollectionsActions.pendingActions.renameCollections.concat(c),OC.resourcesCollectionsActions.actionCompletionCallback=OC.resourcesCollectionsActions.renamed}return i.val(""),e(this).unbind("click"),t.stopPropagation(),t.preventDefault(),!1}),t.stopPropagation(),t.preventDefault(),!1},setDialogMessage:function(t,s,o){e(t+"-message").text(s),e(t+"-title").text(o)},getSelectedResourcesCollections:function(){var t,s=[],o=[];for(t=0;t<OC.resourcesCollectionsActions.selectedResourcesCollections.length;t++){var i=e(OC.resourcesCollectionsActions.selectedResourcesCollections[t]).closest(".resource-collection-item");i.hasClass("collection")?o.push(OC.resourcesCollectionsActions.selectedResourcesCollections[t]):s.push(OC.resourcesCollectionsActions.selectedResourcesCollections[t])}return[s,o]},deleteButtonClickHandler:function(t){var s=e(".resources-collections-added").attr("id").substring(11);OC.resourcesCollectionsActions.deleting();var o,i=[],n=[],l=[],r=[];for(o=0;o<OC.resourcesCollectionsActions.selectedResourcesCollections.length;o++){var c=e(OC.resourcesCollectionsActions.selectedResourcesCollections[o]).closest(".resource-collection-item");c.hasClass("collection")?(n.push(c.attr("id").substring(11)),r.push(OC.resourcesCollectionsActions.selectedResourcesCollections[o])):(i.push(c.attr("id").substring(9)),l.push(OC.resourcesCollectionsActions.selectedResourcesCollections[o]))}return resourceCollections=OC.resourcesCollectionsActions.getSelectedResourcesCollections(),resourceCollections[0].length>1&&resourceCollections[1].length>1?(OC.resourcesCollectionsActions.setDialogMessage(".delete-resource-collection-dialog","Are you sure you want to delete these files and folders? This will also delete all the files and folders within these folders.","Delete files and folders"),OC.resource.deleteMultiple(i,s,OC.resourcesCollectionsActions.resourcesDeletedSuccessfully),OC.collection.deleteMultiple(n,OC.resourcesCollectionsActions.collectionsDeletedSuccessfully)):resourceCollections[0].length>1&&1===resourceCollections[1].length?(OC.resourcesCollectionsActions.setDialogMessage(".delete-resource-collection-dialog","Are you sure you want to delete these files and the selected folder? This will also delete all the files and folders within the folder.","Delete files and folder"),OC.resource.deleteMultiple(i,s,OC.resourcesCollectionsActions.resourcesDeletedSuccessfully),OC.collection.delete(n[0],OC.resourcesCollectionsActions.collectionsDeletedSuccessfully)):1===resourceCollections[0].length&&resourceCollections[1].length>1?(OC.resourcesCollectionsActions.setDialogMessage(".delete-resource-collection-dialog","Are you sure you want to delete these folders and the selected file? This will also delete all the files and folders within these folders.","Delete folders and file"),OC.resource.delete(i[0],s,OC.resourcesCollectionsActions.resourcesDeletedSuccessfully),OC.collection.deleteMultiple(n,OC.resourcesCollectionsActions.collectionsDeletedSuccessfully)):1===resourceCollections[0].length&&1===resourceCollections[1].length?(OC.resourcesCollectionsActions.setDialogMessage(".delete-resource-collection-dialog","Are you sure you want to delete this folder and this file? This will also delete all the files and folders within the folder.","Delete folder and file"),OC.resource.delete(i[0],s,OC.resourcesCollectionsActions.resourcesDeletedSuccessfully),OC.collection.delete(n[0],OC.resourcesCollectionsActions.collectionsDeletedSuccessfully)):resourceCollections[0].length>1?(OC.resourcesCollectionsActions.setDialogMessage(".delete-resource-collection-dialog","Are you sure you want to delete these resources?","Delete resources"),OC.resource.deleteMultiple(i,s,OC.resourcesCollectionsActions.resourcesDeletedSuccessfully)):resourceCollections[1].length>1?(OC.resourcesCollectionsActions.setDialogMessage(".delete-resource-collection-dialog","Are you sure you want to delete these folders? This will also delete all the files and folders within these folders.","Delete folders"),OC.collection.deleteMultiple(n,OC.resourcesCollectionsActions.resourcesDeletedSuccessfully)):1===resourceCollections[0].length?(OC.resourcesCollectionsActions.setDialogMessage(".delete-resource-collection-dialog","Are you sure you want to delete this resource?","Delete resource"),OC.resource.delete(i[0],s,OC.resourcesCollectionsActions.resourcesDeletedSuccessfully)):1===resourceCollections[1].length&&(OC.resourcesCollectionsActions.setDialogMessage(".delete-resource-collection-dialog","Are you sure you want to delete this folder? This will also delete all the files and folders within the folder.","Delete folder"),OC.collection.delete(n[0],OC.resourcesCollectionsActions.collectionsDeletedSuccessfully)),OC.resourcesCollectionsActions.pendingActions.deleteResources.concat(l),OC.resourcesCollectionsActions.pendingActions.deleteCollections.concat(r),OC.resourcesCollectionsActions.actionCompletionCallback=OC.resourcesCollectionsActions.deleted,t.stopPropagation(),t.preventDefault(),!1},bindResourceCollectionSelectors:function(t){var s=t||".resource-collection-item";e(s+" input[type=checkbox]").on("itemSelected",OC.resourcesCollectionsActions.resourceCollectionCheckboxHandler)},selectedResourcesCollections:[],resourceCollectionCheckboxHandler:function(t){var s=e(t.target).closest(".resource-collection-item");if(t.target.checked===!1){var o=OC.resourcesCollectionsActions.selectedResourcesCollections.indexOf(s);OC.resourcesCollectionsActions.selectedResourcesCollections.splice(o,1)}else OC.resourcesCollectionsActions.selectedResourcesCollections.push(s);OC.resourcesCollectionsActions.selectedResourcesCollectionsChangeListener()},selectedResourcesCollectionsChangeListener:function(){var t=e(".collection-actions .move-button"),s=e(".collection-actions .copy-button"),o=e(".collection-actions .del-button"),i=e(".collection-actions .rename-button"),n=e(".collection-actions .share-button"),l=e(".profile-resources-collections-actions-menu-edit"),r=e(".profile-resources-collections-actions-menu-add");OC.resourcesCollectionsActions.selectedResourcesCollections.length>=1?(l.hasClass("show")||(l.addClass("show"),r.addClass("fade-out")),1==OC.resourcesCollectionsActions.selectedResourcesCollections.length?(OC.resourcesCollectionsActions.enableActionButton(n),OC.resourcesCollectionsActions.enableActionButton(i)):(OC.resourcesCollectionsActions.disableActionButton(n),OC.resourcesCollectionsActions.disableActionButton(i)),OC.resourcesCollectionsActions.enableActionButton(t),OC.resourcesCollectionsActions.enableActionButton(s),OC.resourcesCollectionsActions.enableActionButton(o),OC.resourcesCollectionsActions.actionButtonsClickHandler()):(OC.resourcesCollectionsActions.disableActionButton(t),OC.resourcesCollectionsActions.disableActionButton(s),OC.resourcesCollectionsActions.disableActionButton(o),OC.resourcesCollectionsActions.disableActionButton(i),OC.resourcesCollectionsActions.disableActionButton(n),l.removeClass("show"),r.removeClass("fade-out"))},enableActionButton:function(e){e.removeClass("disabled-collection-button"),e.disabled=!1,e.unbind("click")},disableActionButton:function(e){e.addClass("disabled-collection-button"),e.disabled=!0,e.unbind("click"),e.click(function(e){return e.stopPropagation(),e.preventDefault(),!1})},initBrowseNavigation:function(){var t=e(".resources-collections-added").attr("id").substring(11),s=e("nav.collections-navigation").find("a#collection-"+t);s.addClass("current-navigation-collection"),s.parents(".parent-collection").each(function(){e(this).find(".toggle-collection:first").click()})}},e(document).ready(function(e){OC.resourcesCollections.initResourcesCollections(),OC.resourcesCollections.ownerView&&OC.resourcesCollections.synchronizeSelectors(),e(".resource-item-description-modified").timeago()})}),define("files",["jquery","core","resourcesCollections"],function(){});